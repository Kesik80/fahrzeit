<!--
+ 30.09.2025 13:00: –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ   —É—á–∞—Å—Ç–Ω–∏–∫–∞ –ø–æ–ª–µ ¬´–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã¬ª —Ç–µ–ø–µ—Ä—å –ù–ï –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ;
+ 30.09.2025 14:00: –¥–æ–±–∞–≤–∏–ª Ren√©, OLGA-Park;
+ 06.10.2025 22:00 –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ —Ç–æ—á–µ–∫ —Å—Ç–∞–Ω—Ü–∏–π
+ 07.10.2025 23:00 –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ –ø–∞—Ä–æ–ª—é –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
+ 08.10.2025 22:30 –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Å–æ–ª—å
+ 09.10.25 7:00 –≤ github –¥–æ–±–∞–≤–ª–µ–Ω // /api/expand.js –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–æ–∫ —Å–æ–∫—Ä–∞—â–µ–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ google
+ 09.10.25 16:00 –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å—Ç–∞—Ä—Ç –≤ Google Maps
+ 04.02.2026: –ò–°–ü–†–ê–í–õ–ï–ù–û ‚Äî –º–∞—Ä—à—Ä—É—Ç "—Ç—É–¥–∞" –∏ "–æ–±—Ä–∞—Ç–Ω–æ" —Å —Ä–µ–∞–ª—å–Ω—ã–º –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ–º –∏ –∫–Ω–æ–ø–∫–æ–π "–í –ø—É—Ç—å"
+ 04.02.2026: –£–î–ê–õ–ï–ù–´ –∫–Ω–æ–ø–∫–∏ open-map-direct –∏ open-map-return
+ 13.02.2026: –î–û–ë–ê–í–õ–ï–ù–û ‚Äî –∫–Ω–æ–ø–∫–∞ "+" –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –≤—ã–±–æ—Ä–æ–º "Treffpunkt" –∏–ª–∏ "Kollege";
              —Ñ–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞: "12:00 Ren√© (Olga-Park)" –∏–ª–∏ "12:00 Ren√©, Vasyl und Alex (Olga-Park)"
-->
<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<!-- –∏–∫–æ–Ω–∫–∞ –¥–ª—è iOS -->
<link rel="apple-touch-icon" href="/icons/icon-192.png">
<!-- –∏–∫–æ–Ω–∫–∞ –¥–ª—è Android / PWA -->
<link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png">
<link rel="icon" type="image/png" sizes="512x512" href="/icons/icon-512.png">
<!-- –º–∞–Ω–∏—Ñ–µ—Å—Ç -->
<link rel="manifest" href="/icons/manifest.json">
<!-- —Ü–≤–µ—Ç —Å—Ç–∞—Ç—É—Å-–±–∞—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) -->
<meta name="theme-color" content="#007bff" id="theme-meta">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<title>Fahrzeit Rechner</title>
<link rel="stylesheet"
href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=swap_vert" />
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.6/Sortable.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/latlon-geohash@2.0.0/latlon-geohash.min.js"></script>
<style>
:root {
--primary-color: #007bff;
--success-color: #28a745;
--info-color: #6c757d;
--danger-color: #dc3545;
--background-color: #f0f0f0;
--surface-color: white;
--text-color: #333;
--border-radius: 6px;
--spacing-unit: 10px;
--small-spacing: 6px;
--button-size: 44px;
--button-font-size: 0.9em;
}
body {
font-family: sans-serif;
padding: 10px;
max-width: 500px;
margin: auto;
background: var(--bg) !important;
color: var(--text) !important;
}
h2 {
text-align: center
}
button {
padding: var(--spacing-unit);
margin-top: var(--spacing-unit);
width: 100%;
border: none;
border-radius: var(--border-radius);
color: white;
cursor: pointer;
font-size: var(--button-font-size);
transition: background-color .2s ease, transform .1s ease;
height: var(--button-size);
display: flex;
align-items: center;
justify-content: center;
gap: 8px
}
button:hover {
opacity: .9;
transform: translateY(-1px)
}
.calculate {
background: var(--primary-color)
}
.copy {
background: var(--success-color)
}
.add {
background: var(--info-color)
}
.clear {
background: var(--danger-color)
}
.route-back {
background: #6f42c1
}
.greeting-container {
background: var(--surface-color);
border-radius: var(--border-radius);
padding: var(--spacing-unit);
margin-bottom: var(--spacing-unit);
box-shadow: 0 1px 3px rgba(0, 0, 0, .1);
display: flex;
align-items: center;
gap: var(--spacing-unit);
flex-wrap: wrap
}
.greeting-container select {
width: 35%;
padding: var(--small-spacing);
border: 1px solid #ddd;
border-radius: 4px;
font-size: 1em;
box-sizing: border-box
}
.greeting-container .edit-greeting-btn,
.greeting-container .start-point-coords {
width: 24px;
height: 24px;
background: transparent;
border: none;
border-radius: 4px;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
flex-shrink: 0;
line-height: 1;
padding: 0;
color: var(--text) !important;
transform: translateY(-5px);
}
.participant {
background: var(--surface-color);
border-radius: var(--border-radius);
padding: var(--spacing-unit);
margin-bottom: var(--spacing-unit);
display: flex;
align-items: center;
gap: var(--spacing-unit);
flex-wrap: wrap;
box-shadow: 0 1px 3px rgba(0, 0, 0, .1)
}
.participant select,
.participant input[type=text] {
flex: 1;
min-width: 35%;
max-width: 35%;
padding: var(--small-spacing);
border: 1px solid var(--border, #ddd);
border-radius: 4px;
font-size: 1em;
box-sizing: border-box;
background: var(--surface);
color: var(--text)
}
.participant input[type=number] {
width: 50px;
padding: var(--small-spacing);
border: 1px solid #ddd;
border-radius: 4px;
font-size: 1em;
text-align: center
}
.time-display {
min-width: 35px;
max-width: 35px;
padding: 6px 10px;
border: 2px solid var(--border);
border-radius: 4px;
font-size: 0.95em;
text-align: center;
background: var(--surface);
color: var(--text);
cursor: pointer;
transition: all 0.2s;
user-select: none;
white-space: nowrap;

}
.time-display:hover {
border-color: var(--primary-color);
background: rgba(0, 123, 255, 0.05);
}
.time-display.auto-calculated {
border-color: #ffc107;
}
.time-display.auto-calculated:hover {
border-color: #ff9800;
}
.time-display.editing {
display: none;
}
.participant .right-section {
margin-left: auto;
display: flex;
gap: var(--small-spacing);
align-items: center;
justify-content: flex-end;
min-height: 32px;
}
.participant .remove-btn {
width: 20px;
height: 20px;
background: var(--danger-color);
color: white;
border: none;
border-radius: 4px;
font-size: 16px;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
flex-shrink: 0;
line-height: 1;
padding: 0;
transform: translate(5px, -18px);
}
.participant .remove-btn::before {
  content: "‚úñ";
  position: relative;
  top: -1px;
}
/* –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ */
.add-sub-btn {
width: 22px;
height: 22px;
background: var(--primary-color);
color: white;
border: none;
border-radius: 50%;
cursor: pointer;
font-size: 16px;
font-weight: bold;
line-height: 1;
transition: all 0.2s;
display: flex;
align-items: center;
justify-content: center;
flex-shrink: 0;
transform: translateY(-5px);
}
.add-sub-btn:hover {
background: #0056b3;
transform: translateY(-5px) scale(1.1);
}
/* –ì—Ä—É–ø–ø–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ */
.participant-group {
margin-bottom: var(--spacing-unit);
}
.participant.main-participant {
margin-bottom: 0;
}
/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ */
.sub-participant {
background: var(--surface);
border-left: 3px solid var(--primary-color);
border-radius: var(--border-radius);
padding: 8px var(--spacing-unit);
margin-left: 30px;
margin-top: 4px;
display: flex;
align-items: center;
gap: 8px;
box-shadow: 0 1px 2px rgba(0, 0, 0, .05);
}
.sub-participant select {
flex: 1;
min-width: 35%;
max-width: 35%;
padding: var(--small-spacing);
border: 1px solid #ddd;
border-radius: 4px;
font-size: 1em;
box-sizing: border-box;
background: var(--surface);
color: var(--text);
}

/* –∫—Ä–µ—Å—Ç–∏–∫ —É–¥–∞–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ */
.sub-participant .remove-sub-btn {
width: 24px;
height: 24px;
background: transparent;
color: var(--danger-color);
border: none;
border-radius: 4px;
font-size: 14px;
font-weight: 700;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
flex-shrink: 0;
line-height: 1;
padding: 0;
align-self: flex-start;
transform: translate(5px, -10px);
margin-left: auto;
opacity: .7;
transition: opacity .15s, transform .12s;
}
.sub-participant .remove-sub-btn::before {
  content: "‚úñ";
}
.sub-participant .remove-sub-btn:hover {
background: transparent;
opacity: 1;
transform: translate(5px, -10px) scale(1.2);
}
.sub-participant .drag-handle-sub {
cursor: grab;
color: #999;
font-size: 16px;
user-select: none;
}
/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (Treffpunkt / Kollege) */
.add-type-modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.5);
backdrop-filter: blur(4px);
z-index: 10000;
}
.add-type-modal.show {
display: flex;
align-items: center;
justify-content: center;
}
.add-type-modal-content {
background: var(--surface);
border-radius: 12px;
padding: 24px;
max-width: 400px;
width: 90%;
box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
animation: slideUp 0.3s ease;
}
.add-type-modal-title {
font-size: 1.2em;
font-weight: 600;
margin-bottom: 20px;
color: var(--text);
text-align: center;
}
.add-type-section {
margin-bottom: 16px;
}
.add-type-section-label {
font-size: 0.85em;
font-weight: 600;
color: var(--info-color);
text-transform: uppercase;
letter-spacing: 0.5px;
margin-bottom: 6px;
}
.add-type-select {
width: 100%;
padding: 10px;
border: 2px solid var(--border, #ddd);
border-radius: 8px;
font-size: 1em;
background: var(--surface);
color: var(--text);
cursor: pointer;
transition: border-color 0.2s;
}
.add-type-select:focus {
outline: none;
border-color: var(--primary-color);
}
.add-type-buttons {
display: flex;
gap: 8px;
margin-top: 20px;
}
.add-type-btn {
flex: 1;
padding: 10px;
border: none;
border-radius: 8px;
font-size: 0.95em;
cursor: pointer;
transition: all 0.2s;
}
.add-type-btn.primary {
background: var(--primary-color);
color: white;
}
.add-type-btn.primary:hover { background: #0056b3; }
.add-type-btn.secondary {
background: var(--border, #ddd);
color: var(--text);
}
.add-type-btn.secondary:hover { background: #bbb; }
/* –£—á–∞—Å—Ç–Ω–∏–∫ —Å Treffpunkt ‚Äî –ø–æ–¥—Å–≤–µ—Ç–∫–∞ */
.participant.has-treffpunkt {
border-left: 3px solid #28a745;
}
/* –ü–æ–ª–µ –≤–≤–æ–¥–∞ –Ω–æ–≤–æ–≥–æ –∏–º–µ–Ω–∏ ‚Äî inline –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª–∫–∏ */
.new-name-row {
display: none;
margin-top: 8px;
flex-direction: column;
gap: 4px;
}
.new-name-row.visible {
display: flex;
}
.new-name-input {
width: 100%;
padding: 10px;
border: 2px solid var(--primary-color);
border-radius: 8px;
font-size: 1em;
background: var(--surface);
color: var(--text);
box-sizing: border-box;
transition: border-color 0.2s;
}
.new-name-input:focus {
outline: none;
border-color: #0056b3;
}
.new-name-hint {
font-size: 0.8em;
color: var(--info-color);
}
/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—É–±—É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ */
.sub-modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.5);
backdrop-filter: blur(4px);
z-index: 10000;
}
.sub-modal.show {
display: flex;
align-items: center;
justify-content: center;
}
.sub-modal-content {
background: var(--surface);
border-radius: 12px;
padding: 24px;
max-width: 400px;
width: 90%;
box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
animation: slideUp 0.3s ease;
}
.sub-modal-title {
font-size: 1.2em;
font-weight: 600;
margin-bottom: 16px;
color: var(--text);
}
.sub-modal-select {
width: 100%;
padding: 10px;
border: 2px solid var(--border);
border-radius: 8px;
font-size: 1em;
margin-bottom: 16px;
background: var(--surface);
color: var(--text);
}
.sub-modal-buttons {
display: flex;
gap: 8px;
}
.sub-modal-btn {
flex: 1;
padding: 10px;
border: none;
border-radius: 8px;
font-size: 0.95em;
cursor: pointer;
transition: all 0.2s;
}
.sub-modal-btn.primary {
background: var(--primary-color);
color: white;
}
.sub-modal-btn.primary:hover {
background: #0056b3;
}
.sub-modal-btn.secondary {
background: var(--border);
color: var(--text);
}
.sub-modal-btn.secondary:hover {
background: #bbb;
}

/* –∫—Ä–µ—Å—Ç–∏–∫ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏–±—ã—Ç–∏—è */
.time-remove {
width: 24px;
height: 24px;
background: transparent;
color: var(--danger-color);
border: none;
border-radius: 4px;
font-size: 16px;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
flex-shrink: 0;
line-height: 1;
transform: translateY(-5px);
margin-top: -17px;
margin-right: -7px;
}
.time-remove::before {
  content: "‚úñ";
  position: relative;
  top: -1px;
}
/* –∫—Ä–∞—Å–Ω—ã–µ –∫—Ä–µ—Å—Ç–∏–∫–∏ –í–°–ï–ì–î–ê */
.time-remove,
.remove-btn {
background: transparent !important;   /* —Ñ–æ–Ω –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π */
color: #dc3545 !important;            /* –∫—Ä–∞—Å–Ω—ã–π –∫—Ä–µ—Å—Ç–∏–∫ */
border: none !important;
border-radius: 4px;
cursor: pointer;
}

.arrival-time {
font-weight: bold;
cursor: pointer;
font-size: 1em;
display: flex;
align-items: center;
justify-content: center;
padding: var(--small-spacing);
border-radius: 4px;
line-height: 1;
background: var(--surface);
color: var(--text);
border: 2px solid var(--border);
padding: var(--small-spacing);
}
.time-icon,
.coords-icon,
.start-point-coords {
font-size: 24px;
width: 24px;
height: 24px;
border: none;
background: transparent;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
line-height: 1;
padding: 0;
transform: translateY(-5px)
}
.coords-icon svg {
width: 100%;
height: 100%
}
.start-point-coords svg {
width: 100%;
height: 100%
}
.calc-route-icon {
width: 24px;
height: 24px;
border: none;
background: transparent;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
padding: 0;
flex-shrink: 0;
transform: translateY(-5px);
transition: transform 0.2s ease;
}
.calc-route-icon:hover {
transform: translateY(-5px) scale(1.1);
}
.calc-route-icon:active {
transform: translateY(-5px) scale(0.95);
}
.calc-route-icon svg {
width: 22px;
height: 22px;
}
.material-symbols-outlined {
font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
font-size: 24px;
color: var(--info-color);
transform: translate(-15px, 0);
cursor: grab
}
input,
select {
font-size: 1em
}
pre {
background: var(--surface-color);
padding: var(--spacing-unit);
border-radius: var(--border-radius);
white-space: pre-wrap;
font-size: 1.1em;
margin-top: 15px;
min-height: 50px;
box-shadow: 0 1px 3px rgba(0, 0, 0, .1)
}
.toast {
position: fixed;
top: 16px;
left: 50%;
transform: translateX(-50%);
background: rgba(30,30,30,0.88);
color: white;
padding: 10px 22px;
border-radius: 24px;
font-size: 0.97em;
display: none;
z-index: 9999;
box-shadow: 0 4px 16px rgba(0,0,0,.25);
text-align: center;
white-space: nowrap;
}
/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–∞—Ä–æ–ª—è God Mode */
.god-modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.5);
backdrop-filter: blur(4px);
z-index: 10000;
animation: fadeIn 0.2s ease;
}
.god-modal.show {
display: flex;
align-items: center;
justify-content: center;
}
.god-modal-content {
background: var(--surface);
border-radius: 12px;
padding: 24px;
max-width: 320px;
width: 90%;
box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
animation: slideUp 0.3s ease;
}
.god-modal-title {
font-size: 1.2em;
font-weight: 600;
margin-bottom: 16px;
color: var(--text);
text-align: center;
}
.god-modal-input {
width: 100%;
padding: 12px;
border: 2px solid var(--border);
border-radius: 8px;
font-size: 1em;
box-sizing: border-box;
background: var(--surface);
color: var(--text);
margin-bottom: 16px;
transition: border-color 0.2s;
text-align: center;
letter-spacing: 2px;
font-family: monospace;
}
.god-modal-input:focus {
outline: none;
border-color: var(--primary-color);
}
.god-modal-input.error {
border-color: var(--danger-color);
animation: shake 0.4s;
}
.god-modal-buttons {
display: flex;
gap: 8px;
}
.god-modal-btn {
flex: 1;
padding: 12px;
border: none;
border-radius: 8px;
font-size: 0.95em;
cursor: pointer;
transition: all 0.2s;
}
.god-modal-btn.primary {
background: var(--primary-color);
color: white;
}
.god-modal-btn.primary:hover {
background: #0056b3;
transform: translateY(-1px);
}
.god-modal-btn.secondary {
background: var(--border);
color: var(--text);
}
.god-modal-btn.secondary:hover {
background: #bbb;
}
.god-loader {
display: inline-block;
width: 14px;
height: 14px;
border: 2px solid rgba(255,255,255,.3);
border-top-color: white;
border-radius: 50%;
animation: spin 0.6s linear infinite;
margin-left: 8px;
}
@keyframes fadeIn {
from { opacity: 0; }
to { opacity: 1; }
}
@keyframes slideUp {
from {
opacity: 0;
transform: translateY(20px);
}
to {
opacity: 1;
transform: translateY(0);
}
}
@keyframes shake {
0%, 100% { transform: translateX(0); }
25% { transform: translateX(-10px); }
75% { transform: translateX(10px); }
}
@keyframes spin {
to { transform: rotate(360deg); }
}
.sortable-ghost {
opacity: .2;
background: #c8ebfb
}
.button-container {
display: flex;
flex-direction: row;
gap: 6px;
margin-top: var(--spacing-unit);
flex-wrap: nowrap
}
.button-container button {
flex: 1;
margin-top: 0;
padding: var(--small-spacing) 8px;
font-size: .8em;
min-width: 60px
}
.button-container .add {
grid-column: span 2
}
.modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, .5);
z-index: 1000;
justify-content: center;
align-items: center
}
.modal-content {
background: var(--surface-color);
padding: 20px;
border-radius: var(--border-radius);
box-shadow: 0 2px 8px rgba(0, 0, 0, .2);
max-width: 300px;
width: 100%;
text-align: center;
border: 1px solid var(--border);
transition: transform .2s ease
}
.modal-content.add-new-name {
background: linear-gradient(135deg, #f0f8ff 0%, #e6f0fa 100%);
padding: 25px;
box-shadow: 0 4px 12px rgba(0, 0, 0, .3);
transform: scale(1.02)
}
.modal-content.add-new-name h3 {
font-size: 1.4em;
color: #1a3c6d;
margin-bottom: 15px
}
.modal-content.add-new-name label {
font-size: 1.1em;
color: #1a3c6d;
font-weight: 500
}
.modal-content input[type=text] {
width: 100%;
padding: 8px;
margin: 8px 0;
border: 1px solid #b0c4de;
border-radius: 4px;
font-size: 1em;
box-sizing: border-box
}
.modal-buttons {
display: flex;
flex-direction: row;
gap: var(--spacing-unit);
justify-content: center;
margin-top: var(--spacing-unit)
}
.modal-content button {
flex: 1;
max-width: 120px;
padding: 10px;
margin: 0;
border-radius: 4px;
font-size: 1em;
color: white;
border: none;
cursor: pointer;
transition: background-color .2s ease, transform .1s ease
}
.modal-content button:hover {
transform: translateY(-1px)
}
.modal-content .save-button {
background: var(--success-color)
}
.modal-content .cancel-button {
background: var(--info-color)
}
.modal-content .delete-greeting-btn {
background: var(--danger-color)
}
.modal-content .map-button {
display: block;
margin-left: auto;
margin-right: auto;
margin-top: var(--spacing-unit);
margin-bottom: var(--spacing-unit);
background: var(--primary-color);
}
#mapBtnsRow .map-button,
#mapBtnsRow .modal-btn {
width: 52px;
height: 40px;
min-width: 0;
padding: 0;
margin: 0;
font-size: 20px;
display: flex;
align-items: center;
justify-content: center;
border-radius: var(--border-radius, 6px);
}
#mapBtnsRow #openMap {
background: var(--info-color, #607d8b) !important;
}
#mapBtnsRow #cancelCoords {
background: var(--danger-color, #e53935) !important;
color: #fff !important;
font-weight: 900;
font-size: 22px;
}
#result {
font-family: Arial, sans-serif;
font-size: 16px;
line-height: 1.5;
margin: 10px 0;
white-space: pre-wrap
}
#result sup {
font-size: .7em;
vertical-align: super
}
.checkbox-container {
display: flex;
gap: var(--small-spacing);
margin-top: var(--spacing-unit);
justify-content: flex-end;
}
/* /* ----------  –°–í–ï–¢–õ–ê–Ø (—É–∂–µ –µ—Å—Ç—å) ---------- */
:root {
--bg: #f0f0f0;
--text: #333333;
--surface: #ffffff;
--border: #cccccc;
/*–∫–Ω–æ–ø–∫–∏ */
--primary-color: #007bff;
--success-color: #28a745;
--info-color: #6c757d;
--danger-color: #dc3545;
--route-back-color: #6f42c1;
}
body.dark {
--bg: #121212;
--surface: #1e1e1e;
--text: #e1e1e1;
--border: #333333;
/* –∫–Ω–æ–ø–∫–∏ */
--primary-color: #007bff;
--success-color: #28a745;
--info-color: #6c757d;
--danger-color: #dc3545;
--route-back-color: #6f42c1;
/* –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ*/
--modal-bg: #121212;   /* —Ç—ë–º–Ω–æ-—Å–µ—Ä—ã–π –Ω–æ—á—å—é */
--modal-text: #fff;
}
body.dark .participant.machine {
background: var(--surface);
border-color: var(--border);
}
/* –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ ¬´–ø–æ–∫—Ä–∞—Å–∏—Ç—å¬ª –≤—Å—ë, —á—Ç–æ –±—ã–ª–æ –±–µ–ª—ã–º/—Å–µ—Ä—ã–º */
body {
background: var(--bg) !important;
color: var(--text) !important;
}
/* –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, –∫–∞—Ä—Ç–æ—á–∫–∏, –º–æ–¥–∞–ª–∫–∏, –ø–æ–ª—è –≤–≤–æ–¥–∞ */
.greeting-container,
.participant,
pre,
input,
select {
background: var(--surface) !important;
color: var(--text) !important;
border-color: var(--text) !important;
}
/* –∫–Ω–æ–ø–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç —Ü–≤–µ—Ç, –Ω–æ —Ç–µ–∫—Å—Ç –ø–µ—Ä–µ–∫—Ä–∞—à–∏–≤–∞–µ–º/* –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–æ–∫—Ä–∞—Å–∏—Ç—å —Å–∞–º–∏ –∫–Ω–æ–ø–∫–∏ */
button.calculate { background: var(--primary-color) !important; }
button.copy       { background: var(--success-color) !important; }
button.add        { background: var(--info-color) !important; }
button.clear      { background: var(--danger-color) !important; }
button.route-back { background: var(--route-back-color) !important; }
/* –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ –º–µ—Å—Ç–µ */
.theme-toggle {
position: fixed;
top: 10px;
right: 10px;
z-index: 999;
}
.theme-toggle input { display: none; }
.theme-toggle span {
cursor: pointer;
font-size: 24px;
user-select: none;
/* –∂—ë—Å—Ç–∫–æ —Ç—ë–º–Ω—ã–π —Ñ–æ–Ω –∏ —Å–≤–µ—Ç–ª—ã–π —Ç–µ–∫—Å—Ç */
body.dark pre#output {
background: #1e1e1e !important;
color: #e1e1e1 !important;
border: 1px solid #333 !important;
border-radius: 6px !important;
padding: 10px !important;
margin: 0 !important;
}
/* —Ü–≤–µ—Ç–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –º–æ–¥–∞–ª–∫–∏ ‚Äì –≤—Å–µ–≥–¥–∞ —Å–≤–æ–∏ */
.modal-btn                       { color: #fff !important; border: none !important; }
.modal-btn.save-button           { background: var(--success-color) !important; }
.modal-btn.cancel-button         { background: var(--info-color)    !important; }
.modal-btn.map-button            { background: var(--primary-color) !important; }
.modal-btn.delete-greeting-btn   { background: var(--danger-color)  !important; }
/* —Ñ–æ–Ω –º–æ–¥–∞–ª–∫–∏ ‚Äì –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å —Ç–µ–º–æ–π */
.modal-content                   { background: #aaaaaa !important; color: #000 !important; }
body.dark .modal-content        { background: #444444 !important; color: #fff !important
;
border: 1px solid #666 !important;
}
/* —Ü–≤–µ—Ç –∫–∞—Ä–∞–Ω–¥–∞—à–∞ ‚Äì –≤–º–µ—Å—Ç–µ —Å —Ç–µ–º–æ–π */
.pencil-icon {
width: 18px;
height: 18px;
fill: var(--text) !important;   /* –±—É–¥–µ—Ç —á—ë—Ä–Ω—ã–º –¥–Ω—ë–º, –±–µ–ª—ã–º –Ω–æ—á—å—é */
}
.god-mode{
position:fixed;
inset:0 auto auto 0;
margin:4px;
z-index:9999;
background:none;
padding:4px;
cursor:pointer;
}
</style>
</head>
<body>
<main>
<h2>Fahrzeit Rechner</h2>
<!-- –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã (—É–∂–µ –µ—Å—Ç—å) -->
<label class="theme-toggle">
<input type="checkbox" id="themeSwitch">
<span>üåô</span>
</label>
<!-- ‚õ≥ –†–ï–ñ–ò–ú –ë–û–ì–ê -->
<a id="godL" href="redaktor.html"
style="position:fixed; inset:1px auto auto 3px; margin:4px; z-index:9999; background:none; padding:4px; cursor:pointer;color:var(--text);"
title="–†–µ–∂–∏–º –ë–æ–≥–∞">
<svg width="32" height="32" viewBox="0 0 374 383" xmlns="http://www.w3.org/2000/svg">
<g transform="translate(0,383) scale(0.085,-0.085)" fill="currentColor" stroke="none">
<path d="M144 3732 c-87 -5 -83 17 -84 -427 l-2 -390 28 -24 28 -23 27 30 28 31 1 338 c0 185 3 339 6 342 3 3 159 6 346 6 l340 0 19 24 c20 25 18 54 -5 79 -9 9 -91 13 -347 15 -184 1 -357 1 -385 -1z"/>
<path d="M2920 3730 c-57 -4 -66 -8 -79 -32 -12 -20 -13 -31 -4 -51 15 -32 79 -42 194 -32 44 4 181 4 305 0 l224 -7 0 -337 c0 -185 3 -346 6 -358 8 -29 49 -38 80 -18 l24 15 0 394 c0 367 -1 394 -18 409 -16 15 -58 17 -343 19 -178 2 -353 1 -389 -2z"/>
<path d="M1850 3459 c-63 -4 -149 -9 -192 -11 -42 -1 -74 -5 -72 -8 4 -3 -138 -38 -173 -42 -7 -1 -11 -4 -11 -7 1 -3 -2 -14 -6 -23 -12 -28 -2 -62 22 -74 17 -8 41 -7 105 7 142 31 248 40 387 36 141 -5 192 -10 250 -26 123 -33 165 -30 176 14 11 44 -17 72 -86 86 -33 6 -58 14 -56 18 2 3 -19 7 -46 8 -28 1 -58 5 -67 9 -9 4 -27 6 -41 5 -14 -1 -37 2 -50 6 -14 5 -77 6 -140 2z"/>
<path d="M1725 3199 c-38 -4 -112 -17 -163 -29 -51 -12 -101 -23 -110 -25 -9 -2 -19 -4 -22 -5 -3 -1 -8 -2 -12 -1 -5 0 -8 -4 -8 -9 0 -5 -9 -10 -19 -10 -11 0 -23 -5 -26 -11 -4 -6 -13 -8 -20 -5 -8 3 -19 -2 -25 -9 -7 -8 -15 -14 -18 -13 -4 1 -17 -3 -29 -10 -13 -7 -23 -10 -23 -7 0 3 -6 1 -12 -5 -24 -20 -133 -83 -145 -83 -7 0 -11 -3 -8 -5 3 -3 -19 -21 -48 -40 -28 -20 -55 -40 -59 -46 -5 -7 -8 -7 -8 -1 0 15 -40 -54 -40 -70 0 -7 12 -23 26 -34 32 -25 49 -19 138 48 37 28 74 51 82 51 7 0 14 4 14 8 0 12 76 53 84 45 3 -3 6 0 6 7 0 7 3 11 6 7 4 -3 13 1 21 9 8 8 19 12 24 9 5 -4 9 -2 9 3 0 7 28 19 90 37 3 1 16 6 30 12 14 6 41 14 60 19 19 4 37 8 40 9 77 22 124 27 308 34 179 6 192 10 192 51 0 40 -13 60 -44 65 -47 9 -212 11 -291 4z"/>
<path d="M2160 3152 c-14 -9 -26 -27 -28 -40 -4 -23 25 -78 35 -68 3 3 21 -1 39 -9 19 -8 34 -11 34 -8 0 3 6 1 13 -5 7 -6 28 -14 46 -17 18 -3 47 -13 65 -22 17 -10 33 -17 36 -18 15 -1 70 -28 70 -34 0 -4 15 -12 33 -19 18 -7 42 -20 53 -29 10 -10 31 -24 45 -31 15 -8 37 -24 50 -36 68 -61 105 -67 135 -21 13 19 13 28 3 47 -14 27 -56 68 -69 68 -5 0 -15 8 -22 19 -7 10 -17 18 -21 19 -5 0 -20 9 -33 21 -13 11 -26 21 -29 21 -3 -1 -26 11 -51 26 -50 29 -218 104 -234 104 -6 0 -10 4 -10 8 0 5 -6 9 -12 9 -16 1 -88 19 -108 27 -8 3 -26 -2 -40 -12z"/>
<path d="M1839 2945 c-2 -1 -40 -4 -84 -6 -44 -1 -84 -6 -90 -10 -5 -4 -30 -9 -55 -12 -25 -3 -63 -12 -85 -20 -22 -9 -49 -17 -60 -19 -11 -2 -23 -7 -26 -11 -3 -4 -15 -9 -27 -10 -11 0 -18 -5 -16 -9 3 -4 0 -8 -6 -8 -13 0 -173 -79 -180 -89 -3 -4 -12 -10 -22 -14 -25 -9 -33 -63 -14 -92 20 -31 65 -33 91 -5 10 11 22 17 26 14 5 -3 9 -1 9 4 0 5 32 26 70 46 39 21 70 34 70 31 0 -3 10 0 23 7 12 6 27 13 32 15 6 1 29 9 52 17 23 9 57 18 75 21 18 3 51 10 73 15 44 10 318 8 378 -3 21 -4 54 -14 73 -22 19 -8 34 -12 34 -10 0 3 25 -6 56 -20 31 -14 63 -25 70 -25 8 0 14 -5 14 -11 0 -5 4 -8 9 -4 5 3 15 0 23 -7 7 -7 35 -24 61 -38 26 -13 47 -28 47 -32 0 -5 6 -8 13 -8 14 0 53 -31 125 -97 49 -46 79 -53 105 -25 33 37 22 67 -55 142 -40 38 -78 70 -85 70 -7 0 -13 5 -13 10 0 6 -7 10 -15 10 -8 0 -15 4 -15 10 0 5 -11 12 -25 16 -14 3 -25 10 -25 14 0 4 -8 10 -17 14 -10 3 -33 15 -50 26 -18 11 -33 18 -33 15 0 -2 -25 7 -55 21 -31 13 -62 24 -70 24 -8 0 -15 5 -15 11 0 5 -4 8 -10 4 -5 -3 -17 -1 -27 4 -16 9 -70 20 -168 36 -45 7 -182 15 -186 10z"/>
<path d="M1758 2685 c-2 -2 -21 -6 -43 -9 -88 -13 -110 -18 -116 -28 -3 -5 -9 -9 -13 -9 -27 5 -191 -67 -237 -103 -14 -12 -40 -32 -59 -46 -18 -14 -39 -31 -46 -37 -7 -7 -14 -13 -17 -13 -7 0 -131 -125 -129 -131 0 -3 -14 -23 -32 -43 -19 -20 -32 -36 -29 -36 2 0 -8 -17 -22 -37 -14 -21 -25 -47 -25 -59 0 -39 53 -68 87 -46 7 4 30 35 51 67 54 83 130 165 216 229 330 248 736 239 1071 -25 65 -51 153 -151 191 -214 46 -79 104 -200 104 -217 0 -9 4 -27 9 -40 15 -39 32 -102 35 -130 6 -60 65 -88 101 -48 20 22 17 62 -15 183 -10 39 -17 75 -14 79 3 4 1 8 -4 8 -9 0 -54 107 -51 124 0 5 -4 12 -9 15 -14 9 -65 94 -65 108 0 7 -2 11 -5 8 -7 -7 -61 67 -62 84 0 8 -2 12 -5 9 -6 -6 -135 122 -135 134 0 5 -4 6 -10 3 -5 -3 -10 -1 -10 4 0 6 -6 11 -14 11 -8 0 -16 3 -18 8 -6 14 -76 61 -82 55 -3 -4 -6 -2 -6 4 0 10 -39 31 -130 71 -19 9 -39 17 -45 18 -5 1 -37 10 -70 19 -33 9 -71 18 -85 21 -28 5 -258 13 -262 9z"/>
<path d="M989 2559 c-43 -44 -79 -84 -79 -89 0 -6 -9 -15 -20 -22 -11 -7 -20 -17 -20 -21 0 -5 -18 -34 -40 -66 -22 -31 -40 -62 -40 -69 0 -7 -5 -12 -10 -12 -6 0 -10 -3 -9 -7 2 -16 -14 -53 -23 -53 -5 0 -6 -4 -3 -10 3 -5 1 -10 -4 -10 -6 0 -10 -3 -9 -7 1 -5 -2 -19 -6 -33 -4 -14 -2 -38 3 -53 8 -21 17 -27 39 -27 35 0 52 19 81 84 34 79 130 215 208 297 53 55 74 85 77 108 2 17 -1 31 -6 31 -5 0 -7 4 -4 9 3 5 -8 14 -25 20 -29 10 -33 8 -110 -70z"/>
<path d="M2745 2444 c-18 -34 -18 -36 0 -67 10 -18 22 -34 25 -37 16 -11 79 -118 73 -124 -4 -3 -1 -6 6 -6 7 0 10 -4 7 -9 -4 -5 -2 -11 3 -13 5 -1 20 -25 33 -53 20 -43 28 -50 55 -53 25 -3 35 2 48 22 16 24 16 28 -1 72 -9 25 -41 86 -70 134 -28 49 -49 92 -45 96 3 4 0 4 -6 0 -7 -4 -13 -3 -13 2 0 15 -62 72 -79 72 -9 0 -25 -16 -36 -36z"/>
<path d="M1768 2419 c-43 -16 -49 -87 -8 -109 10 -5 58 -9 106 -9 87 1 129 -4 169 -21 11 -4 42 -16 68 -25 102 -36 253 -163 299 -249 6 -11 14 -23 18 -26 14 -10 68 -136 86 -200 33 -118 23 -379 -23 -595 -8 -38 -17 -81 -19 -95 -12 -63 -68 -263 -95 -340 -70 -193 -70 -195 -60 -223 8 -20 17 -27 38 -27 39 0 49 9 72 62 67 157 146 446 187 683 22 129 27 192 27 325 1 186 -13 257 -76 394 -20 41 -32 78 -29 82 4 4 2 5 -3 1 -11 -6 -72 82 -67 96 1 5 -2 6 -8 2 -5 -3 -10 -2 -10 4 0 12 -69 77 -135 127 -27 21 -53 43 -57 48 -4 6 -8 8 -8 4 0 -4 -30 9 -67 29 -38 20 -68 35 -68 34 0 -4 -59 11 -70 18 -27 15 -230 23 -267 10z"/>
<path d="M1558 2360 c-2 -3 -32 -22 -68 -41 -36 -20 -92 -61 -125 -92 -33 -31 -63 -57 -67 -57 -5 0 -8 -4 -8 -10 0 -10 -20 -37 -52 -71 -9 -9 -19 -26 -23 -38 -3 -12 -11 -21 -17 -21 -6 0 -9 -3 -6 -6 3 -3 -9 -38 -28 -78 -39 -86 -53 -134 -65 -236 -25 -207 -32 -246 -60 -341 -17 -57 -33 -108 -37 -114 -4 -5 -7 -14 -8 -20 -1 -5 -9 -27 -17 -48 -9 -20 -17 -41 -18 -45 0 -4 -16 -37 -35 -73 -44 -85 -44 -112 0 -136 34 -19 56 -3 92 68 99 198 184 485 184 625 0 147 84 354 187 459 33 33 70 68 84 78 13 9 33 24 44 32 11 9 41 28 66 44 39 24 47 35 51 64 2 20 1 34 -2 32 -6 -4 -30 21 -25 27 3 2 -7 4 -20 4 -14 0 -26 -3 -27 -6z"/>
<path d="M1790 2163 c-79 -15 -199 -69 -241 -109 -14 -13 -31 -24 -38 -24 -7 0 -10 -4 -7 -9 3 -5 -12 -25 -34 -45 -22 -20 -37 -36 -33 -36 5 0 1 -6 -7 -13 -19 -15 -53 -86 -75 -152 -9 -27 -21 -101 -26 -164 -6 -63 -19 -151 -30 -195 -11 -45 -21 -88 -23 -96 -15 -61 -30 -107 -39 -119 -7 -8 -11 -17 -10 -20 6 -14 -35 -117 -100 -249 -57 -117 -68 -146 -56 -153 28 -19 68 -39 79 -39 13 0 128 239 173 360 50 134 96 318 108 430 16 153 29 210 60 274 37 74 77 120 152 169 114 76 217 93 330 57 40 -13 86 -33 102 -44 46 -31 125 -108 125 -122 0 -7 3 -14 8 -16 15 -7 51 -96 68 -167 15 -70 15 -159 0 -262 -2 -13 -10 -61 -17 -106 -10 -68 -10 -87 0 -107 19 -34 47 -39 76 -13 20 18 28 40 40 117 25 156 30 333 11 413 -17 70 -62 171 -102 223 -13 17 -21 34 -19 38 3 3 2 4 -2 1 -11 -8 -63 47 -56 59 3 6 3 8 -2 4 -4 -4 -25 6 -46 22 -59 48 -147 83 -234 94 -16 3 -37 6 -45 9 -8 3 -49 -2 -90 -10z"/>
<path d="M944 2019 c-36 -18 -78 -177 -94 -354 -9 -101 -28 -192 -66 -303 -22 -66 -19 -100 11 -114 48 -22 67 -1 103 108 39 122 62 230 62 293 0 60 15 146 42 239 20 69 20 75 5 108 -17 35 -28 39 -63 23z"/>
<path d="M1790 1900 c-44 -12 -67 -28 -123 -82 -38 -36 -68 -69 -68 -72 1 -4 -5 -30 -13 -59 -8 -28 -17 -88 -20 -132 -4 -44 -15 -120 -26 -170 -11 -49 -22 -103 -26 -118 -16 -77 -103 -308 -166 -437 -39 -80 -73 -147 -77 -150 -14 -10 -33 -69 -29 -91 2 -13 15 -30 30 -38 24 -14 28 -14 48 4 49 44 163 274 236 474 62 169 123 449 124 566 0 22 9 58 19 80 74 161 286 142 343 -30 17 -50 56 -69 88 -40 25 23 25 61 1 118 -11 25 -18 48 -15 51 2 3 1 4 -2 2 -9 -7 -60 56 -56 69 2 5 0 7 -4 3 -3 -4 -18 2 -32 13 -25 19 -119 51 -157 53 -11 1 -45 -6 -75 -14z"/>
<path d="M1827 1632 c-10 -10 -17 -33 -17 -50 0 -49 -28 -227 -51 -322 -22 -93 -68 -249 -77 -265 -4 -5 -8 -19 -9 -30 -2 -10 -10 -30 -18 -42 -9 -13 -13 -23 -11 -23 3 0 -8 -32 -25 -71 -16 -40 -29 -80 -29 -90 0 -26 28 -49 60 -49 25 0 32 7 53 53 98 209 195 562 213 775 6 67 4 86 -10 107 -20 30 -56 33 -79 7z"/>
<path d="M2795 1614 c-14 -10 -20 -41 -31 -153 -16 -173 -37 -299 -76 -465 l-30 -128 26 -26 c25 -26 28 -26 54 -12 22 13 31 31 50 100 58 218 106 601 83 658 -14 34 -49 46 -76 26z"/>
<path d="M2062 1514 c-7 -8 -24 -78 -38 -156 -13 -79 -30 -161 -36 -183 -6 -22 -13 -49 -15 -60 -2 -11 -9 -36 -15 -55 -7 -19 -13 -37 -13 -40 -17 -65 -29 -101 -36 -106 -5 -3 -9 -14 -9 -24 0 -17 -45 -130 -90 -225 -10 -22 -30 -66 -44 -98 -14 -32 -32 -65 -41 -74 -25 -25 -16 -94 14 -110 17 -8 31 -9 42 -2 23 12 76 107 141 251 141 314 262 827 208 879 -19 18 -52 20 -68 3z"/>
<path d="M2244 1132 c-15 -10 -35 -49 -40 -80 -6 -31 -64 -222 -73 -237 -3 -5 -6 -16 -7 -23 -2 -8 -6 -21 -10 -30 -4 -9 -9 -26 -11 -37 -2 -10 -7 -22 -11 -25 -4 -3 -8 -12 -10 -20 -2 -8 -23 -60 -47 -115 -56 -129 -58 -139 -31 -163 33 -30 66 -15 98 43 41 76 142 335 182 471 38 127 44 179 23 204 -14 17 -47 24 -63 12z"/>
<path d="M83 947 l-22 -12 -1 -365 c0 -201 -1 -372 -2 -380 -4 -47 3 -67 27 -78 18 -9 138 -12 400 -12 367 0 375 0 396 21 15 15 19 28 14 47 -13 53 -3 52 -376 52 l-349 0 0 335 c0 184 0 337 0 340 0 3 -6 18 -14 33 -16 30 -39 37 -73 19z"/>
<path d="M3576 929 c-14 -24 -16 -71 -16 -367 l0 -340 -349 2 c-192 0 -348 -1 -346 -2 2 -2 -5 -12 -16 -23 -21 -21 -21 -57 0 -83 12 -14 56 -16 395 -16 329 0 385 2 404 16 l22 15 0 393 c0 422 0 425 -52 430 -19 2 -30 -4 -42 -25z"/>
<path d="M1491 568 c-36 -72 -39 -84 -28 -102 17 -25 59 -37 79 -22 24 17 78 120 78 148 0 31 -29 58 -62 58 -22 0 -31 -12 -67 -82z"/>
</g>
</svg>
</a>
<div class="greeting-container">
<select id="startPoint" aria-label="–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—É—é —Ç–æ—á–∫—É">
<option value="" disabled>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—É—é —Ç–æ—á–∫—É</option>
</select>
<button class="start-point-coords" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–∞—á–∞–ª—å–Ω–æ–π —Ç–æ—á–∫–∏"></button>
<select id="greeting" aria-label="–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ">
<option value="Moin zusammen" selected>Moin zusammen</option>
<option value="Hallo zusammen">Hallo zusammen</option>
<option value="Guten Morgen">Guten Morgen</option>
<option value="Guten Tag">Guten Tag</option>
<option value="add-new-greeting">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ</option>
</select>
<button class="edit-greeting-btn pencil-icon" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="18" height="18">
<path
d="M46.193 6.863a7.48 7.48 0 0 0-4.717 2.13L15.434 38.771S15.213 39.215 13.725 46.12c-.28-.074-.44-.204-.74-.267a1 1 0 0 0-.41 1.957c.305.064.452.186.73.262L11.799 55.045a1 1 0 0 0 1.38 1.125L20.553 52.9a1 1 0 0 0 .552-1.21s-.398-1.223-1.601-2.494c-.81-.855-2.192-1.688-3.883-2.404L17.113 39.9c.259-.3 20.274-23.473 25.815-29.52C47.764 5.267 55.893 14.152 52.834 17.424l-.022.023S33.986 38.92 27.871 46.266c-.79-1.355-1.806-2.557-2.826-3.433-.864-.742-1.162-.886-1.641-1.201L45.92 16.09a1 1 0 0 0-1.5-1.323L21.186 41.125a1 1 0 0 0 .24 1.521s1.084.645 2.316 1.703c1.232 1.058 2.549 2.529 3.022 3.945a1 1 0 0 0 1.722.317C33.662 42.3 54.262 18.827 54.295 18.79c3.881-4.151-1.668-11.392-7.387-11.9a7.55 7.55 0 0 0-1.715-.027zM15.203 48.752l1.035-4.795-4.527 1.998 4.492 2.797z"
stroke="currentColor" stroke-width="2" fill="currentColor" />
</svg>
</button>
</div>
<div id="participants"></div>
<div class="button-container">
<button class="add" title="Teilnehmer hinzuf√ºgen">
<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="#e3e3e3">
<path
d="M480-80Q319-217 239.5-334.5T160-552q0-150 96.5-239T480-880h20q10 0 20 2v81q-10-2-19.5-2.5T480-800q-101 0-170.5 69.5T240-552q0 71 59 162.5T480-186q122-112 181-203.5T720-552v-8h80v8q0 100-79.5 217.5T480-80Zm0-400q33 0 56.5-23.5T560-560q0-33-23.5-56.5T480-640q-33 0-56.5 23.5T400-560q0 33 23.5 56.5T480-480Zm0-80Zm240-80h80v-120h120v-80H800v-120h-80v120H600v80h120v120Z" />
</svg>
</button>
<button class="calculate" title="Berechnen">
<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="#e3e3e3">
<path
d="m226-559 78 33q14-28 29-54t33-52l-56-11-84 84Zm142 83 114 113q42-16 90-49t90-75q70-70 109.5-155.5T806-800q-72-5-158 34.5T492-656q-42 42-75 90t-49 90Zm178-65q-23-23-23-56.5t23-56.5q23-23 57-23t57 23q23 23 23 56.5T660-541q-23 23-57 23t-57-23Zm19 321 84-84-11-56q-26 18-52 32.5T532-299l33 79Zm313-653q19 121-23.5 235.5T708-419l20 99q4 20-2 39t-20 33L538-80l-84-197-171-171-197-84 167-168q14-14 33.5-20t39.5-2l99 20q104-104 218-147t235-24ZM157-321q35-35 85.5-35.5T328-322q35 35 34.5 85.5T327-151q-25 25-83.5 43T82-76q14-103 32-161.5t43-83.5Zm57 56q-10 10-20 36.5T180-175q27-4 53.5-13.5T270-208q12-12 13-29t-11-29q-12-12-29-11.5T214-265Z" />
</svg>
</button>
<button class="route-back" title="–ú–∞—Ä—à—Ä—É—Ç –Ω–∞–∑–∞–¥">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"
width="24px" height="24px" viewBox="0 0 256 256" xml:space="preserve">
<g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;"
transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)">
<path
d="M 77.612 90 H 12.388 c -0.829 0 -1.5 -0.672 -1.5 -1.5 V 36.637 H 1.5 c -0.642 0 -1.212 -0.408 -1.419 -1.015 c -0.208 -0.607 -0.006 -1.279 0.502 -1.671 l 43.5 -33.637 c 0.54 -0.418 1.295 -0.418 1.835 0 l 43.5 33.637 c 0.507 0.393 0.709 1.064 0.502 1.671 c -0.208 0.607 -0.778 1.015 -1.42 1.015 h -9.388 V 88.5 C 79.112 89.328 78.44 90 77.612 90 z M 13.888 87 h 62.225 V 35.137 c 0 -0.829 0.672 -1.5 1.5 -1.5 h 6.496 L 45 3.396 L 5.892 33.637 h 6.496 c 0.829 0 1.5 0.671 1.5 1.5 V 87 z"
style="stroke: #e3e3e3; stroke-width: 3; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: #e3e3e3; fill-rule: nonzero; opacity: 1;"
transform="matrix(1 0 0 1 0 0)" stroke-linecap="round" />
<path
d="M 45 81.51 L 30.514 64.449 C 27.603 61.019 26 56.657 26 52.169 c 0 -10.477 8.523 -19 19 -19 s 19 8.523 19 19 c 0 4.489 -1.603 8.851 -4.514 12.28 L 45 81.51 z M 45 36.169 c -8.822 0 -16 7.177 -16 16 c 0 3.778 1.35 7.45 3.801 10.339 L 45 76.875 l 12.199 -14.367 C 59.65 59.619 61 55.948 61 52.169 C 61 43.347 53.822 36.169 45 36.169 z M 45 60.264 c -4.795 0 -8.697 -3.901 -8.697 -8.696 c 0 -4.796 3.901 -8.697 8.697 -8.697 c 4.796 0 8.697 3.901 8.697 8.697 C 53.697 56.362 49.796 60.264 45 60.264 z M 45 45.87 c -3.141 0 -5.697 2.556 -5.697 5.697 c 0 3.141 2.556 5.696 5.697 5.696 c 3.142 0 5.697 -2.556 5.697 -5.696 C 50.697 48.426 48.142 45.87 45 45.87 z"
style="stroke: #e3e3e3; stroke-width: 3; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: #e3e3e3; fill-rule: nonzero; opacity: 1;"
transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
</g>
</svg>
</button>
<button class="copy" title="Kopieren" aria-label="Kopieren">
<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="#e3e3e3">
<path
d="M360-240q-33 0-56.5-23.5T280-320v-480q0-33 23.5-56.5T360-880h360q33 0 56.5 23.5T800-800v480q0 33-23.5 56.5T720-240H360Zm0-80h360v-480H360v480ZM200-80q-33 0-56.5-23.5T120-160v-560h80v560h440v80H200Zm160-240v-480 480Z" />
</svg>
</button>
<button class="clear" title="–°–±—Ä–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"
width="24px" height="24px" viewBox="0 0 256 256" xml:space="preserve">
<g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;"
transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)">
<path
d="M 7.288 48.34 c 0.061 0.04 0.129 0.068 0.193 0.105 c 0.18 0.105 0.363 0.201 0.559 0.277 c 0.093 0.036 0.19 0.06 0.286 0.089 c 0.175 0.053 0.351 0.098 0.535 0.127 c 0.049 0.008 0.094 0.028 0.144 0.034 C 9.164 48.99 9.322 49 9.481 49 c 0 0 0 0 0.001 0 c 0 0 0 0 0 0 c 0 0 0 0 0 0 c 0.267 0 0.531 -0.028 0.79 -0.08 c 0.154 -0.031 0.297 -0.086 0.443 -0.134 c 0.101 -0.033 0.206 -0.054 0.304 -0.094 c 0.162 -0.067 0.31 -0.158 0.46 -0.245 c 0.075 -0.043 0.156 -0.075 0.228 -0.124 c 0.217 -0.146 0.42 -0.311 0.604 -0.495 c 0 0 0 0 0 0 l 7.492 -7.492 c 1.562 -1.562 1.562 -4.095 0 -5.657 c -1.149 -1.149 -2.822 -1.445 -4.249 -0.903 c 4.535 -11.868 16.033 -20.322 29.475 -20.322 c 12.266 0 23.516 7.2 28.658 18.342 c 0.926 2.004 3.3 2.881 5.309 1.956 c 2.005 -0.926 2.881 -3.302 1.955 -5.308 C 74.503 14.478 60.403 5.455 45.027 5.455 c -17.837 0 -32.947 11.873 -37.859 28.129 c -1.224 -1.611 -3.48 -2.084 -5.247 -1.008 c -1.887 1.148 -2.486 3.609 -1.338 5.496 l 5.481 9.007 c 0.014 0.023 0.035 0.041 0.049 0.063 c 0.125 0.195 0.268 0.375 0.424 0.545 c 0.036 0.039 0.064 0.085 0.101 0.122 C 6.835 48.009 7.053 48.186 7.288 48.34 z"
style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill:#e3e3e3; fill-rule: nonzero; opacity: 1;"
transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
<path
d="M 89.416 51.929 l -5.48 -9.008 c -0.014 -0.023 -0.035 -0.04 -0.049 -0.063 c -0.125 -0.195 -0.268 -0.375 -0.424 -0.546 c -0.035 -0.039 -0.063 -0.084 -0.1 -0.121 c -0.197 -0.199 -0.415 -0.376 -0.65 -0.531 c -0.061 -0.04 -0.129 -0.067 -0.192 -0.104 c -0.18 -0.105 -0.364 -0.201 -0.56 -0.277 c -0.093 -0.036 -0.19 -0.06 -0.287 -0.089 c -0.174 -0.053 -0.35 -0.098 -0.534 -0.127 c -0.049 -0.008 -0.095 -0.028 -0.144 -0.034 c -0.07 -0.008 -0.138 0.003 -0.208 -0.001 C 80.697 41.021 80.611 41 80.519 41 c -0.082 0 -0.159 0.019 -0.239 0.024 c -0.121 0.007 -0.24 0.018 -0.36 0.036 c -0.172 0.026 -0.338 0.065 -0.503 0.113 c -0.105 0.03 -0.209 0.058 -0.312 0.097 c -0.178 0.067 -0.344 0.152 -0.509 0.243 c -0.082 0.045 -0.166 0.082 -0.245 0.133 c -0.237 0.153 -0.46 0.326 -0.659 0.524 c 0 0 -0.001 0.001 -0.001 0.001 l 0 0 l 0 0 l -7.492 7.492 c -1.562 1.562 -1.562 4.095 0 5.656 c 1.148 1.15 2.822 1.446 4.249 0.904 c -4.535 11.868 -16.033 20.321 -29.475 20.321 c -12.707 0 -24.117 -7.563 -29.068 -19.268 c -0.861 -2.034 -3.209 -2.988 -5.242 -2.125 c -2.035 0.86 -2.986 3.207 -2.126 5.242 c 6.206 14.671 20.508 24.151 36.436 24.151 c 17.831 0 32.937 -11.864 37.854 -28.111 c 0.774 1.015 1.96 1.574 3.176 1.574 c 0.708 0 1.426 -0.188 2.075 -0.584 C 89.966 56.276 90.565 53.816 89.416 51.929 z"
style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill:#e3e3e3; fill-rule: nonzero; opacity: 1;"
transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
</g>
</svg>
</button>
</div>
<pre id="output"></pre>
<div id="toast" class="toast"></div>

<!-- Add Type Modal: Treffpunkt oder Kollege -->
<div id="addTypeModal" class="add-type-modal">
<div class="add-type-modal-content">
<div class="add-type-modal-title">‚ûï Teilnehmer hinzuf√ºgen</div>
<div class="add-type-section">
<div class="add-type-section-label">üìç Treffpunkt (–ú–µ—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∏)</div>
<select id="treffpunktSelect" class="add-type-select">
<option value="">‚Äì Treffpunkt w√§hlen ‚Äì</option>
</select>
</div>
<div class="add-type-section">
<div class="add-type-section-label">üë§ Kollege (–ö–æ–ª–ª–µ–≥–∞)</div>
<select id="kollegeSelect" class="add-type-select">
<option value="">‚Äì Kollege w√§hlen ‚Äì</option>
</select>
<div class="new-name-row" id="newKollegeRow">
<input type="text" id="newKollegeName" class="new-name-input" placeholder="Neuer Name eingeben‚Ä¶" autocomplete="off" />
<span class="new-name-hint">Name wird gespeichert und zur Liste hinzugef√ºgt</span>
</div>
</div>
<div class="add-type-buttons">
<button class="add-type-btn secondary" id="addTypeCancelBtn">Abbrechen</button>
<button class="add-type-btn primary" id="addTypeConfirmBtn">Hinzuf√ºgen</button>
</div>
</div>
</div>

<!-- Sub-Participant Modal -->
<div id="subModal" class="sub-modal">
<div class="sub-modal-content">
<div class="sub-modal-title">‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∫ –ø–æ–µ–∑–¥–∫–µ</div>
<select id="subParticipantSelect" class="sub-modal-select">
<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞</option>
</select>
<div class="new-name-row" id="newSubNameRow">
<input type="text" id="newSubName" class="new-name-input" placeholder="Neuer Name eingeben‚Ä¶" autocomplete="off" />
<span class="new-name-hint">Name wird gespeichert und zur Liste hinzugef√ºgt</span>
</div>
<div class="sub-modal-buttons">
<button class="sub-modal-btn secondary" id="subCancelBtn">–û—Ç–º–µ–Ω–∞</button>
<button class="sub-modal-btn primary" id="subAddBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
</div>
</div>
</div>

<!-- God Mode Password Modal -->
<div id="godModal" class="god-modal">
<div class="god-modal-content">
<div class="god-modal-title">üîê –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞</div>
<input 
type="password" 
id="godPasswordInput" 
class="god-modal-input" 
placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
autocomplete="off"
/>
<div class="god-modal-buttons">
<button class="god-modal-btn secondary" id="godCancelBtn">–û—Ç–º–µ–Ω–∞</button>
<button class="god-modal-btn primary" id="godSubmitBtn">–í–æ–π—Ç–∏</button>
</div>
</div>
</div>
<div id="coordsModal" class="modal">
<div class="modal-content" id="modalContent"
style="background: var(--modal-bg, #fff) !important; color: var(--modal-text, #000) !important;">
<h3 id="modalTitle">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</h3>
<label id="nameLabel" style="display:none">–ò–º—è:</label>
<input type="text" id="nameInput" style="display:none" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" />
<label id="greetingLabel" style="display:none">–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ:</label>
<input type="text" id="greetingInput" style="display:none" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ" />
<label id="coordsLabel" style="display:none">–í–≤–µ–¥–∏—Ç–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã<br>(—à–∏—Ä–æ—Ç–∞,–¥–æ–ª–≥–æ—Ç–∞ –∏–ª–∏ URL Google
–ö–∞—Ä—Ç):</label>
<input type="text" id="coordsInput" style="display:none"
placeholder="51.452013,7.021455 –∏–ª–∏ https://maps.app.goo.gl/..." />
<p id="coordsHelp" style="display:none;color:#d32f2f;font-weight:bold">–°–æ–∫—Ä–∞—â—ë–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è
–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥.</p>
<select id="stationSelect" style="display:none; margin-top:6px; width:100%; padding:var(--small-spacing); border:1px solid #ddd; border-radius:4px; font-size:1em; box-sizing:border-box; background:var(--surface); color:var(--text);">
<option value="">‚Äì –í—ã–±—Ä–∞—Ç—å –∏–∑ —Å–ø–∏—Å–∫–∞ ‚Äì</option>
</select>
<div id="mapBtnsRow" style="display:none;gap:10px;justify-content:center;margin-top:20px;margin-bottom:4px;">
<button class="map-button" id="openMap" title="–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É">
<svg width="24" height="24" viewBox="0 0 90 90" fill="currentColor">
<path d="M89 79.382H1c-.355 0-.683-.188-.863-.494-.179-.306-.183-.685-.01-.994L15.174 49.373c.177-.315.511-.512.873-.512h22.326c.552 0 1 .447 1 1s-.448 1-1 1H17.534L2.705 77.382h84.59L72.466 50.86H50.728c-.553 0-1-.447-1-1s.447-1 1-1h22.325c.362 0 .696.196.873.512l15.947 28.521c.173.31.169.688-.011.994s-.778.484-1.132.484z" />
<path d="M45 60.554L30.514 43.493C27.603 40.063 26 35.701 26 31.213c0-10.477 8.523-19 19-19s19 8.523 19 19c0 4.489-1.603 8.851-4.514 12.28L45 60.554zM45 15.713c-8.28 0-15.016 6.736-15.016 15.016 0 3.778 1.35 7.45 3.801 10.339L45 45.875l12.199-14.367C59.65 38.619 61 34.948 61 31.169c0-8.822-7.177-16-16-16z" />
<path d="M45.024 35.998c-4.769 0-8.649-3.88-8.649-8.649s3.88-8.649 8.649-8.649 8.649 3.88 8.649 8.649-3.88 8.649-8.649 8.649zm0-15.298c-3.666 0-6.649 2.983-6.649 6.649s2.983 6.649 6.649 6.649 6.649-2.983 6.649-6.649-2.983-6.649-6.649-6.649z" />
<path d="M1 79.382c-.441 0-.845-.294-.965-.74-.143-.533.173-1.082.706-1.226l76.501-20.565c.531-.145 1.082.172 1.226.706.144.533-.173 1.082-.706 1.226L1.26 79.348c-.087.023-.175.034-.26.034z" />
<path d="M63.521 73.279c-.286 0-.569-.121-.767-.357l-7.332-8.733c-.355-.423-.301-1.054.123-1.408.423-.355 1.056-.301 1.408.123l7.332 8.733c.355.423.301 1.054-.123 1.408-.247.202-.476.279-.703.279z" />
<path d="M34.419 70.398c-.285 0-.568-.121-.766-.357L23.606 58.075c-.355-.423-.3-1.054.123-1.408.424-.354 1.054-.301 1.409.123l10.047 11.966c.355.423.3 1.054-.123 1.408-.247.202-.476.279-.703.279z" />
</svg>
</button>
<button class="map-button" id="openMapPicker" title="–í—ã–±—Ä–∞—Ç—å —Ç–æ—á–∫—É –Ω–∞ –∫–∞—Ä—Ç–µ">
<svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision" text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd" clip-rule="evenodd" viewBox="0 0 469 512.42" width="22" height="22" fill="currentColor"><path fill-rule="nonzero" d="M191.82 93.36c27.85 0 53.07 11.31 71.31 29.54 18.23 18.23 29.53 43.46 29.53 71.3 0 27.85-11.3 53.07-29.53 71.31-18.24 18.23-43.46 29.53-71.31 29.53-27.84 0-53.07-11.3-71.3-29.53-18.23-18.24-29.54-43.46-29.54-71.31 0-27.84 11.31-53.07 29.54-71.3 18.23-18.23 43.46-29.54 71.3-29.54zm210.56 289.21v17.66c0 4.16-3.48 7.63-7.62 7.63h-30.32v30.32c0 4.15-3.47 7.62-7.62 7.62h-17.67c-4.13 0-7.62-3.43-7.62-7.62v-30.32h-30.34c-4.14 0-7.6-3.43-7.6-7.63v-17.66c0-4.19 3.42-7.62 7.6-7.62h30.34v-30.32c0-4.2 3.43-7.62 7.62-7.62h17.67c4.19 0 7.62 3.48 7.62 7.62v30.32h30.32c4.2 0 7.62 3.53 7.62 7.62zM348 270.39c33.39 0 63.66 13.55 85.55 35.44l.61.65c21.53 21.84 34.84 51.85 34.84 84.91 0 33.4-13.55 63.68-35.45 85.58l-.65.61c-21.83 21.52-51.84 34.84-84.9 34.84-33.4 0-63.65-13.57-85.54-35.45-21.94-21.9-35.49-52.18-35.49-85.58 0-33.37 13.57-63.62 35.45-85.52 21.89-21.93 52.18-35.48 85.58-35.48zm69.05 51.95c-17.66-17.67-42.1-28.6-69.05-28.6-26.96 0-51.42 10.93-69.08 28.6-17.65 17.64-28.59 42.1-28.59 69.05 0 26.96 10.92 51.42 28.59 69.08 17.64 17.64 42.1 28.59 69.08 28.59 26.7 0 50.94-10.73 68.56-28.06l.49-.53c17.67-17.66 28.6-42.12 28.6-69.08 0-26.7-10.74-50.94-28.07-68.56l-.53-.49zM197.53 485.87c7.56-4.8 14.91-9.92 22.02-15.28a149.47 149.47 0 0 0 13.51 18.57c-9.26 6.93-18.87 13.49-28.85 19.57-3.7 2.74-8.88 3.08-13 .48-44.87-28.52-82.58-62.92-112.28-100.19C38.05 357.7 12.26 300.79 3.44 246.01c-8.96-55.55-.56-109.03 27.07-152.51C41.4 76.35 55.34 60.72 72.37 47.15 111.36 16.08 156-.37 200.29.01c42.69.35 84.97 16.28 121.48 49.6 12.8 11.7 23.59 24.97 32.37 39.46 26.56 43.85 34.52 98.6 26.54 154.99-7.4-1.63-14.96-2.72-22.72-3.23 7.27-51.33.26-100.76-23.43-139.87-7.6-12.52-17-24.08-28.24-34.34-32.14-29.32-69.08-43.36-106.2-43.65-38.97-.32-78.53 14.37-113.42 42.18C71.78 77 59.56 90.73 49.97 105.83c-24.52 38.59-31.92 86.5-23.85 136.6 8.19 50.88 32.39 104.07 70.81 152.29 26.78 33.59 60.51 64.79 100.6 91.15zm49.33-346.7c-14.06-14.06-33.55-22.81-55.04-22.81-21.48 0-40.97 8.75-55.03 22.81-14.06 14.06-22.81 33.55-22.81 55.03 0 21.49 8.75 40.98 22.81 55.04 14.06 14.06 33.55 22.8 55.03 22.8 21.49 0 40.98-8.74 55.04-22.8 14.06-14.06 22.8-33.55 22.8-55.04 0-21.48-8.74-40.97-22.8-55.03z"/></svg>
</button>
<button class="modal-btn save-button"   id="saveCoords"   title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å">‚úî</button>
<button class="modal-btn cancel-button" id="cancelCoords" title="–û—Ç–º–µ–Ω–∞">‚úï</button>
</div>
<div style="display:flex;justify-content:center;margin-top:8px;">
<button class="modal-btn delete-greeting-btn" id="deleteGreeting" title="–£–¥–∞–ª–∏—Ç—å">üóë –£–¥–∞–ª–∏—Ç—å</button>
</div>
</div>
</div>
<!-- ‚ïê‚ïê‚ïê MAP PICKER MODAL ‚ïê‚ïê‚ïê -->
<div id="mapPickerModal" class="modal" style="display:none;">
  <div id="mapPickerSheet" class="modal-content" style="
    max-width: 95vw; width: 600px; padding: 0;
    background: var(--modal-bg, #fff) !important;
    border-radius: 12px; overflow: hidden;
    transition: all .2s ease;
  ">
    <!-- –®–∞–ø–∫–∞ -->
    <div style="display:flex;align-items:center;justify-content:space-between;padding:10px 14px;background:var(--primary-color);color:#fff;">
      <span style="font-weight:600;font-size:1em;">üìç –í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Ç–æ –Ω–∞ –∫–∞—Ä—Ç–µ</span>
      <div style="display:flex;gap:6px;align-items:center;">
        <button id="mapFullscreenBtn" title="–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω" style="background:rgba(255,255,255,.15);border:none;color:#fff;border-radius:6px;padding:5px 9px;cursor:pointer;font-size:15px;">‚õ∂</button>
        <button id="mapPickerClose" style="background:none;border:none;color:#fff;font-size:22px;cursor:pointer;line-height:1;padding:0 2px;">‚úï</button>
      </div>
    </div>
    <!-- –ö–∞—Ä—Ç–∞ -->
    <div id="mapPickerContainer" style="width:100%;height:55vh;min-height:300px;"></div>
    <!-- –ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Å–Ω–∏–∑—É -->
    <div style="padding:8px 12px;display:flex;flex-wrap:wrap;gap:6px;align-items:center;background:var(--modal-bg,#fff);border-top:1px solid #e0e0e0;">
      <!-- –¢–∏–ø –∫–∞—Ä—Ç—ã -->
      <button id="mapTypeRoad" style="border:1px solid #ccc;background:#fff;border-radius:6px;padding:5px 10px;cursor:pointer;font-size:12px;font-weight:600;">üó∫ –°—Ö–µ–º–∞</button>
      <button id="mapTypeSat"  style="border:1px solid #ccc;background:#fff;border-radius:6px;padding:5px 10px;cursor:pointer;font-size:12px;font-weight:600;">üõ∞ –°–ø—É—Ç–Ω–∏–∫</button>
      <!-- –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è -->
      <button id="mapGeoBtn" title="–ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ" style="border:1px solid #ccc;background:#fff;border-radius:6px;padding:5px 10px;cursor:pointer;font-size:13px;">üì° –ú–æ—ë –º–µ—Å—Ç–æ</button>
      <!-- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã -->
      <span id="mapPickerCoords" style="flex:1;font-size:.82em;font-family:monospace;color:#555;text-align:right;min-width:120px;">‚Äî</span>
    </div>
    <!-- –ö–Ω–æ–ø–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
    <div style="padding:8px 12px;display:flex;gap:8px;justify-content:flex-end;background:var(--modal-bg,#fff);border-top:1px solid #eee;">
      <button id="mapPickerCancel"  class="modal-btn cancel-button">–û—Ç–º–µ–Ω–∞</button>
      <button id="mapPickerConfirm" class="modal-btn save-button" disabled>OK</button>
    </div>
  </div>
</div>
</main>
<script>
"use strict";
class FahrzeitRechner {
constructor() {
this.defaultGreetings = ['Moin zusammen', 'Hallo zusammen', 'Guten Morgen', 'Guten Tag'];
this.greetings = [...this.defaultGreetings];
this.greeting = 'Moin zusammen';
// –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ stations.js ‚Äî —Å–º. –º–µ—Ç–æ–¥ loadStations()
const defaultCoords = {};
this.stations        = {};
this.travelTimes     = {};
this.treffpunkt      = {};
this.trefftravelTimes = {};
this.participantOrders = {};
this.startPoint = '';
this.startPointCoords = { lat: null, lng: null };
this.defaultCoordinates = defaultCoords;      // –¥–ª—è —Å–±—Ä–æ—Å–∞
this.nameToCoordinates = { ...defaultCoords };
this.participants = [];
this.machineStop = { name: "an der Maschine", time: 20, arrivalTime: "", lat: null, lng: null, autoCalculated: false };
this.machineDestinations = [
  { name: 'an der Maschine', lat: null, lng: null },
  { name: 'im B√ºro Bochum', lat: 51.503883, lng: 7.240038 }
];
this.useUhrBei = false;
this.useSuperscriptTime = false;
this.sortable = null;
this.elements = {
greetingSelect: document.getElementById('greeting'),
editGreetingButton: document.querySelector('.edit-greeting-btn'),
startPointSelect: document.getElementById('startPoint'),
startPointCoordsButton: document.querySelector('.start-point-coords'),
participantsContainer: document.getElementById('participants'),
addButton: document.querySelector('.add'),
calculateButton: document.querySelector('.calculate'),
routeBackButton: document.querySelector('.route-back'),
copyButton: document.querySelector('.copy'),
clearButton: document.querySelector('.clear'),
output: document.getElementById('output'),
toast: document.getElementById('toast'),
coordsModal: document.getElementById('coordsModal'),
modalContent: document.querySelector('.modal-content'),
coordsInput: document.getElementById('coordsInput'),
coordsLabel: document.getElementById('coordsLabel'),
coordsHelp: document.getElementById('coordsHelp'),
nameInput: document.getElementById('nameInput'),
nameLabel: document.getElementById('nameLabel'),
greetingInput: document.getElementById('greetingInput'),
greetingLabel: document.getElementById('greetingLabel'),
modalTitle: document.getElementById('modalTitle'),
saveCoordsButton: document.getElementById('saveCoords'),
deleteGreetingButton: document.getElementById('deleteGreeting'),
cancelCoordsButton: document.getElementById('cancelCoords'),
openMapButton: document.getElementById('openMap'),
openMapPickerButton: document.getElementById('openMapPicker'),
mapBtnsRow: document.getElementById('mapBtnsRow')
};
this.currentEditIndex = null;
this.currentMainParticipantIndex = null;
this.currentSubParticipantIndex = null;
this.isEditingMachine = false;
this.isAddingNewName = false;
this.isAddingSubName = false;
this.isAddingNewGreeting = false;
this.isEditingGreeting = false;
this.isEditingStartPoint = false;
this.isAddingNewDestination = false;
this.isAddingNewKollege = false;
this.isAddingNewSubPerson = false;
this.isAddingNewTreffpunkt = false;
this.loadData();
this.syncCoordinates();
this.addEventListeners();
this.renderParticipants();
this.elements.output.innerHTML = '';
}
async loadStations() {
try {
  const resp = await fetch('stations.js', { cache: 'no-cache' });
  if (!resp.ok) throw new Error('HTTP ' + resp.status);
  const text = await resp.text();
  // –ü–∞—Ä—Å–∏–º –∫–∞–∂–¥—ã–π –±–ª–æ–∫ —á–µ—Ä–µ–∑ Function()
  const defM  = text.match(/const\s+defaultCoords\s*=\s*({[\s\S]*?});/);
  const stM   = text.match(/this\.stations\s*=\s*({[\s\S]*?});/);
  const tmM   = text.match(/this\.travelTimes\s*=\s*({[\s\S]*?});/);
  // –ë–ª–æ–∫–∏ —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ {} ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—á—ë—Ç—á–∏–∫ —Å–∫–æ–±–æ–∫
  function extractBlock(str, keyword) {
    const idx = str.indexOf(keyword);
    if (idx === -1) return null;
    const start = str.indexOf('{', idx);
    if (start === -1) return null;
    let depth = 0;
    for (let i = start; i < str.length; i++) {
      if (str[i] === '{') depth++;
      else if (str[i] === '}') { depth--; if (depth === 0) return str.slice(start, i + 1); }
    }
    return null;
  }
  const trfBlock = extractBlock(text, 'this.treffpunkt');
  const trtBlock = extractBlock(text, 'this.trefftravelTimes');
  const ordBlock = extractBlock(text, 'this.participantOrders');
  if (defM)  {
    const coords = Function('"use strict";return (' + defM[1] + ')')();
    this.defaultCoordinates = coords;
    this.nameToCoordinates  = { ...coords };
  }
  if (stM)  this.stations          = Function('"use strict";return (' + stM[1]  + ')')();
  if (tmM)  this.travelTimes       = Function('"use strict";return (' + tmM[1]  + ')')();
  if (trfBlock) this.treffpunkt        = Function('"use strict";return (' + trfBlock + ')')();
  if (trtBlock) this.trefftravelTimes  = Function('"use strict";return (' + trtBlock + ')')();
  if (ordBlock) this.participantOrders = Function('"use strict";return (' + ordBlock + ')')();
  // –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö ‚Äî –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –∏ —Ä–µ–Ω–¥–µ—Ä–∏–º
  this.syncCoordinates();
  this.updateParticipantTimes();
  this.renderParticipants();
  this.calculate();
} catch (e) {
  console.warn('stations.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω:', e.message);
  this.showToast('‚ö†Ô∏è stations.js –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Äî –¥–∞–Ω–Ω—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
}
}
formatMinutes(minutes) {
if (minutes < 60) {
return `${minutes}`;
}
const hours = Math.floor(minutes / 60);
const mins = minutes % 60;
return `${hours}.${mins.toString().padStart(2, '0')}`;
}
getTravelTime(fromName, toName) {
if (fromName === toName) return 0;
const key = `${fromName}-${toName}`;
const rev = `${toName}-${fromName}`;
// –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º –≤ –æ–±—ã—á–Ω—ã—Ö travelTimes
if (this.travelTimes[key] !== undefined) return this.travelTimes[key];
if (this.travelTimes[rev] !== undefined) return this.travelTimes[rev];
// –ó–∞—Ç–µ–º –≤ trefftravelTimes
if (this.trefftravelTimes[key] !== undefined) return this.trefftravelTimes[key];
if (this.trefftravelTimes[rev] !== undefined) return this.trefftravelTimes[rev];
return 5; // fallback
}
updateParticipantTimes() {
let previousPoint = this.startPoint;
this.participants.forEach(participant => {
if (participant.name && !participant.timeManuallyEdited) {
participant.time = this.getTravelTime(previousPoint, participant.name);
}
if (participant.name) previousPoint = participant.name;
});
}
syncCoordinates() {
this.participants.forEach(p => {
const coords = this.nameToCoordinates[p.name];
if (coords) { p.lat = coords.lat; p.lng = coords.lng; }
});
const startCoords = this.nameToCoordinates[this.startPoint];
this.startPointCoords = startCoords ? { lat: startCoords.lat, lng: startCoords.lng } : { lat: null, lng: null };
}
saveData() {
localStorage.setItem('fahrzeitRechnerGreeting', this.greeting);
localStorage.setItem('fahrzeitRechnerGreetings', JSON.stringify(this.greetings));
localStorage.setItem('fahrzeitRechnerParticipants', JSON.stringify(this.participants));
localStorage.setItem('fahrzeitRechnerMachineStop', JSON.stringify(this.machineStop));
localStorage.setItem('fahrzeitRechnerMachineDestinations', JSON.stringify(this.machineDestinations));
localStorage.setItem('fahrzeitRechnerNameToCoordinates', JSON.stringify(this.nameToCoordinates));
localStorage.setItem('fahrzeitRechnerStartPoint', this.startPoint);
localStorage.setItem('fahrzeitRechnerUseUhrBei', this.useUhrBei);
localStorage.setItem('fahrzeitRechnerUseSuperscript', this.useSuperscriptTime);
}
resetToDefaults() {
this.greeting = 'Moin zusammen';
this.greetings = [...this.defaultGreetings];
this.startPoint = '';
this.startPointCoords = { lat: null, lng: null };
this.participants = [];
this.nameToCoordinates = { ...this.defaultCoordinates };
this.machineStop = { name: "an der Maschine", time: 20, arrivalTime: "", lat: null, lng: null };
this.machineDestinations = [
  { name: 'an der Maschine', lat: null, lng: null },
  { name: 'im B√ºro Bochum', lat: 51.503883, lng: 7.240038 }
];
this.useUhrBei = false;
this.useSuperscriptTime = false;
this.saveData();
}
clearLocalStorage() {
['fahrzeitRechnerGreeting', 'fahrzeitRechnerGreetings', 'fahrzeitRechnerParticipants',
'fahrzeitRechnerMachineStop', 'fahrzeitRechnerNameToCoordinates', 'fahrzeitRechnerStartPoint',
'fahrzeitRechnerUseSuperscript'].forEach(k => localStorage.removeItem(k));
this.showToast("–î–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã.");
this.resetToDefaults();
this.elements.output.innerHTML = '';
this.renderParticipants();
this.initSortable();
}
loadData() {
try {
const saved = {
greeting: localStorage.getItem('fahrzeitRechnerGreeting'),
greetings: localStorage.getItem('fahrzeitRechnerGreetings'),
participants: localStorage.getItem('fahrzeitRechnerParticipants'),
machineStop: localStorage.getItem('fahrzeitRechnerMachineStop'),
machineDestinations: localStorage.getItem('fahrzeitRechnerMachineDestinations'),
nameToCoordinates: localStorage.getItem('fahrzeitRechnerNameToCoordinates'),
startPoint: localStorage.getItem('fahrzeitRechnerStartPoint'),
useUhrBei: localStorage.getItem('fahrzeitRechnerUseUhrBei'),
useSuperscript: localStorage.getItem('fahrzeitRechnerUseSuperscript')
};
if (saved.greeting) this.greeting = saved.greeting;
if (saved.greetings) try { this.greetings = JSON.parse(saved.greetings); } catch { this.greetings = [...this.defaultGreetings]; }
if (saved.participants) try { this.participants = JSON.parse(saved.participants).map(p => ({ ...p, timeManuallyEdited: p.timeManuallyEdited || false, subParticipants: p.subParticipants || [], isTreffpunkt: p.isTreffpunkt || false, treffpunktPersons: p.treffpunktPersons || [] })); } catch { this.participants = []; }
if (saved.machineStop) try { this.machineStop = JSON.parse(saved.machineStop); } catch { this.machineStop = { name: "an der Maschine", time: 20, arrivalTime: "", lat: null, lng: null };
this.machineDestinations = [
  { name: 'an der Maschine', lat: null, lng: null },
  { name: 'im B√ºro Bochum', lat: 51.503883, lng: 7.240038 }
]; }
if (saved.machineDestinations) try {
  const parsed = JSON.parse(saved.machineDestinations);
  // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç (–º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫) –≤ –Ω–æ–≤—ã–π (–º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤)
  this.machineDestinations = parsed.map(d =>
    typeof d === 'string' ? { name: d, lat: null, lng: null } : d
  );
} catch { /* use default */ }
if (saved.nameToCoordinates) try { this.nameToCoordinates = JSON.parse(saved.nameToCoordinates); } catch { /* use default */ }
if (saved.startPoint) {
this.startPoint = saved.startPoint;
const startCoords = this.nameToCoordinates[this.startPoint];
this.startPointCoords = startCoords ? { lat: startCoords.lat, lng: startCoords.lng } : { lat: null, lng: null };
}
if (saved.useUhrBei !== null) this.useUhrBei = saved.useUhrBei === 'true';
if (saved.useSuperscript !== null) this.useSuperscriptTime = saved.useSuperscript === 'true';
} catch {
this.resetToDefaults();
}
this.updateStartPoint(this.startPoint);
}
addEventListeners() {
this.elements.greetingSelect.addEventListener('change', e => {
if (e.target.value === 'add-new-greeting') this.openGreetingModal(true);
else { this.greeting = e.target.value; this.saveData(); this.calculate(); }
});
this.elements.editGreetingButton.addEventListener('click', () => this.openGreetingModal(false));
this.elements.startPointSelect.addEventListener('change', e => this.updateStartPoint(e.target.value));
this.elements.startPointCoordsButton.addEventListener('click', () => this.openCoordsModal(null, false, false, true));
this.elements.addButton.addEventListener('click', () => this.addParticipant());
this.elements.calculateButton.addEventListener('click', () => this.openGoogleMaps());
this.elements.routeBackButton.addEventListener('click', () => this.openGoogleMaps(true));
this.elements.copyButton.addEventListener('click', () => this.copyResult());
this.elements.clearButton.addEventListener('click', () => this.clearLocalStorage());
this.elements.saveCoordsButton.addEventListener('click', () => this.saveCoordinates());
this.elements.deleteGreetingButton.addEventListener('click', () => this.deleteGreeting());
this.elements.cancelCoordsButton.addEventListener('click', () => this.closeModal());
this.elements.openMapButton.addEventListener('click', () => this.openMapForSelection());
this.elements.openMapPickerButton.addEventListener('click', () => this.openMapPicker());
// Add-type modal handlers
const addTypeModal = document.getElementById('addTypeModal');
const addTypeCancelBtn = document.getElementById('addTypeCancelBtn');
const addTypeConfirmBtn = document.getElementById('addTypeConfirmBtn');
const closeAddTypeModal = () => {
addTypeModal.classList.remove('show');
const row = document.getElementById('newKollegeRow');
const inp = document.getElementById('newKollegeName');
if (row) row.classList.remove('visible');
if (inp) inp.value = '';
};
if (addTypeModal && addTypeCancelBtn && addTypeConfirmBtn) {
addTypeCancelBtn.addEventListener('click', closeAddTypeModal);
addTypeConfirmBtn.addEventListener('click', () => {
this.addParticipantFromModal();
});
addTypeModal.addEventListener('click', (e) => {
if (e.target === addTypeModal) closeAddTypeModal();
});
document.addEventListener('keydown', (e) => {
if (e.key === 'Escape' && addTypeModal.classList.contains('show')) closeAddTypeModal();
});
}
// Sub-participant modal handlers
const subModal = document.getElementById('subModal');
const subCancelBtn = document.getElementById('subCancelBtn');
const subAddBtn = document.getElementById('subAddBtn');
const closeSubModal = () => {
subModal.classList.remove('show');
const row = document.getElementById('newSubNameRow');
const inp = document.getElementById('newSubName');
if (row) row.classList.remove('visible');
if (inp) inp.value = '';
const sel = document.getElementById('subParticipantSelect');
if (sel) sel.value = '';
};
if (subModal && subCancelBtn && subAddBtn) {
subCancelBtn.addEventListener('click', closeSubModal);
subAddBtn.addEventListener('click', () => {
this.addSubParticipant();
});
subModal.addEventListener('click', (e) => {
if (e.target === subModal) closeSubModal();
});
document.addEventListener('keydown', (e) => {
if (e.key === 'Escape' && subModal.classList.contains('show')) closeSubModal();
});
}
// --- –£–î–ê–õ–ï–ù–´ –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –î–õ–Ø open-map-direct –∏ open-map-return ---
}
updateStartPoint(value) {
if (value === 'add-new') {
this.openCoordsModal(null, false, true, true);
} else {
this.startPoint = value;
const startCoords = this.nameToCoordinates[value];
this.startPointCoords = startCoords ? { lat: startCoords.lat, lng: startCoords.lng } : { lat: null, lng: null };
const order = this.participantOrders[value] || [];
// –°—Ç—Ä–æ–∏–º –ø–ª–æ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ –∏–º—ë–Ω –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏
const flatNames = order.map(item => {
  if (typeof item === 'string') return item;
  if (item?.treffpunkt) return item.treffpunkt;
  return item.main;
});
this.participants = order.map((item, idx) => {
const prev = idx === 0 ? this.startPoint : flatNames[idx - 1];
// –≠–ª–µ–º–µ–Ω—Ç Treffpunkt ‚Äî –º–µ—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∏ —Å –æ–∂–∏–¥–∞—é—â–∏–º–∏
if (item?.treffpunkt) {
  const treffName = item.treffpunkt;
  const coords = this.treffpunkt[treffName] || { lat: null, lng: null };
  const treffTime = this.trefftravelTimes?.[`${treffName}-${value}`] ?? this.getTravelTime(prev, treffName);
  return {
    name: treffName,
    time: treffTime,
    lat: coords.lat,
    lng: coords.lng,
    timeManuallyEdited: false,
    isTreffpunkt: true,
    subParticipants: [],
    treffpunktPersons: item.persons || []
  };
}
// –û–±—ã—á–Ω—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ –∏–ª–∏ –≥—Ä—É–ø–ø–∞
const name = typeof item === 'string' ? item : item.main;
const subs = item?.subParticipants || [];
const coords = this.nameToCoordinates[name] || { lat: null, lng: null };
return {
name,
time: this.getTravelTime(prev, name),
lat: coords.lat,
lng: coords.lng,
timeManuallyEdited: false,
isTreffpunkt: false,
subParticipants: subs,
treffpunktPersons: []
};
});
this.updateParticipantTimes();
this.saveData();
this.renderParticipants();
this.initSortable();
this.calculate();
}
}
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç Set –≤—Å–µ—Ö –∑–∞–Ω—è—Ç—ã—Ö –∏–º—ë–Ω (–∏—Å–∫–ª—é—á–∞—è optionalExclude)
getAllUsedNames(optionalExclude = null) {
  const used = new Set();
  if (this.startPoint) used.add(this.startPoint);
  this.participants.forEach(p => {
    if (p.name && p.name !== optionalExclude) used.add(p.name);
    (p.subParticipants || []).forEach(n => { if (n !== optionalExclude) used.add(n); });
    (p.treffpunktPersons || []).forEach(n => { if (n !== optionalExclude) used.add(n); });
  });
  return used;
}
renderParticipants() {
const container = this.elements.participantsContainer;
container.innerHTML = '';
this.elements.greetingSelect.innerHTML = this.greetings.map(g => `<option value="${g}" ${this.greeting === g ? 'selected' : ''}>${g}</option>`).join('') + '<option value="add-new-greeting">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ</option>';
const nameOptions = Object.keys(this.nameToCoordinates).map(name => `<option value="${name}" ${this.startPoint === name ? 'selected' : ''}>${name}</option>`).join('');
this.elements.startPointSelect.innerHTML = `
<option value="" ${!this.startPoint ? 'selected' : ''}>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—É—é —Ç–æ—á–∫—É</option>
${nameOptions}
<option value="add-new">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –∏–º—è</option>
`;
const noCoordsSvg = `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="rgb(209,43,47)"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>`;
const hasCoordsSvg = `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="rgb(68,178,229)"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>`;
this.elements.startPointCoordsButton.innerHTML = (this.startPointCoords.lat && this.startPointCoords.lng) ? hasCoordsSvg : noCoordsSvg;
const validNames = this.participants.map(p => p.name).filter(n => n);
if (this.startPoint && validNames.includes(this.startPoint)) {
this.showToast(`–ù–∞—á–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ "${this.startPoint}" –Ω–µ –º–æ–∂–µ—Ç —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –∏–º–µ–Ω–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞.`);
this.startPoint = ''; this.startPointCoords = { lat: null, lng: null };
this.participants = []; this.saveData();
}
this.participants.forEach((p, i) => {
// –°–æ–∑–¥–∞–µ–º –≥—Ä—É–ø–ø—É –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∏ –µ–≥–æ —Å—É–±—É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
const groupDiv = document.createElement('div');
groupDiv.className = 'participant-group';
groupDiv.setAttribute('data-index', i);
// –û—Å–Ω–æ–≤–Ω–æ–π —É—á–∞—Å—Ç–Ω–∏–∫
const div = document.createElement('div');
div.className = 'participant main-participant' + (p.isTreffpunkt ? ' has-treffpunkt' : '');
div.setAttribute('data-index', i);

if (p.isTreffpunkt) {
// ===== –†–µ–Ω–¥–µ—Ä Treffpunkt-—É—á–∞—Å—Ç–Ω–∏–∫–∞ =====
const coordsSvg = (p.lat && p.lng) ? hasCoordsSvg : noCoordsSvg;
div.innerHTML = `
<select data-index="${i}" data-type="participant-name" aria-label="Treffpunkt">
<option value="${p.name}" selected>üìç ${p.name}</option>
${Object.keys(this.treffpunkt).filter(n => n !== p.name).map(n => `<option value="${n}">üìç ${n}</option>`).join('')}
</select>
<button class="coords-icon" data-index="${i}" data-type="participant-coords" aria-label="Redaktieren">${coordsSvg}</button>
<div class="time-display" data-index="${i}" data-type="participant-time-display" title="–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è">
${this.formatMinutes(p.time)}
</div>
<button class="add-sub-btn" data-index="${i}" title="Person hinzuf√ºgen" style="background:#28a745;">+</button>
<div class="right-section">
<span class="material-symbols-outlined" aria-label="–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å">
<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="#e3e3e3"><path d="M320-440v-287L217-624l-57-56 200-200 200 200-57 56-103-103v287h-80ZM600-80 400-280l57-56 103 103v-287h80v287l103-103 57 56L600-80Z"/></svg>
</span>
<button class="remove-btn" data-index="${i}" aria-label="–£–¥–∞–ª–∏—Ç—å"></button>
</div>
`;
groupDiv.appendChild(div);

// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª—é–¥–µ–π –Ω–∞ Treffpunkt –∫–∞–∫ —Å—É–±—É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
if (p.treffpunktPersons && p.treffpunktPersons.length > 0) {
p.treffpunktPersons.forEach((personName, personIdx) => {
const subDiv = document.createElement('div');
subDiv.className = 'sub-participant';
subDiv.setAttribute('data-main-index', i);
subDiv.setAttribute('data-sub-index', personIdx);

const usedInTreff = this.getAllUsedNames(personName);
const personOptions = Object.keys(this.nameToCoordinates)
.filter(n => !usedInTreff.has(n) || n === personName)
.sort()
.map(n => `<option value="${n}" ${n === personName ? 'selected' : ''}>${n}</option>`)
.join('');

subDiv.innerHTML = `
<span class="drag-handle-sub">‚ãÆ‚ãÆ</span>
<select data-main-index="${i}" data-sub-index="${personIdx}" data-type="treff-person-name" aria-label="Person am Treffpunkt">
${personOptions}
</select>
<button class="remove-sub-btn" data-main-index="${i}" data-sub-index="${personIdx}" aria-label="–£–¥–∞–ª–∏—Ç—å"></button>
`;
groupDiv.appendChild(subDiv);
});
}

} else {
// ===== –†–µ–Ω–¥–µ—Ä –æ–±—ã—á–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–¥) =====
const usedForMain = this.getAllUsedNames(p.name);
const participantNameOptions = Object.keys(this.nameToCoordinates)
.filter(n => n !== this.startPoint && (!usedForMain.has(n) || n === p.name))
.map(n => `<option value="${n}" ${p.name === n ? 'selected' : ''}>${n}</option>`).join('');
const coordsSvg = (p.lat && p.lng) ? hasCoordsSvg : noCoordsSvg;
div.innerHTML = `
<select data-index="${i}" data-type="participant-name" aria-label="–ò–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞">
<option value="" ${!p.name ? 'selected' : ''}>–í—ã–±–µ—Ä–∏—Ç–µ –∏–º—è</option>
${participantNameOptions}
<option value="add-new">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –∏–º—è</option>
</select>
<button class="coords-icon" data-index="${i}" data-type="participant-coords" aria-label="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —É—á–∞—Å—Ç–Ω–∏–∫–∞">${coordsSvg}</button>
<div class="time-display" data-index="${i}" data-type="participant-time-display" title="–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è">
${this.formatMinutes(p.time)}
</div>
<button class="add-sub-btn" data-index="${i}" title="–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∫ –ø–æ–µ–∑–¥–∫–µ">+</button>
<div class="right-section">
<span class="material-symbols-outlined" aria-label="–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞">
<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="#e3e3e3"><path d="M320-440v-287L217-624l-57-56 200-200 200 200-57 56-103-103v287h-80ZM600-80 400-280l57-56 103 103v-287h80v287l103-103 57 56L600-80Z"/></svg>
</span>
<button class="remove-btn" data-index="${i}" aria-label="–£–¥–∞–ª–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞"></button>
</div>
`;
groupDiv.appendChild(div);
// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ (subParticipants)
if (p.subParticipants && p.subParticipants.length > 0) {
p.subParticipants.forEach((subName, subIdx) => {
const subDiv = document.createElement('div');
subDiv.className = 'sub-participant';
subDiv.setAttribute('data-main-index', i);
subDiv.setAttribute('data-sub-index', subIdx);
const usedInSub = this.getAllUsedNames(subName);
const subNameOptions = Object.keys(this.nameToCoordinates)
.filter(n => n !== this.startPoint && (!usedInSub.has(n) || n === subName))
.sort()
.map(n => `<option value="${n}" ${subName === n ? 'selected' : ''}>${n}</option>`).join('');
subDiv.innerHTML = `
<span class="drag-handle-sub">‚ãÆ‚ãÆ</span>
<select data-main-index="${i}" data-sub-index="${subIdx}" data-type="sub-name" aria-label="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —É—á–∞—Å—Ç–Ω–∏–∫">
${subNameOptions}
<option value="add-new">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –∏–º—è</option>
</select>
<button class="remove-sub-btn" data-main-index="${i}" data-sub-index="${subIdx}" aria-label="–£–¥–∞–ª–∏—Ç—å"></button>
`;
groupDiv.appendChild(subDiv);
});
}
}

container.appendChild(groupDiv);
// Event listeners –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
div.querySelector('[data-type="participant-name"]').addEventListener('change', e => {
if (p.isTreffpunkt) this.updateTreffpunktName(i, e.target.value);
else this.updateName(i, e.target.value);
});
const timeDisplay = div.querySelector('[data-type="participant-time-display"]');
if (timeDisplay) {
timeDisplay.addEventListener('click', () => this.editParticipantTime(i, timeDisplay));
}
div.querySelector('[data-type="participant-coords"]').addEventListener('click', () => this.openCoordsModal(i));
div.querySelector('.add-sub-btn').addEventListener('click', () => {
if (p.isTreffpunkt) this.openTreffpunktPersonModal(i);
else this.openSubParticipantModal(i);
});
div.querySelector('.remove-btn').addEventListener('click', () => this.removeParticipant(i));
// Event listeners –¥–ª—è —Å—É–±—É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ / treffpunkt persons
groupDiv.querySelectorAll('[data-type="sub-name"]').forEach(select => {
select.addEventListener('change', (e) => {
const mainIdx = parseInt(e.target.dataset.mainIndex);
const subIdx = parseInt(e.target.dataset.subIndex);
if (e.target.value === 'add-new') {
this.currentMainParticipantIndex = mainIdx;
this.currentSubParticipantIndex = subIdx;
this.isAddingSubName = true;
this.openCoordsModal(null, false, true);
} else {
this.updateSubParticipant(mainIdx, subIdx, e.target.value);
}
});
});
groupDiv.querySelectorAll('[data-type="treff-person-name"]').forEach(select => {
select.addEventListener('change', (e) => {
const mainIdx = parseInt(e.target.dataset.mainIndex);
const personIdx = parseInt(e.target.dataset.subIndex);
this.updateTreffpunktPerson(mainIdx, personIdx, e.target.value);
});
});
groupDiv.querySelectorAll('.remove-sub-btn').forEach(btn => {
btn.addEventListener('click', () => {
const mainIdx = parseInt(btn.dataset.mainIndex);
const subIdx = parseInt(btn.dataset.subIndex);
if (this.participants[mainIdx].isTreffpunkt) {
this.removeTreffpunktPerson(mainIdx, subIdx);
} else {
this.removeSubParticipant(mainIdx, subIdx);
}
});
});
});
const machineDiv = document.createElement('div');
machineDiv.className = 'participant machine';
const machineCoordsSvg = (this.machineStop.lat && this.machineStop.lng) ? hasCoordsSvg : noCoordsSvg;
// SVG –∏–∫–æ–Ω–∫–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤ –ø—É—Ç–∏
const coloredMapSvg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 92.3 132.3" width="24" height="24"><path fill="#1a73e8" d="M60.2 2.2C55.8.8 51 0 46.1 0 32 0 19.3 6.4 10.8 16.5l21.8 18.3L60.2 2.2z"/><path fill="#ea4335" d="M10.8 16.5C4.1 24.5 0 34.9 0 46.1c0 8.7 1.7 15.7 4.6 22l28-33.3-21.8-18.3z"/><path fill="#4285f4" d="M46.2 28.5c9.8 0 17.7 7.9 17.7 17.7 0 4.3-1.6 8.3-4.2 11.4 0 0 13.9-16.6 27.5-32.7-5.6-10.8-15.3-19-27-22.7L32.6 34.8c3.3-3.8 8.1-6.3 13.6-6.3"/><path fill="#fbbc04" d="M46.2 63.8c-9.8 0-17.7-7.9-17.7-17.7 0-4.3 1.5-8.3 4.1-11.3l-28 33.3c4.8 10.6 12.8 19.2 21 29.9l34.1-40.5c-3.3 3.9-8.1 6.3-13.5 6.3"/><path fill="#34a853" d="M59.1 109.2c15.4-24.1 33.3-35 33.3-63 0-7.7-1.9-14.9-5.2-21.3L25.6 98c2.6 3.4 5.3 7.3 7.9 11.3 9.4 14.5 6.8 23.1 12.8 23.1s3.4-8.7 12.8-23.2"/></svg>`;
const grayMapSvg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 92.3 132.3" width="24" height="24"><path fill="#999" d="M60.2 2.2C55.8.8 51 0 46.1 0 32 0 19.3 6.4 10.8 16.5l21.8 18.3L60.2 2.2z"/><path fill="#999" d="M10.8 16.5C4.1 24.5 0 34.9 0 46.1c0 8.7 1.7 15.7 4.6 22l28-33.3-21.8-18.3z"/><path fill="#999" d="M46.2 28.5c9.8 0 17.7 7.9 17.7 17.7 0 4.3-1.6 8.3-4.2 11.4 0 0 13.9-16.6 27.5-32.7-5.6-10.8-15.3-19-27-22.7L32.6 34.8c3.3-3.8 8.1-6.3 13.6-6.3"/><path fill="#999" d="M46.2 63.8c-9.8 0-17.7-7.9-17.7-17.7 0-4.3 1.5-8.3 4.1-11.3l-28 33.3c4.8 10.6 12.8 19.2 21 29.9l34.1-40.5c-3.3 3.9-8.1 6.3-13.5 6.3"/><path fill="#999" d="M59.1 109.2c15.4-24.1 33.3-35 33.3-63 0-7.7-1.9-14.9-5.2-21.3L25.6 98c2.6 3.4 5.3 7.3 7.9 11.3 9.4 14.5 6.8 23.1 12.8 23.1s3.4-8.7 12.8-23.2"/></svg>`;
const calcIcon = this.machineStop.autoCalculated ? coloredMapSvg : grayMapSvg;
// –°—Ç—Ä–æ–∏–º –æ–ø—Ü–∏–∏ –¥–ª—è select –ø—É–Ω–∫—Ç–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
const destOptions = this.machineDestinations.map(d =>
  `<option value="${d.name}" ${this.machineStop.name === d.name ? 'selected' : ''}>${d.name}</option>`
).join('');
const isCustom = !this.machineDestinations.some(d => d.name === this.machineStop.name);
machineDiv.innerHTML = `
<select data-type="machine-name" aria-label="–ü—É–Ω–∫—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è">
  ${destOptions}
  ${isCustom ? `<option value="${this.machineStop.name}" selected>${this.machineStop.name}</option>` : ''}
  <option value="__add_new__">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç‚Ä¶</option>
</select>
<button class="coords-icon" data-type="machine-coords" aria-label="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –º–∞—à–∏–Ω—ã">${machineCoordsSvg}</button>
<div class="time-display ${this.machineStop.autoCalculated ? 'auto-calculated' : ''}" data-type="machine-time-display" title="–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è">
${this.formatMinutes(this.machineStop.time)}
</div>
<button class="calc-route-icon" data-type="calc-route" aria-label="–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –≤—Ä–µ–º—è –≤ –ø—É—Ç–∏" title="–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –≤—Ä–µ–º—è –≤ –ø—É—Ç–∏ –æ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞">
  ${calcIcon}
</button>
<div class="right-section">
${this.machineStop.arrivalTime
? `<div class="arrival-time" tabindex="0" role="button" aria-label="–ò–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è –ø—Ä–∏–±—ã—Ç–∏—è">${this.machineStop.arrivalTime}</div><button class="time-remove" aria-label="–û—á–∏—Å—Ç–∏—Ç—å –≤—Ä–µ–º—è –ø—Ä–∏–±—ã—Ç–∏—è"></button>`
: '<button class="time-icon" aria-label="–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Ä–µ–º—è –ø—Ä–∏–±—ã—Ç–∏—è">üïí</button>'
}
</div>
`;
container.appendChild(machineDiv);
const machineNameSel = machineDiv.querySelector('[data-type="machine-name"]');

machineNameSel.addEventListener('change', e => {
  const val = e.target.value;
  if (val === '__add_new__') {
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º select –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –º–æ–¥–∞–ª–∫–∞ —Å–∞–º–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç
    machineNameSel.value = this.machineStop.name;
    this.openCoordsModal(null, false, false, false, true); // isAddingNewDestination
  } else {
    // –ü–æ–¥—Å—Ç–∞–≤–ª—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –µ—Å–ª–∏ –µ—Å—Ç—å
    const dest = this.machineDestinations.find(d => d.name === val);
    if (dest && dest.lat && dest.lng) {
      this.machineStop.lat = dest.lat;
      this.machineStop.lng = dest.lng;
      this.machineStop.autoCalculated = false;
    } else if (dest) {
      this.machineStop.lat = null;
      this.machineStop.lng = null;
    }
    this.updateMachineName(val);
    this.renderParticipants();
  }
});

const machineTimeDisplay = machineDiv.querySelector('[data-type="machine-time-display"]');
if (machineTimeDisplay) {
machineTimeDisplay.addEventListener('click', () => this.editMachineTime(machineTimeDisplay));
}
machineDiv.querySelector('[data-type="machine-coords"]').addEventListener('click', () => this.openCoordsModal(null, true));
machineDiv.querySelector('[data-type="calc-route"]').addEventListener('click', () => this.calculateTravelTimeToMachine());
container.appendChild(machineDiv);
// –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —á–µ–∫–±–æ–∫—Å–æ–≤
const checkboxContainer = document.createElement('div');
checkboxContainer.className = 'checkbox-container';
checkboxContainer.innerHTML = `
<label>
<input type="checkbox" id="useUhrBei" ${this.useUhrBei ? 'checked' : ''}> um...Uhr bei
</label>
<label>
<input type="checkbox" id="useSuperscriptTime" ${this.useSuperscriptTime ? 'checked' : ''}> X¬≤
</label>
<label class="theme-toggle">
`;
container.appendChild(checkboxContainer);
// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —á–µ–∫–±–æ–∫—Å–æ–≤
const uhrBeiCheckbox = checkboxContainer.querySelector('#useUhrBei');
uhrBeiCheckbox.addEventListener('change', () => {
this.useUhrBei = uhrBeiCheckbox.checked;
this.saveData();
this.calculate();
});
const superscriptCheckbox = checkboxContainer.querySelector('#useSuperscriptTime');
superscriptCheckbox.addEventListener('change', () => {
this.useSuperscriptTime = superscriptCheckbox.checked;
this.saveData();
this.calculate();
});
const timeControl = machineDiv.querySelector('.time-icon') || machineDiv.querySelector('.arrival-time');
timeControl.addEventListener('click', () => this.startTimeEdit());
timeControl.addEventListener('keydown', (e) => {
if (e.key === 'Enter' || e.key === ' ') {
e.preventDefault();
this.startTimeEdit();
}
});
const timeRemoveBtn = machineDiv.querySelector('.time-remove');
if (timeRemoveBtn) timeRemoveBtn.addEventListener('click', () => this.clearArrivalTime());
this.saveData();
if (this.machineStop.arrivalTime) this.calculate(); else this.elements.output.innerHTML = '';
}
async parseCoordinates(raw) {
const s = raw.trim();
if (!s) { this.showToast("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ."); return null; }
try {
this.showToast("üîÑ –û–ø—Ä–µ–¥–µ–ª—è—é –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã‚Ä¶");
const resp = await fetch('/api/parse-coords?input=' + encodeURIComponent(s));
const d = await resp.json();
if (d.success) return { lat: d.lat, lng: d.lng };
this.showToast(d.error || "–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω—ã.");
return null;
} catch(e) {
this.showToast("–û—à–∏–±–∫–∞: " + e.message);
return null;
}
}
openCoordsModal(index, isMachine = false, isAddingNewName = false, isEditingStartPoint = false, isAddingNewDestination = false, isAddingNewKollege = false, isAddingNewSubPerson = false) {
this.currentEditIndex = index;
this.isEditingMachine = isMachine;
this.isAddingNewName = isAddingNewName;
this.isEditingStartPoint = isEditingStartPoint;
this.isAddingNewDestination = isAddingNewDestination;
this.isAddingNewKollege = isAddingNewKollege;
this.isAddingNewSubPerson = isAddingNewSubPerson;
this.isAddingNewGreeting = false;
this.isEditingGreeting = false;
if (!isAddingNewName) this.isAddingSubName = false;
const modal = this.elements.coordsModal;
const modalContent = this.elements.modalContent;
const coordsInput = this.elements.coordsInput;
const coordsLabel = this.elements.coordsLabel;
const coordsHelp = this.elements.coordsHelp;
const nameInput = this.elements.nameInput;
const nameLabel = this.elements.nameLabel;
const greetingInput = this.elements.greetingInput;
const greetingLabel = this.elements.greetingLabel;
const modalTitle = this.elements.modalTitle;
const openMapButton = this.elements.openMapButton;
const openMapPickerButton = this.elements.openMapPickerButton;
const deleteGreetingButton = this.elements.deleteGreetingButton;
modalContent.classList.toggle('add-new-name', isAddingNewName);
modalTitle.textContent = isAddingNewDestination ? '–ù–æ–≤—ã–π –ø—É–Ω–∫—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è' :
isAddingNewKollege ? 'Neuer Kollege' :
isAddingNewSubPerson ? 'Neue Person' :
isAddingNewName ? '–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –∏–º—è' :
isEditingStartPoint ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–∞—á–∞–ª—å–Ω–æ–π —Ç–æ—á–∫–∏' :
isMachine ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –º–∞—à–∏–Ω—ã' : '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã';
[nameLabel, nameInput, greetingLabel, greetingInput, deleteGreetingButton].forEach(el => el.style.display = 'none');
[coordsLabel, coordsHelp, coordsInput, this.elements.mapBtnsRow].forEach(el => el.style.display = 'block');
this.elements.mapBtnsRow.style.display = 'flex';
// –≤—ã–±–æ—Ä —Å—Ç–∞–Ω—Ü–∏–π
const stSel = document.getElementById('stationSelect');
if (isMachine) {
stSel.style.display = 'block';
stSel.innerHTML = '<option value="">‚Äì –í—ã–±—Ä–∞—Ç—å –∏–∑ —Å–ø–∏—Å–∫–∞ ‚Äì</option>' +
Object.entries(this.stations)
.map(([name,c]) => `<option value="${c.lat},${c.lng}">${name}</option>`)
.join('');
/* ‚ûú –ø–æ–¥—Å–≤–µ—Ç–∏—Ç—å —Ä–∞–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é —Å—Ç–∞–Ω—Ü–∏—é */
const saved = this.machineStop.lat && this.machineStop.lng ? `${this.machineStop.lat},${this.machineStop.lng}` : '';
stSel.value = saved && [...stSel.options].some(o => o.value === saved) ? saved : '';
stSel.onchange = () => {
this.elements.coordsInput.value = stSel.value;
};
} else {
stSel.style.display = 'none';
}
if (isAddingNewDestination || isAddingNewName || isAddingNewKollege || isAddingNewSubPerson) {
nameLabel.style.display = 'block';
nameInput.style.display = 'block';
nameInput.value = '';
coordsInput.value = '';
} else if (isEditingStartPoint) {
coordsInput.value = this.startPointCoords.lat && this.startPointCoords.lng ? `${this.startPointCoords.lat},${this.startPointCoords.lng}` : '';
} else if (isMachine) {
coordsInput.value = this.machineStop.lat && this.machineStop.lng ? `${this.machineStop.lat},${this.machineStop.lng}` : '';
} else {
const participant = this.participants[index];
coordsInput.value = participant.lat && participant.lng ? `${participant.lat},${participant.lng}` : '';
}
modal.style.display = 'flex';
// –ê–≤—Ç–æ—Ñ–æ–∫—É—Å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –∏–º–µ–Ω–∏ ‚Äî
// –∏–Ω–∞—á–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º —Å—Ä–∞–∑—É –≤—ã—Å–∫–∞–∫–∏–≤–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
if (isAddingNewName) {
nameInput.focus();
}
}
openGreetingModal(isAddingNewGreeting) {
this.isAddingNewGreeting = isAddingNewGreeting;
this.isEditingGreeting = !isAddingNewGreeting;
this.isAddingNewName = false;
this.isEditingMachine = false;
this.isEditingStartPoint = false;
const modal = this.elements.coordsModal;
const modalContent = this.elements.modalContent;
modalContent.classList.remove('add-new-name');
this.elements.modalTitle.textContent = isAddingNewGreeting ? '–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ' : '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ';
['coordsLabel', 'coordsHelp', 'coordsInput', 'mapBtnsRow', 'nameLabel', 'nameInput'].forEach(el => this.elements[el].style.display = 'none');
this.elements.greetingLabel.style.display = 'block';
this.elements.greetingInput.style.display = 'block';
this.elements.greetingInput.value = this.greeting;
this.elements.deleteGreetingButton.style.display = this.defaultGreetings.includes(this.greeting) ? 'none' : 'inline-block';
modal.style.display = 'flex';
this.elements.greetingInput.focus();
}
async saveCoordinates() {
const saveButton = this.elements.saveCoordsButton;
try {
if (this.isAddingNewGreeting || this.isEditingGreeting) {
const newGreeting = this.elements.greetingInput.value.trim();
if (!newGreeting) { this.showToast("–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ."); return; }
if (this.isAddingNewGreeting && this.greetings.includes(newGreeting)) { this.showToast("–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç."); return; }
if (this.isEditingGreeting) {
const old = this.greeting;
const idx = this.greetings.indexOf(old);
if (idx !== -1 && !this.defaultGreetings.includes(old)) this.greetings[idx] = newGreeting;
this.greeting = newGreeting;
} else if (this.isAddingNewGreeting) {
this.greetings.push(newGreeting);
this.greeting = newGreeting;
}
this.closeModal(); this.saveData(); this.renderParticipants(); this.calculate();
} else {
const raw = this.elements.coordsInput.value.trim();
let coords = null;
if (raw) {                                  // –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á—Ç–æ-—Ç–æ –≤–≤—ë–ª
coords = await this.parseCoordinates(raw);
if (!coords) return;                    // —Ç–æ–ª—å–∫–æ —Ç—Ä–µ–±—É–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å
}
// –µ—Å–ª–∏ raw –ø—É—Å—Ç ‚Äì coords –æ—Å—Ç–∞—ë—Ç—Å—è null, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—è—Ç—å
if (this.isAddingNewKollege || this.isAddingNewSubPerson) {
const name = this.elements.nameInput.value.trim();
if (!name) { this.showToast('‚ö†Ô∏è Bitte einen Namen eingeben'); return; }
if (this.nameToCoordinates[name]) { this.showToast(`‚ö†Ô∏è "${name}" existiert bereits`); return; }
this.nameToCoordinates[name] = coords ? { lat: coords.lat, lng: coords.lng } : { lat: null, lng: null };
if (this.isAddingNewKollege) {
  this.participants.push({ name, time: 5, lat: coords ? coords.lat : null, lng: coords ? coords.lng : null, timeManuallyEdited: false, isTreffpunkt: false, subParticipants: [], treffpunktPersons: [] });
  document.getElementById('addTypeModal').classList.remove('show');
} else {
  // isAddingNewSubPerson ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º –∫–∞–∫ —Å—É–±—É—á–∞—Å—Ç–Ω–∏–∫–∞ –∏–ª–∏ treffpunktPerson
  const mainIndex = this.currentMainParticipantIndex;
  const mainP = this.participants[mainIndex];
  if (mainP.isTreffpunkt) {
    if (!mainP.treffpunktPersons) mainP.treffpunktPersons = [];
    mainP.treffpunktPersons.push(name);
  } else {
    if (!mainP.subParticipants) mainP.subParticipants = [];
    mainP.subParticipants.push(name);
  }
  document.getElementById('subModal').classList.remove('show');
}
this.closeModal(); this.updateParticipantTimes(); this.saveData(); this.renderParticipants(); this.initSortable(); this.calculate();
return;
}
if (this.isAddingNewDestination) {
const name = this.elements.nameInput.value.trim();
if (!name) { this.showToast('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—É–Ω–∫—Ç–∞.'); return; }
if (this.machineDestinations.some(d => d.name === name)) { this.showToast('–¢–∞–∫–æ–π –ø—É–Ω–∫—Ç —É–∂–µ –µ—Å—Ç—å.'); return; }
this.machineDestinations.push({ name, lat: coords ? coords.lat : null, lng: coords ? coords.lng : null });
this.machineStop.name = name;
this.machineStop.lat  = coords ? coords.lat : null;
this.machineStop.lng  = coords ? coords.lng : null;
this.machineStop.autoCalculated = false;
this.closeModal(); this.saveData(); this.renderParticipants(); this.calculate();
return;
}
if (this.isAddingNewTreffpunkt) {
const name = this.elements.nameInput.value.trim();
if (!name) { this.showToast('‚ö†Ô∏è Bitte einen Namen eingeben'); return; }
if (this.treffpunkt[name]) { this.showToast(`‚ö†Ô∏è "${name}" existiert bereits`); return; }
this.treffpunkt[name] = coords ? { lat: coords.lat, lng: coords.lng } : { lat: null, lng: null };
// –°—Ä–∞–∑—É –¥–æ–±–∞–≤–ª—è–µ–º –∫–∞–∫ —É—á–∞—Å—Ç–Ω–∏–∫–∞-Treffpunkt
this.participants.push({
  name,
  time: 5,
  lat: coords ? coords.lat : null,
  lng: coords ? coords.lng : null,
  timeManuallyEdited: false,
  isTreffpunkt: true,
  treffpunktPersons: []
});
this.isAddingNewTreffpunkt = false;
this.closeModal(); this.updateParticipantTimes(); this.saveData(); this.renderParticipants(); this.initSortable(); this.calculate();
return;
}
if (this.isAddingNewName) {
const name = this.elements.nameInput.value.trim();
if (!name) { this.showToast("–í–≤–µ–¥–∏—Ç–µ –∏–º—è."); return; }
if (this.nameToCoordinates[name]) { this.showToast("–ò–º—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç."); return; }
/* 1. –°–û–•–†–ê–ù–Ø–ï–ú –∏–º—è (—Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ –∏–ª–∏ –±–µ–∑) */
this.nameToCoordinates[name] = coords
? { lat: coords.lat, lng: coords.lng }
: { lat: null, lng: null };
/* 2. –ï—Å–ª–∏ –¥–æ–±–∞–≤–ª—è–µ–º –¥–ª—è —Å—É–±—É—á–∞—Å—Ç–Ω–∏–∫–∞ ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º –≤ subParticipants */
if (this.isAddingSubName) {
const mainIdx = this.currentMainParticipantIndex;
const subIdx = this.currentSubParticipantIndex;
if (subIdx !== null && subIdx !== undefined) {
// –ó–∞–º–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Å—É–±—É—á–∞—Å—Ç–Ω–∏–∫–∞
this.participants[mainIdx].subParticipants[subIdx] = name;
} else {
// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å—É–±—É—á–∞—Å—Ç–Ω–∏–∫–∞
if (!this.participants[mainIdx].subParticipants) {
this.participants[mainIdx].subParticipants = [];
}
this.participants[mainIdx].subParticipants.push(name);
}
this.isAddingSubName = false;
this.currentSubParticipantIndex = null;
} else if (this.isEditingStartPoint) {
this.startPoint = name;
this.startPointCoords = { ...this.nameToCoordinates[name] };
this.participants = [];
} else {
const p = this.participants[this.currentEditIndex];
p.name = name;
p.lat  = this.nameToCoordinates[name].lat;
p.lng  = this.nameToCoordinates[name].lng;
p.timeManuallyEdited = false;
}
this.updateParticipantTimes();
}
else if (this.isEditingMachine) {
this.machineStop.lat = coords.lat; this.machineStop.lng = coords.lng;
this.closeModal(); this.saveData(); this.renderParticipants(); this.initSortable();
this.showToast('‚úÖ Koordinaten gespeichert');
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –º–∞—à–∏–Ω—ã
setTimeout(() => this.calculateTravelTimeToMachine(), 500);
return; // –í—ã—Ö–æ–¥–∏–º, —á—Ç–æ–±—ã –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –≤—ã–∑–æ–≤—ã –Ω–∏–∂–µ
} else if (this.isEditingStartPoint) {
this.startPointCoords = { lat: coords.lat, lng: coords.lng };
this.updateParticipantTimes();
} else {
this.participants[this.currentEditIndex].lat = coords.lat;
this.participants[this.currentEditIndex].lng = coords.lng;
this.participants[this.currentEditIndex].timeManuallyEdited = false;
this.updateParticipantTimes();
}
this.closeModal(); this.saveData(); this.renderParticipants(); this.initSortable(); this.calculate();
this.showToast('‚úÖ Koordinaten gespeichert');
}
} catch(e) {
  this.showToast('‚ö†Ô∏è ' + e.message);
}
}
deleteGreeting() {
if (!this.defaultGreetings.includes(this.greeting)) {
this.greetings = this.greetings.filter(g => g !== this.greeting);
this.greeting = this.defaultGreetings[0];
this.closeModal(); this.saveData(); this.renderParticipants(); this.calculate();
}
}
closeModal() {
this.elements.coordsModal.style.display = 'none';
this.isAddingNewName = this.isEditingMachine = this.isAddingNewGreeting = this.isEditingGreeting = this.isEditingStartPoint = this.isAddingNewDestination = this.isAddingNewKollege = this.isAddingNewSubPerson = this.isAddingNewTreffpunkt = false;
this.isAddingNewKollege = false;
this.isAddingNewSubPerson = false;
this.isAddingNewTreffpunkt = false;
this.currentEditIndex = null;
}
openMapForSelection() {
const coords = this.elements.coordsInput.value.trim();
let url = 'https://www.google.com/maps';
if (coords) {
const m = coords.match(/([-+]?\d{1,3}\.\d+)[,\s]+([-+]?\d{1,3}\.\d+)/);
const parsed = m ? { lat: +m[1], lng: +m[2] } : null;
if (parsed && Math.abs(parsed.lat) <= 90) url += `/place/${parsed.lat},${parsed.lng}`;
else url += `/search/${encodeURIComponent(coords)}`;
}
window.open(url, '_blank');
}

// ‚îÄ‚îÄ Map Picker ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async openMapPicker() {
  const modal = document.getElementById('mapPickerModal');
  const container = document.getElementById('mapPickerContainer');
  const coordsSpan = document.getElementById('mapPickerCoords');
  const confirmBtn = document.getElementById('mapPickerConfirm');

  modal.style.display = 'flex';
  modal.style.cssText += 'display:flex;align-items:center;justify-content:center;position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,.6);';

  let pickedLat = null, pickedLng = null;

  // –ü–æ–ª—É—á–∞–µ–º API –∫–ª—é—á
  let apiKey;
  try {
    const r = await fetch('/api/maps-key');
    const d = await r.json();
    apiKey = d.key;
  } catch(e) {
    this.showToast('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á –∫–∞—Ä—Ç—ã');
    modal.style.display = 'none';
    return;
  }

  // –ù–∞—á–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ ‚Äî –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—è –∏–ª–∏ —Ü–µ–Ω—Ç—Ä –ì–µ—Ä–º–∞–Ω–∏–∏
  let initLat = 51.5, initLng = 7.0, initZoom = 10;
  const cur = this.elements.coordsInput.value.trim();
  const m = cur.match(/([-+]?\d{1,3}\.\d+)[,\s]+([-+]?\d{1,3}\.\d+)/);
  if (m) { initLat = +m[1]; initLng = +m[2]; initZoom = 15; }

  // –ó–∞–≥—Ä—É–∂–∞–µ–º Google Maps JS API –µ—Å–ª–∏ –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω
  const initMap = () => {
    const map = new google.maps.Map(container, {
      center: { lat: initLat, lng: initLng },
      zoom: initZoom,
      mapTypeId: 'roadmap',
      mapTypeControl: false,
      streetViewControl: false,
      fullscreenControl: false,
    });

    // ‚îÄ‚îÄ –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const sheet = document.getElementById('mapPickerSheet');
    let isFullscreen = false;
    document.getElementById('mapFullscreenBtn').onclick = () => {
      isFullscreen = !isFullscreen;
      if (isFullscreen) {
        sheet.style.cssText = 'position:fixed;inset:0;width:100vw;max-width:100vw;height:100dvh;border-radius:0;padding:0;display:flex;flex-direction:column;';
        container.style.height = 'auto';
        container.style.flex = '1';
        document.getElementById('mapFullscreenBtn').textContent = '‚ä°';
        document.getElementById('mapFullscreenBtn').title = '–°–≤–µ—Ä–Ω—É—Ç—å';
      } else {
        sheet.style.cssText = 'max-width:95vw;width:600px;padding:0;background:var(--modal-bg,#fff) !important;border-radius:12px;overflow:hidden;transition:all .2s ease;';
        container.style.height = '55vh';
        container.style.flex = '';
        document.getElementById('mapFullscreenBtn').textContent = '‚õ∂';
        document.getElementById('mapFullscreenBtn').title = '–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω';
      }
      google.maps.event.trigger(map, 'resize');
    };

    // ‚îÄ‚îÄ –°–º–µ–Ω–∞ —Ç–∏–ø–∞ –∫–∞—Ä—Ç—ã ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const btnRoad = document.getElementById('mapTypeRoad');
    const btnSat  = document.getElementById('mapTypeSat');
    const setActive = (active, inactive) => {
      active.style.cssText   = 'border:2px solid var(--primary-color,#1976d2);background:#e8f0fe;border-radius:6px;padding:5px 10px;cursor:pointer;font-size:12px;font-weight:700;color:var(--primary-color,#1976d2);';
      inactive.style.cssText = 'border:1px solid #ccc;background:#fff;border-radius:6px;padding:5px 10px;cursor:pointer;font-size:12px;font-weight:600;color:#333;';
    };
    setActive(btnRoad, btnSat);
    btnRoad.onclick = () => { map.setMapTypeId('roadmap');   setActive(btnRoad, btnSat); };
    btnSat.onclick  = () => { map.setMapTypeId('satellite'); setActive(btnSat, btnRoad); };

    // ‚îÄ‚îÄ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let geoMarker = null;
    document.getElementById('mapGeoBtn').onclick = () => {
      if (!navigator.geolocation) { alert('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è'); return; }
      const btn = document.getElementById('mapGeoBtn');
      btn.textContent = '‚è≥ ‚Ä¶';
      navigator.geolocation.getCurrentPosition(
        pos => {
          btn.textContent = 'üì° –ú–æ—ë –º–µ—Å—Ç–æ';
          const loc = { lat: pos.coords.latitude, lng: pos.coords.longitude };
          map.panTo(loc); map.setZoom(16);
          if (geoMarker) geoMarker.setPosition(loc);
          else geoMarker = new google.maps.Marker({
            position: loc, map,
            icon: { path: google.maps.SymbolPath.CIRCLE, scale: 8, fillColor: '#4285F4', fillOpacity: 1, strokeColor: '#fff', strokeWeight: 2 },
            title: '–ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ', zIndex: 1
          });
        },
        err => { btn.textContent = 'üì° –ú–æ—ë –º–µ—Å—Ç–æ'; alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ: ' + err.message); },
        { enableHighAccuracy: true, timeout: 10000 }
      );
    };

    // ‚îÄ‚îÄ –ü–æ–∏—Å–∫ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const searchInput = Object.assign(document.createElement('input'), {
      type: 'text', placeholder: 'üîç –ü–æ–∏—Å–∫ –∞–¥—Ä–µ—Å–∞‚Ä¶',
    });
    searchInput.style.cssText = 'margin:8px;padding:7px 12px;width:240px;border:none;border-radius:6px;box-shadow:0 2px 6px rgba(0,0,0,.3);font-size:14px;outline:none;';
    const searchBox = new google.maps.places.SearchBox(searchInput);
    map.controls[google.maps.ControlPosition.TOP_LEFT].push(searchInput);
    searchBox.addListener('places_changed', () => {
      const places = searchBox.getPlaces();
      if (!places?.length) return;
      map.panTo(places[0].geometry.location);
      map.setZoom(16);
    });

    // ‚îÄ‚îÄ –ú–∞—Ä–∫–µ—Ä ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let marker = null;
    const coordsSpan = document.getElementById('mapPickerCoords');
    const confirmBtn = document.getElementById('mapPickerConfirm');

    const placeMarker = (latLng) => {
      pickedLat = latLng.lat(); pickedLng = latLng.lng();
      coordsSpan.textContent = `${pickedLat.toFixed(6)}, ${pickedLng.toFixed(6)}`;
      confirmBtn.disabled = false;
      if (marker) marker.setPosition(latLng);
      else {
        marker = new google.maps.Marker({ position: latLng, map, draggable: true, animation: google.maps.Animation.DROP });
        marker.addListener('dragend', e => {
          pickedLat = e.latLng.lat(); pickedLng = e.latLng.lng();
          coordsSpan.textContent = `${pickedLat.toFixed(6)}, ${pickedLng.toFixed(6)}`;
        });
      }
    };

    if (m) placeMarker(new google.maps.LatLng(initLat, initLng));
    map.addListener('click', e => placeMarker(e.latLng));
  };

  if (window.google?.maps) {
    container.innerHTML = '';
    initMap();
  } else {
    container.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:#888;">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã‚Ä¶</div>';
    const script = document.createElement('script');
    script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&libraries=places&callback=__mapPickerInit`;
    script.async = true;
    window.__mapPickerInit = () => { container.innerHTML = ''; initMap(); };
    document.head.appendChild(script);
  }

  // –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
  confirmBtn.onclick = () => {
    if (pickedLat === null) return;
    this.elements.coordsInput.value = `${pickedLat.toFixed(6)},${pickedLng.toFixed(6)}`;
    modal.style.display = 'none';
  };

  // –ó–∞–∫—Ä—ã—Ç—å
  const close = () => { modal.style.display = 'none'; pickedLat = null; };
  document.getElementById('mapPickerClose').onclick = close;
  document.getElementById('mapPickerCancel').onclick = close;
}
addParticipant() {
this.openAddTypeModal();
}
openAddTypeModal() {
const modal = document.getElementById('addTypeModal');
const treffSelect = document.getElementById('treffpunktSelect');
const kollegeSelect = document.getElementById('kollegeSelect');
const newKollegeRow = document.getElementById('newKollegeRow');
const newKollegeName = document.getElementById('newKollegeName');

// –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ Treffpunkt
treffSelect.innerHTML = '<option value="">‚Äì Treffpunkt w√§hlen ‚Äì</option>';
Object.keys(this.treffpunkt).forEach(name => {
const opt = document.createElement('option');
opt.value = name;
opt.textContent = name;
treffSelect.appendChild(opt);
});
const newTreffOpt = document.createElement('option');
newTreffOpt.value = 'add-new-treff';
newTreffOpt.textContent = '‚ûï Neuer Treffpunkt‚Ä¶';
treffSelect.appendChild(newTreffOpt);

// –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–ª–ª–µ–≥
kollegeSelect.innerHTML = '<option value="">‚Äì Kollege w√§hlen ‚Äì</option>';
Object.keys(this.nameToCoordinates)
.filter(name => !this.getAllUsedNames().has(name) && !this.treffpunkt[name])
.sort()
.forEach(name => {
const opt = document.createElement('option');
opt.value = name;
opt.textContent = name;
kollegeSelect.appendChild(opt);
});
// –û–ø—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∏–º–µ–Ω–∏
const newOpt = document.createElement('option');
newOpt.value = 'add-new';
newOpt.textContent = '‚ûï Neuer Kollege‚Ä¶';
kollegeSelect.appendChild(newOpt);

// –°–±—Ä–æ—Å
treffSelect.value = '';
kollegeSelect.value = '';
newKollegeRow.classList.remove('visible');
newKollegeName.value = '';

// –í–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–µ–Ω–∏–µ + –ø–æ–∫–∞–∑ –ø–æ–ª—è –Ω–æ–≤–æ–≥–æ –∏–º–µ–Ω–∏
treffSelect.onchange = () => {
if (treffSelect.value === 'add-new-treff') {
  treffSelect.value = '';
  document.getElementById('addTypeModal').classList.remove('show');
  // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∫–∞–∫ "Neuer Treffpunkt" ‚Äî –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º isAddingNewName
  // –Ω–æ —Å –ø–æ–º–µ—Ç–∫–æ–π —á—Ç–æ —ç—Ç–æ –¥–ª—è treffpunkt
  this.isAddingNewTreffpunkt = true;
  this.openCoordsModal(null, false, true); // isAddingNewName=true –æ—Ç–∫—Ä–æ–µ—Ç –ø–æ–ª—è –∏–º–µ–Ω–∏+–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
  // –ü–æ–º–µ–Ω—è—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è
  setTimeout(() => { const t = document.getElementById('modalTitle'); if (t) t.textContent = 'Neuer Treffpunkt'; }, 10);
} else if (treffSelect.value) {
  kollegeSelect.value = '';
  newKollegeRow.classList.remove('visible');
}
};
kollegeSelect.onchange = () => {
if (kollegeSelect.value) treffSelect.value = '';
if (kollegeSelect.value === 'add-new') {
kollegeSelect.value = '';
document.getElementById('addTypeModal').classList.remove('show');
this.openCoordsModal(null, false, false, false, false, true); // isAddingNewKollege
} else {
newKollegeRow.classList.remove('visible');
newKollegeName.value = '';
}
};

modal.classList.add('show');
}
addParticipantFromModal() {
const treffSelect = document.getElementById('treffpunktSelect');
const kollegeSelect = document.getElementById('kollegeSelect');
const newKollegeName = document.getElementById('newKollegeName');
const treffVal = treffSelect.value;
const kollegeVal = kollegeSelect.value;

if (!treffVal && !kollegeVal) {
this.showToast('‚ö†Ô∏è Bitte w√§hlen Sie einen Treffpunkt oder Kollegen');
return;
}

if (treffVal) {
// –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–∫ Treffpunkt-—É—á–∞—Å—Ç–Ω–∏–∫–∞
const coords = this.treffpunkt[treffVal] || { lat: null, lng: null };
this.participants.push({
name: treffVal,
time: 5,
lat: coords.lat,
lng: coords.lng,
timeManuallyEdited: false,
isTreffpunkt: true,
treffpunktPersons: []
});
} else if (kollegeVal === 'add-new') {
// –ù–æ–≤—ã–π –∫–æ–ª–ª–µ–≥–∞ ‚Äî –≤–≤–æ–¥–∏—Ç—Å—è –≤—Ä—É—á–Ω—É—é
const newName = newKollegeName.value.trim();
if (!newName) {
this.showToast('‚ö†Ô∏è Bitte einen Namen eingeben');
newKollegeName.focus();
return;
}
if (this.nameToCoordinates[newName]) {
this.showToast(`‚ö†Ô∏è "${newName}" existiert bereits`);
newKollegeName.focus();
return;
}
// –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ä–µ–µ—Å—Ç—Ä (–±–µ–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç)
this.nameToCoordinates[newName] = { lat: null, lng: null };
this.participants.push({
name: newName,
time: 5,
lat: null,
lng: null,
timeManuallyEdited: false,
isTreffpunkt: false,
subParticipants: [],
treffpunktPersons: []
});
this.showToast(`‚úÖ "${newName}" hinzugef√ºgt`);
} else {
// –û–±—ã—á–Ω—ã–π –∫–æ–ª–ª–µ–≥–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
const coords = this.nameToCoordinates[kollegeVal] || { lat: null, lng: null };
this.participants.push({
name: kollegeVal,
time: 5,
lat: coords.lat,
lng: coords.lng,
timeManuallyEdited: false,
isTreffpunkt: false,
subParticipants: [],
treffpunktPersons: []
});
}

document.getElementById('addTypeModal').classList.remove('show');
this.updateParticipantTimes();
this.saveData();
this.renderParticipants();
this.initSortable();
this.calculate();
}
editParticipantTime(index, displayElement) {
// –°–æ–∑–¥–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
const input = document.createElement('input');
input.type = 'text';
const minutes = this.participants[index].time;
const hours = Math.floor(minutes / 60);
const mins = minutes % 60;
input.value = hours > 0 ? `${hours}.${mins.toString().padStart(2, '0')}` : `${minutes}`;
input.placeholder = '3.30';
input.style.width = '55px';
input.style.maxWidth = '55px';
input.style.minWidth = '60px';
input.style.padding = '6px 10px';
input.style.border = '2px solid var(--primary-color)';
input.style.borderRadius = '4px';
input.style.fontSize = '0.95em';
input.style.textAlign = 'center';
input.style.background = 'var(--surface)';
input.style.color = 'var(--text)';

input.style.boxSizing = 'border-box';

// –í—Å—Ç–∞–≤–ª—è–µ–º –ø–æ–ª–µ –≤–º–µ—Å—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
displayElement.classList.add('editing');
displayElement.parentNode.insertBefore(input, displayElement);

const saveTime = () => {
const value = input.value.trim();
let totalMinutes = 0;
if (value.includes('.') || value.includes(':')) {
// –§–æ—Ä–º–∞—Ç: 3.30 –∏–ª–∏ 3:30
const parts = value.split(/[.:]/).map(p => parseInt(p) || 0);
totalMinutes = (parts[0] || 0) * 60 + (parts[1] || 0);
} else {
// –ü—Ä–æ—Å—Ç–æ –º–∏–Ω—É—Ç—ã: 45
totalMinutes = parseInt(value) || 0;
}
this.participants[index].time = Math.max(1, Math.min(999, totalMinutes));
this.participants[index].timeManuallyEdited = true;
input.remove();
displayElement.classList.remove('editing');
this.saveData();
this.renderParticipants();
this.initSortable();
this.calculate();
};

input.addEventListener('blur', saveTime);
input.addEventListener('keypress', (e) => {
if (e.key === 'Enter') saveTime();
});
input.focus();
input.select();
}
editMachineTime(displayElement) {
// –°–æ–∑–¥–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
const input = document.createElement('input');
input.type = 'text';
const minutes = this.machineStop.time;
const hours = Math.floor(minutes / 60);
const mins = minutes % 60;
input.value = hours > 0 ? `${hours}.${mins.toString().padStart(2, '0')}` : `${minutes}`;
input.placeholder = '3.30';
input.style.width = '55px';
input.style.maxWidth = '55px';
input.style.minWidth = '60px';
input.style.padding = '6px 6px';
input.style.border = '2px solid var(--primary-color)';
input.style.borderRadius = '4px';
input.style.fontSize = '0.95em';
input.style.textAlign = 'center';
input.style.background = 'var(--surface)';
input.style.color = 'var(--text)';

input.style.boxSizing = 'border-box';

// –í—Å—Ç–∞–≤–ª—è–µ–º –ø–æ–ª–µ –≤–º–µ—Å—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
displayElement.classList.add('editing');
displayElement.parentNode.insertBefore(input, displayElement);

const saveTime = () => {
const value = input.value.trim();
let totalMinutes = 0;
if (value.includes('.') || value.includes(':')) {
// –§–æ—Ä–º–∞—Ç: 3.30 –∏–ª–∏ 3:30
const parts = value.split(/[.:]/).map(p => parseInt(p) || 0);
totalMinutes = (parts[0] || 0) * 60 + (parts[1] || 0);
} else {
// –ü—Ä–æ—Å—Ç–æ –º–∏–Ω—É—Ç—ã: 45
totalMinutes = parseInt(value) || 0;
}
this.machineStop.time = Math.max(1, Math.min(999, totalMinutes));
this.machineStop.autoCalculated = false;
input.remove();
displayElement.classList.remove('editing');
this.saveData();
this.renderParticipants();
this.calculate();
};

input.addEventListener('blur', saveTime);
input.addEventListener('keypress', (e) => {
if (e.key === 'Enter') saveTime();
});
input.focus();
input.select();
}
updateName(index, value) {
if (value === 'add-new') this.openCoordsModal(index, false, true);
else {
this.participants[index].name = value;
const coords = this.nameToCoordinates[value] || { lat: null, lng: null };
this.participants[index].lat = coords.lat;
this.participants[index].lng = coords.lng;
this.participants[index].timeManuallyEdited = false;
this.updateParticipantTimes();
this.saveData();
this.renderParticipants();
this.initSortable();
this.calculate();
}
}
updateTime(index, value) {
const time = parseInt(value) || 5;
this.participants[index].time = Math.max(1, Math.min(120, time));
this.participants[index].timeManuallyEdited = true;
this.saveData();
this.renderParticipants();
this.calculate();
}
openSubParticipantModal(mainIndex) {
this.currentMainParticipantIndex = mainIndex;
const modal = document.getElementById('subModal');
const select = document.getElementById('subParticipantSelect');
const newSubNameRow = document.getElementById('newSubNameRow');
const newSubNameInput = document.getElementById('newSubName');
const mainParticipant = this.participants[mainIndex];

// –°–±—Ä–æ—Å –ø–æ–ª—è –Ω–æ–≤–æ–≥–æ –∏–º–µ–Ω–∏
newSubNameRow.classList.remove('visible');
newSubNameInput.value = '';

// –°–æ–±–∏—Ä–∞–µ–º –∑–∞–Ω—è—Ç—ã–µ –∏–º–µ–Ω–∞
const usedNames = this.getAllUsedNames();

select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞</option>';
Object.keys(this.nameToCoordinates)
.filter(name => !usedNames.has(name))
.sort()
.forEach(name => {
const option = document.createElement('option');
option.value = name;
option.textContent = name;
select.appendChild(option);
});
// –û–ø—Ü–∏—è –Ω–æ–≤–æ–≥–æ –∏–º–µ–Ω–∏
const newOpt = document.createElement('option');
newOpt.value = 'add-new';
newOpt.textContent = '‚ûï Neue Person‚Ä¶';
select.appendChild(newOpt);

// –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ –ø–æ–ª—è –≤–≤–æ–¥–∞
select.onchange = () => {
if (select.value === 'add-new') {
select.value = '';
document.getElementById('subModal').classList.remove('show');
this.openCoordsModal(null, false, false, false, false, false, true); // isAddingNewSubPerson
} else {
newSubNameRow.classList.remove('visible');
newSubNameInput.value = '';
}
};

modal.classList.add('show');
setTimeout(() => select.focus(), 100);
}
addSubParticipant() {
// –ï—Å–ª–∏ —Ç–µ–∫—É—â–∏–π —É—á–∞—Å—Ç–Ω–∏–∫ ‚Äî Treffpunkt, –¥–æ–±–∞–≤–ª—è–µ–º –∫–∞–∫ treffpunktPerson
const mainIndex = this.currentMainParticipantIndex;
if (mainIndex !== null && this.participants[mainIndex] && this.participants[mainIndex].isTreffpunkt) {
this.addTreffpunktPerson();
return;
}
const select = document.getElementById('subParticipantSelect');
const newSubNameInput = document.getElementById('newSubName');
let selectedName = select.value;

if (!selectedName) {
this.showToast('‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞');
return;
}

// –ù–æ–≤–æ–µ –∏–º—è –≤–≤–µ–¥–µ–Ω–æ –≤—Ä—É—á–Ω—É—é
if (selectedName === 'add-new') {
const newName = newSubNameInput.value.trim();
if (!newName) {
this.showToast('‚ö†Ô∏è Bitte einen Namen eingeben');
newSubNameInput.focus();
return;
}
if (this.nameToCoordinates[newName]) {
this.showToast(`‚ö†Ô∏è "${newName}" existiert bereits`);
newSubNameInput.focus();
return;
}
this.nameToCoordinates[newName] = { lat: null, lng: null };
selectedName = newName;
}

if (!this.participants[mainIndex].subParticipants) {
this.participants[mainIndex].subParticipants = [];
}
this.participants[mainIndex].subParticipants.push(selectedName);
document.getElementById('subModal').classList.remove('show');
this.saveData();
this.renderParticipants();
this.initSortable();
this.calculate();
this.showToast(`‚úÖ ${selectedName} –¥–æ–±–∞–≤–ª–µ–Ω`);
}
removeSubParticipant(mainIndex, subIndex) {
const removedName = this.participants[mainIndex].subParticipants[subIndex];
this.participants[mainIndex].subParticipants.splice(subIndex, 1);
this.saveData();
this.renderParticipants();
this.initSortable();
this.calculate();
this.showToast(`üóëÔ∏è ${removedName} —É–¥–∞–ª–µ–Ω`);
}
updateSubParticipant(mainIndex, subIndex, newName) {
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏: –Ω–µ –¥–æ–ø—É—Å–∫–∞–µ–º –≤—ã–±–æ—Ä —É–∂–µ –∑–∞–Ω—è—Ç–æ–≥–æ –∏–º–µ–Ω–∏
const p = this.participants[mainIndex];
const usedNames = new Set([p.name]);
p.subParticipants.forEach((n, idx) => {
if (idx !== subIndex) usedNames.add(n);
});
// –¢–∞–∫–∂–µ –∏–º–µ–Ω–∞ —Å—É–±—É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥—Ä—É–≥–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
this.participants.forEach((other, idx) => {
if (idx !== mainIndex) {
(other.subParticipants || []).forEach(n => usedNames.add(n));
}
});
if (usedNames.has(newName)) {
this.showToast(`‚ö†Ô∏è ${newName} —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è`);
this.renderParticipants();
return;
}
this.participants[mainIndex].subParticipants[subIndex] = newName;
this.saveData();
this.calculate();
}
// ===== –ú–µ—Ç–æ–¥—ã –¥–ª—è Treffpunkt =====
updateTreffpunktName(index, newName) {
const coords = this.treffpunkt[newName] || { lat: null, lng: null };
this.participants[index].name = newName;
this.participants[index].lat = coords.lat;
this.participants[index].lng = coords.lng;
this.participants[index].timeManuallyEdited = false;
this.updateParticipantTimes();
this.saveData();
this.renderParticipants();
this.initSortable();
this.calculate();
}
openTreffpunktPersonModal(mainIndex) {
this.currentMainParticipantIndex = mainIndex;
const modal = document.getElementById('subModal');
const select = document.getElementById('subParticipantSelect');
const newSubNameRow = document.getElementById('newSubNameRow');
const newSubNameInput = document.getElementById('newSubName');
const mainParticipant = this.participants[mainIndex];

// –°–±—Ä–æ—Å –ø–æ–ª—è –Ω–æ–≤–æ–≥–æ –∏–º–µ–Ω–∏
newSubNameRow.classList.remove('visible');
newSubNameInput.value = '';

// –°–æ–±–∏—Ä–∞–µ–º –∑–∞–Ω—è—Ç—ã–µ –∏–º–µ–Ω–∞
const usedNames = this.getAllUsedNames();

select.innerHTML = '<option value="">Person ausw√§hlen</option>';
Object.keys(this.nameToCoordinates)
.filter(name => !usedNames.has(name) && !this.treffpunkt[name])
.sort()
.forEach(name => {
const option = document.createElement('option');
option.value = name;
option.textContent = name;
select.appendChild(option);
});
// –û–ø—Ü–∏—è –Ω–æ–≤–æ–≥–æ –∏–º–µ–Ω–∏
const newOpt = document.createElement('option');
newOpt.value = 'add-new';
newOpt.textContent = '‚ûï Neue Person‚Ä¶';
select.appendChild(newOpt);

// –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ –ø–æ–ª—è –≤–≤–æ–¥–∞
select.onchange = () => {
if (select.value === 'add-new') {
select.value = '';
document.getElementById('subModal').classList.remove('show');
this.openCoordsModal(null, false, false, false, false, false, true); // isAddingNewSubPerson
} else {
newSubNameRow.classList.remove('visible');
newSubNameInput.value = '';
}
};

modal.classList.add('show');
setTimeout(() => select.focus(), 100);
}
addTreffpunktPerson() {
const select = document.getElementById('subParticipantSelect');
const newSubNameInput = document.getElementById('newSubName');
let selectedName = select.value;

if (!selectedName) {
this.showToast('‚ö†Ô∏è Bitte Person ausw√§hlen');
return;
}

// –ù–æ–≤–æ–µ –∏–º—è –≤–≤–µ–¥–µ–Ω–æ –≤—Ä—É—á–Ω—É—é
if (selectedName === 'add-new') {
const newName = newSubNameInput.value.trim();
if (!newName) {
this.showToast('‚ö†Ô∏è Bitte einen Namen eingeben');
newSubNameInput.focus();
return;
}
if (this.nameToCoordinates[newName]) {
this.showToast(`‚ö†Ô∏è "${newName}" existiert bereits`);
newSubNameInput.focus();
return;
}
this.nameToCoordinates[newName] = { lat: null, lng: null };
selectedName = newName;
}

const mainIndex = this.currentMainParticipantIndex;
if (!this.participants[mainIndex].treffpunktPersons) {
this.participants[mainIndex].treffpunktPersons = [];
}
this.participants[mainIndex].treffpunktPersons.push(selectedName);
document.getElementById('subModal').classList.remove('show');
this.saveData();
this.renderParticipants();
this.initSortable();
this.calculate();
this.showToast(`‚úÖ ${selectedName} ‚Üí ${this.participants[mainIndex].name}`);
}
removeTreffpunktPerson(mainIndex, personIdx) {
const removedName = this.participants[mainIndex].treffpunktPersons[personIdx];
this.participants[mainIndex].treffpunktPersons.splice(personIdx, 1);
this.saveData();
this.renderParticipants();
this.initSortable();
this.calculate();
this.showToast(`üóëÔ∏è ${removedName} entfernt`);
}
updateTreffpunktPerson(mainIndex, personIdx, newName) {
this.participants[mainIndex].treffpunktPersons[personIdx] = newName;
this.saveData();
this.calculate();
}
async calculateTravelTimeToMachine() {
// –ù–∞—Ö–æ–¥–∏–º –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
const validParticipants = this.participants.filter(p => p.name && p.lat && p.lng);
if (validParticipants.length === 0) {
this.showToast('‚ö†Ô∏è –ù–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏');
return;
}
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –º–∞—à–∏–Ω—ã
if (!this.machineStop.lat || !this.machineStop.lng) {
this.showToast('‚ö†Ô∏è –£–∫–∞–∂–∏—Ç–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –º–∞—à–∏–Ω—ã');
return;
}
const lastParticipant = validParticipants[validParticipants.length - 1];

// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—Ä–µ–º—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ç—Ä–∞—Ñ–∏–∫–∞
let departureTime = 'now';
if (this.machineStop.arrivalTime) {
// –ï—Å–ª–∏ –∑–∞–¥–∞–Ω–æ –≤—Ä–µ–º—è –ø—Ä–∏–±—ã—Ç–∏—è, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º departure_time
const [hours, minutes] = this.machineStop.arrivalTime.split(':');
const arrivalDate = new Date();
arrivalDate.setHours(parseInt(hours), parseInt(minutes), 0, 0);
// –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ Unix timestamp (—Å–µ–∫—É–Ω–¥—ã)
departureTime = Math.floor(arrivalDate.getTime() / 1000).toString();
}

try {
this.showToast('üîÑ –†–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –≤ –ø—É—Ç–∏...');

// –í—ã–∑—ã–≤–∞–µ–º Vercel serverless function
const response = await fetch('/api/calculate-time', {
method: 'POST',
headers: {
'Content-Type': 'application/json',
},
body: JSON.stringify({
originLat: lastParticipant.lat,
originLng: lastParticipant.lng,
destLat: this.machineStop.lat,
destLng: this.machineStop.lng,
departureTime: departureTime
})
});

if (!response.ok) {
const errorData = await response.json();
throw new Error(errorData.message || '–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ API');
}

const data = await response.json();

if (data.success) {
// –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –º–∞—à–∏–Ω—ã
this.machineStop.time = data.duration.minutes;
this.machineStop.autoCalculated = true;
this.saveData();
this.renderParticipants();
this.calculate();

const timeInfo = this.machineStop.arrivalTime ? ` –∫ ${this.machineStop.arrivalTime}` : ' —Å–µ–π—á–∞—Å';
const trafficInfo = data.hasTraffic ? ' (—Å —É—á–µ—Ç–æ–º —Ç—Ä–∞—Ñ–∏–∫–∞)' : '';
this.showToast(`‚úÖ ${data.duration.minutes} –º–∏–Ω (${data.distance.km} –∫–º)${timeInfo}${trafficInfo}`);
console.log(`–í—Ä–µ–º—è –≤ –ø—É—Ç–∏: ${data.duration.minutes} –º–∏–Ω, –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${data.distance.km} –∫–º, –í—Ä–µ–º—è: ${timeInfo}${trafficInfo}`);
} else {
throw new Error('–û—à–∏–±–∫–∞ –≤ –æ—Ç–≤–µ—Ç–µ API');
}
} catch (error) {
console.error('–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞:', error);
this.showToast(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
}
}
updateMachineName(value) {
this.machineStop.name = value.trim() || 'an der Maschine';
this.saveData();
this.calculate();
}
updateMachineTime(value) {
const time = parseInt(value) || 20;
this.machineStop.time = Math.max(1, Math.min(720, time));
this.machineStop.autoCalculated = false;  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –ø—Ä–∏ —Ä—É—á–Ω–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏
this.saveData();
this.calculate();
}
clearArrivalTime() {
this.machineStop.arrivalTime = "";
this.saveData();
this.elements.output.innerHTML = '';
this.renderParticipants();
}
startTimeEdit() {
const container = document.querySelector('.machine .right-section');
const existingInput = container.querySelector('input[type="time"]');
if (existingInput) existingInput.remove();
const input = document.createElement('input');
input.type = 'time';
input.style.width = '100px';
input.style.padding = 'var(--small-spacing)';
input.style.border = '1px solid #ddd';
input.style.borderRadius = '4px';
input.style.fontSize = '1em';
input.value = this.machineStop.arrivalTime || '';
const timeControl = container.querySelector('.time-icon') || container.querySelector('.arrival-time');
container.insertBefore(input, timeControl);
timeControl.style.display = 'none';
const saveTime = () => {
this.machineStop.arrivalTime = input.value;
container.removeChild(input);
timeControl.style.display = 'flex';
this.renderParticipants();
this.initSortable();
this.calculate();
input.removeEventListener('change', saveTime);
input.removeEventListener('blur', saveTime);
};
input.addEventListener('change', saveTime);
input.addEventListener('blur', () => setTimeout(saveTime, 50));
input.focus();
try { input.showPicker(); } catch { }
}
initSortable() {
if (this.sortable) this.sortable.destroy();
this.sortable = new Sortable(this.elements.participantsContainer, {
handle: '.material-symbols-outlined',
animation: 150,
onEnd: evt => {
if (evt.oldIndex !== evt.newIndex) {
const [moved] = this.participants.splice(evt.oldIndex, 1);
this.participants.splice(evt.newIndex, 0, moved);
this.updateParticipantTimes();
this.saveData();
this.renderParticipants();
this.calculate();
}
}
});
}
showToast(message) {
this.elements.toast.textContent = message;
this.elements.toast.classList.add('show');
setTimeout(() => this.elements.toast.classList.remove('show'), 3000);
}
formatTime(date) {
if (this.useSuperscriptTime) {
const hours = date.getHours().toString().padStart(2, '0');
const minutes = date.getMinutes().toString().padStart(2, '0');
const superscriptDigits = ['‚Å∞', '¬π', '¬≤', '¬≥', '‚Å¥', '‚Åµ', '‚Å∂', '‚Å∑', '‚Å∏', '‚Åπ'];
const superscriptMinutes = minutes.split('').map(d => superscriptDigits[parseInt(d)]).join('');
return `${hours}${superscriptMinutes}`;
}
return date.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
}
calculate(){
if(!this.machineStop.arrivalTime){this.elements.output.innerHTML='';return}
let out=`${this.greeting},
`;
const valid=this.participants.filter(p=>p.name);
const total=valid.reduce((s,p)=>s+p.time,0)+this.machineStop.time;
// 1. –í–´–ß–ò–°–õ–Ø–ï–ú –í–†–ï–ú–Ø –°–¢–ê–†–¢–ê
const startTime=new Date(`2025-07-25T${this.machineStop.arrivalTime}:00`);
startTime.setMinutes(startTime.getMinutes()-total);
// 2. –§–û–†–ú–ò–†–£–ï–ú –í–´–í–û–î
out+=this.useUhrBei
? `um ${this.formatTime(startTime)} Uhr geht's los
`
: `${this.formatTime(startTime)}  geht's los
`;
let current=new Date(startTime);
valid.forEach(p=>{
current.setMinutes(current.getMinutes()+p.time);
let line = '';
if (p.isTreffpunkt) {
// Treffpunkt: —Ñ–æ—Ä–º–∞—Ç "12:00 Ren√© (Olga-Park)" –∏–ª–∏ "12:00 Ren√©, Vasyl und Alex (Olga-Park)"
const persons = (p.treffpunktPersons || []).filter(n => n);
let personsStr = '';
if (persons.length === 0) {
personsStr = p.name; // –ø—Ä–æ—Å—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–µ, –µ—Å–ª–∏ –Ω–∏–∫–æ–≥–æ –Ω–µ –¥–æ–±–∞–≤–∏–ª–∏
} else if (persons.length === 1) {
personsStr = `${persons[0]} (${p.name})`;
} else if (persons.length === 2) {
personsStr = `${persons[0]} und ${persons[1]} (${p.name})`;
} else {
personsStr = persons.slice(0, -1).join(', ') + ' und ' + persons[persons.length - 1] + ` (${p.name})`;
}
line = this.useUhrBei
? `um ${this.formatTime(current)} Uhr bei ${personsStr}
`
: `${this.formatTime(current)}  ${personsStr}
`;
} else {
// –û–±—ã—á–Ω—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–¥)
let names = p.name;
if (p.subParticipants && p.subParticipants.length > 0) {
const subs = p.subParticipants.filter(n => n);
if (subs.length > 0) {
const all = [p.name, ...subs];
if (all.length === 2) {
names = `${all[0]} und ${all[1]}`;
} else {
names = all.slice(0, -1).join(', ') + ' und ' + all[all.length - 1];
}
}
}
line = this.useUhrBei
? `um ${this.formatTime(current)} Uhr bei ${names}
`
: `${this.formatTime(current)}  ${names}
`;
}
out += line;
});
// –í—Ä–µ–º—è –ø—Ä–∏–±—ã—Ç–∏—è –∫ –º–∞—à–∏–Ω–µ
const machineTime=new Date(`2025-07-25T${this.machineStop.arrivalTime}:00`);
out+=this.useUhrBei
? `um ${this.formatTime(machineTime)} Uhr ${this.machineStop.name}
`
: `${this.formatTime(machineTime)}  ${this.machineStop.name}
`;
this.elements.output.innerHTML=out;
}

// ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø ‚Äî –° –£–ß–Å–¢–û–ú –¢–í–û–ï–ì–û –£–¢–û–ß–ù–ï–ù–ò–Ø
openGoogleMaps(returnTrip = false) {
  const validParticipants = this.participants.filter(p => p.name && p.lat && p.lng);

  // –ú–∞—Ä—à—Ä—É—Ç —Ç—É–¥–∞ —Ç—Ä–µ–±—É–µ—Ç —Ö–æ—Ç—è –±—ã –∫–æ–Ω–µ—á–Ω—É—é —Ç–æ—á–∫—É (–º–∞—à–∏–Ω—É) –∏–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞
  if (!returnTrip) {
    const hasDest = this.machineStop.lat && this.machineStop.lng;
    if (validParticipants.length === 0 && !hasDest) {
      this.showToast("–£–∫–∞–∂–∏—Ç–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–æ–Ω–µ—á–Ω–æ–π —Ç–æ—á–∫–∏ –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.");
      return;
    }
  }

  if (!navigator.geolocation) {
    this.showToast("–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è.");
    return;
  }

  navigator.geolocation.getCurrentPosition(
    (position) => {
      const currentLat = position.coords.latitude;
      const currentLng = position.coords.longitude;
      const origin = `${currentLat},${currentLng}`;

      let waypoints = [];
      let destination;

      if (!returnTrip) {
        // ‚û§ –ú–∞—Ä—à—Ä—É—Ç –¢–£–î–ê: —Ç–µ–∫—É—â–µ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ ‚Üí —É—á–∞—Å—Ç–Ω–∏–∫–∏ ‚Üí –º–∞—à–∏–Ω–∞
        waypoints = validParticipants.map(p => `${p.lat},${p.lng}`);
        if (this.machineStop.lat && this.machineStop.lng) {
          destination = `${this.machineStop.lat},${this.machineStop.lng}`;
        } else {
          // –ù–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –º–∞—à–∏–Ω—ã ‚Äî –∫–æ–Ω–µ—Ü –º–∞—Ä—à—Ä—É—Ç–∞ = –ø–æ—Å–ª–µ–¥–Ω–∏–π —É—á–∞—Å—Ç–Ω–∏–∫
          destination = waypoints.pop();
        }
      } else {
        // ‚óÄ –ú–∞—Ä—à—Ä—É—Ç –û–ë–†–ê–¢–ù–û: —Ç–µ–∫—É—â–µ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ ‚Üí —É—á–∞—Å—Ç–Ω–∏–∫–∏ (–æ–±—Ä–∞—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫) ‚Üí –¥–æ–º –≤–æ–¥–∏—Ç–µ–ª—è
        if (!this.startPointCoords.lat || !this.startPointCoords.lng) {
          this.showToast("–£–∫–∞–∂–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—É—é —Ç–æ—á–∫—É (–¥–æ–º –≤–æ–¥–∏—Ç–µ–ª—è) –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∞ –æ–±—Ä–∞—Ç–Ω–æ.");
          return;
        }
        if (validParticipants.length === 0) {
          this.showToast("–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∞ –æ–±—Ä–∞—Ç–Ω–æ.");
          return;
        }
        waypoints = [...validParticipants].reverse().map(p => `${p.lat},${p.lng}`);
        destination = `${this.startPointCoords.lat},${this.startPointCoords.lng}`;
      }

      let url = 'https://www.google.com/maps/dir/?api=1';
      url += `&origin=${encodeURIComponent(origin)}`;
      url += `&destination=${encodeURIComponent(destination)}`;
      if (waypoints.length > 0) {
        url += `&waypoints=${encodeURIComponent(waypoints.join('|'))}`;
      }
      url += '&travelmode=driving';

      window.open(url, '_blank');
    },
    (error) => {
      console.error("–û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:", error);
      this.showToast("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏.");
    },
    { enableHighAccuracy: true, timeout: 10000, maximumAge: 60000 }
  );
}

// ‚ùå –£–î–ê–õ–ï–ù–ê –§–£–ù–ö–¶–ò–Ø openGoogleMapsInNewTab

copyResult() {
const text = this.elements.output.textContent.trim();
if (!text) {
this.showToast("–ù–µ—á–µ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å ‚Äî —Å–Ω–∞—á–∞–ª–∞ —Ä–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ –º–∞—Ä—à—Ä—É—Ç.");
return;
}
navigator.clipboard.writeText(text)
.then(() => this.showToast("üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ"))
.catch(() => this.showToast("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å ‚Äî —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –±—É—Ñ–µ—Ä—É –æ–±–º–µ–Ω–∞."));
}
removeParticipant(index) {
this.participants.splice(index, 1);
this.updateParticipantTimes();
this.saveData();
this.renderParticipants();
this.initSortable();
this.calculate();
}
}
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
const app = new FahrzeitRechner();
app.loadStations();
// ---------- —Ç–µ–º–∞ ----------
const switcher = document.getElementById('themeSwitch');
if (!switcher) return;
// –£–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –¶–í–ï–¢ –°–¢–ê–¢–£–°-–ë–ê–†–ê –°–†–ê–ó–£
const meta = document.getElementById('theme-meta');
meta.content = (localStorage.theme === 'dark') ? '#121212' : '#f0f0f0';
// –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é —Ç–µ–º—É
if (localStorage.theme === 'dark') document.body.classList.add('dark');
switcher.checked = localStorage.theme === 'dark';
// –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –ø–æ –∫–ª–∏–∫—É
switcher.addEventListener('change', e => {
document.body.classList.toggle('dark', e.target.checked);
localStorage.theme = e.target.checked ? 'dark' : 'light';
meta.content = e.target.checked ? '#121212' : '#f0f0f0';
});
});
</script>
<!-- –ø–æ–¥–∫–ª—é—á–∞–µ–º bcrypt -->
<script src="
https://cdn.jsdelivr.net/npm/bcryptjs@3.0.2/umd/index.min.js
"></script>
<script>
// —Ö—ç—à –ø–∞—Ä–æ–ª—è '266214' (10 —Ä–∞—É–Ω–¥–æ–≤)
const GOD_HASH = '$2a$12$O3Syhnm4rRn55bdKSmkZ5e9ptITFc23gshbj2NugI2N/khhcZlwOm';
document.addEventListener('DOMContentLoaded', () => {
const link = document.getElementById('godL');
const modal = document.getElementById('godModal');
const input = document.getElementById('godPasswordInput');
const submitBtn = document.getElementById('godSubmitBtn');
const cancelBtn = document.getElementById('godCancelBtn');

if (!link) { console.error('godL –Ω–µ –Ω–∞–π–¥–µ–Ω'); return; }

// –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
link.addEventListener('click', (e) => {
e.preventDefault();
modal.classList.add('show');
input.value = '';
input.classList.remove('error');
});

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
const closeModal = () => {
modal.classList.remove('show');
input.value = '';
input.classList.remove('error');
};

// –û—Ç–º–µ–Ω–∞
cancelBtn.addEventListener('click', closeModal);

// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
modal.addEventListener('click', (e) => {
if (e.target === modal) closeModal();
});

// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ Escape
document.addEventListener('keydown', (e) => {
if (e.key === 'Escape' && modal.classList.contains('show')) {
closeModal();
}
});

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
const checkPassword = async () => {
const pwd = input.value.trim();
if (!pwd) {
input.classList.add('error');
return;
}

// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º loader
submitBtn.innerHTML = '–ü—Ä–æ–≤–µ—Ä–∫–∞...<span class="god-loader"></span>';
submitBtn.disabled = true;

try {
const ok = await bcrypt.compare(pwd, GOD_HASH);
if (ok) {
submitBtn.innerHTML = '‚úÖ –£—Å–ø–µ—à–Ω–æ!';
setTimeout(() => {
window.location.href = link.href;
}, 500);
} else {
submitBtn.innerHTML = '–í–æ–π—Ç–∏';
submitBtn.disabled = false;
input.classList.add('error');
input.value = '';
input.focus();
// –ù–µ–±–æ–ª—å—à–∞—è –≤–∏–±—Ä–∞—Ü–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
if (navigator.vibrate) navigator.vibrate(200);
}
} catch (error) {
console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–æ–ª—è:', error);
submitBtn.innerHTML = '–í–æ–π—Ç–∏';
submitBtn.disabled = false;
}
};

// –ö–Ω–æ–ø–∫–∞ "–í–æ–π—Ç–∏"
submitBtn.addEventListener('click', checkPassword);

// Enter –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
input.addEventListener('keypress', (e) => {
if (e.key === 'Enter') {
checkPassword();
}
});

// –£–±–∏—Ä–∞–µ–º –æ—à–∏–±–∫—É –ø—Ä–∏ –≤–≤–æ–¥–µ
input.addEventListener('input', () => {
input.classList.remove('error');
});
});
</script>
<!-- –∏–∫–æ–Ω–∫–∞ –∫–æ–Ω—Å–æ–ª–∏ -->
<button id="btnConsole"
title="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –∫–æ–Ω—Å–æ–ª—å"
style="position:fixed; left:3px; bottom:3px; z-index:9999;
width:24px; height:24px;          /* —Ñ–∏–∫—Å–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä—ã */
margin:0; padding:0; border:none; background:none;
color: var(--text);
display:flex; align-items:center; justify-content:center;
cursor:pointer;">
<svg width="32" height="32" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
<path d="M5.64645 9.14645C5.84171 8.95118 6.15829 8.95118 6.35355 9.14645L8.35355 11.1464C8.44732 11.2402 8.5 11.3674 8.5 11.5C8.5 11.6326 8.44732 11.7598 8.35355 11.8536L6.35355 13.8536C6.15829 14.0488 5.84171 14.0488 5.64645 13.8536C5.45118 13.6583 5.45118 13.3417 5.64645 13.1464L7.29289 11.5L5.64645 9.85355C5.45118 9.65829 5.45118 9.34171 5.64645 9.14645ZM14.5 13H9.5C9.22386 13 9 13.2239 9 13.5C9 13.7761 9.22386 14 9.5 14H14.5C14.7761 14 15 13.7761 15 13.5C15 13.2239 14.7761 13 14.5 13ZM2.99609 5.5C2.99609 4.11929 4.11538 3 5.49609 3H14.4961C15.8768 3 16.9961 4.11929 16.9961 5.5V6H16.999V7H16.9961V14.5C16.9961 15.8807 15.8768 17 14.4961 17H5.49609C4.11538 17 2.99609 15.8807 2.99609 14.5V5.5ZM15.9961 6V5.5C15.9961 4.67157 15.3245 4 14.4961 4H5.49609C4.66767 4 3.99609 4.67157 3.99609 5.5V6H15.9961ZM3.99609 7V14.5C3.99609 15.3284 4.66767 16 5.49609 16H14.4961C15.3245 16 15.9961 15.3284 15.9961 14.5V7H3.99609Z"/>
</svg>
</button>
<!-- —Å–∞–º–∞ –∫–æ–Ω—Å–æ–ª—å (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç–∞) -->
<div id="mobileConsole" style="
display:none;
position:fixed; inset:auto 0 0 0; height:120px;
background:#000; color:#0f0; font:11px/1.3 monospace;
overflow:auto; padding:4px; z-index:9998;">
<div>=== –∫–æ–Ω—Å–æ–ª—å ===</div>
</div>
<script>
/* ---------- –º–æ–±–∏–ª—å–Ω–∞—è –∫–æ–Ω—Å–æ–ª—å ---------- */
const con = document.getElementById('mobileConsole');
const btn = document.getElementById('btnConsole');
// –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.log
const origLog = console.log;
console.log = function (...args) {
origLog(...args);                       // –≤—ã–≤–æ–¥–∏–º –≤ –æ–±—ã—á–Ω—É—é –∫–æ–Ω—Å–æ–ª—å
const line = args.map(a => typeof a === 'object' ? JSON.stringify(a) : a).join(' ');
con.insertAdjacentHTML('beforeend', '<div>' + line + '</div>');
con.scrollTop = con.scrollHeight;
};
// –ø–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–Ω–æ–ø–∫–µ
btn.addEventListener('click', () => {
con.style.display = con.style.display === 'none' ? 'block' : 'none';
});
/* –ø–µ—Ä–≤–æ–µ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ */
console.log('mobile console ready');
</script>
</body>
</html>
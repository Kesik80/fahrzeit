<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Stations Editor</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.6/Sortable.min.js"></script>
<style>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CSS-–ü–ï–†–ï–ú–ï–ù–ù–´–ï (–¥–∏–∑–∞–π–Ω-—Ç–æ–∫–µ–Ω—ã)
   –í—Å–µ —Ü–≤–µ—Ç–∞, —Ç–µ–Ω–∏, —Ä–∞–¥–∏—É—Å—ã –∏ —à—Ä–∏—Ñ—Ç
   —Ö—Ä–∞–Ω—è—Ç—Å—è –∑–¥–µ—Å—å ‚Äî –º–µ–Ω—è–π –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
:root {
  --bg:        #F5F6FA;  /* —Ñ–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
  --surface:   #FFFFFF;  /* —Ñ–æ–Ω –∫–∞—Ä—Ç–æ—á–µ–∫, —à–∞–ø–∫–∏, –º–æ–¥–∞–ª–æ–∫ */
  --surface2:  #F0F1F8;  /* —Ñ–æ–Ω –ø–æ–ª–µ–π –≤–≤–æ–¥–∞, –∫–Ω–æ–ø–æ–∫ –≤—Ç–æ—Ä–æ–≥–æ —É—Ä–æ–≤–Ω—è */
  --border:    #E2E4EF;  /* —Ü–≤–µ—Ç —Ä–∞–º–æ–∫ –∏ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–π */
  --text:      #161B2E;  /* –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ */
  --text2:     #6B7199;  /* –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç (–ø–æ–¥–ø–∏—Å–∏, –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã) */
  --accent:    #3D5AFE;  /* –∞–∫—Ü–µ–Ω—Ç–Ω—ã–π —Å–∏–Ω–∏–π ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏, —Å—Å—ã–ª–∫–∏ */
  --accent-lt: #EEF1FF;  /* —Å–≤–µ—Ç–ª—ã–π —Ñ–æ–Ω –∞–∫—Ü–µ–Ω—Ç–∞ ‚Äî hover-—Å–æ—Å—Ç–æ—è–Ω–∏—è */
  --green:     #00C896;  /* –∑–µ–ª—ë–Ω—ã–π ‚Äî —É—Å–ø–µ—Ö, –∫–Ω–æ–ø–∫–∞ "–°–∫–∞—á–∞—Ç—å" */
  --green-lt:  #E6FAF5;  /* —Å–≤–µ—Ç–ª–æ-–∑–µ–ª—ë–Ω—ã–π —Ñ–æ–Ω –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ OK */
  --red:       #FF4757;  /* –∫—Ä–∞—Å–Ω—ã–π ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ, –æ—à–∏–±–∫–∏ */
  --red-lt:    #FFF0F1;  /* —Å–≤–µ—Ç–ª–æ-–∫—Ä–∞—Å–Ω—ã–π —Ñ–æ–Ω –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è */
  --orange:    #FF8F00;  /* –æ—Ä–∞–Ω–∂–µ–≤—ã–π (–∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω, –ø–æ–∫–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) */
  --shadow-s:  0 1px 3px rgba(22,27,46,.08);   /* –ª—ë–≥–∫–∞—è —Ç–µ–Ω—å –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ */
  --shadow-m:  0 4px 16px rgba(22,27,46,.12);  /* —Å—Ä–µ–¥–Ω—è—è —Ç–µ–Ω—å –ø—Ä–∏ hover */
  --shadow-l:  0 12px 40px rgba(22,27,46,.18); /* —Å–∏–ª—å–Ω–∞—è —Ç–µ–Ω—å –¥–ª—è –º–æ–¥–∞–ª–æ–∫ */
  --r:         14px;   /* —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞–¥–∏—É—Å —Å–∫—Ä—É–≥–ª–µ–Ω–∏—è */
  --r-sm:      8px;    /* –º–∞–ª–µ–Ω—å–∫–∏–π —Ä–∞–¥–∏—É—Å (–∫–Ω–æ–ø–∫–∏, –ø–æ–ª—è) */
  --r-pill:    100px;  /* —Ä–∞–¥–∏—É—Å ¬´—Ç–∞–±–ª–µ—Ç–∫–∏¬ª ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫—Ä—É–≥–ª—ã–µ –∫—Ä–∞—è */
  --font:      'Manrope', system-ui, sans-serif; /* –æ—Å–Ω–æ–≤–Ω–æ–π —à—Ä–∏—Ñ—Ç */
}

/* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ ‚Äî –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –º–µ–Ω—è—é—Ç—Å—è */
body.dark {
  --bg:        #0D0F1A;  /* —Ç—ë–º–Ω—ã–π —Ñ–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
  --surface:   #161B2E;  /* —Ç—ë–º–Ω—ã–π —Ñ–æ–Ω –∫–∞—Ä—Ç–æ—á–µ–∫ */
  --surface2:  #1E2438;  /* —Ç—ë–º–Ω—ã–π —Ñ–æ–Ω –ø–æ–ª–µ–π */
  --border:    #2A304A;  /* —Ç—ë–º–Ω—ã–µ —Ä–∞–º–∫–∏ */
  --text:      #EEF0FB;  /* —Å–≤–µ—Ç–ª—ã–π –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç */
  --text2:     #7B82A8;  /* –ø—Ä–∏–≥–ª—É—à—ë–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –≤ —Ç—ë–º–Ω–æ–π —Ç–µ–º–µ */
  --accent-lt: #1A2260;  /* —Ç—ë–º–Ω—ã–π –∞–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω */
  --green-lt:  #0A2820;  /* —Ç—ë–º–Ω—ã–π –∑–µ–ª—ë–Ω—ã–π —Ñ–æ–Ω */
  --red-lt:    #2A0A0D;  /* —Ç—ë–º–Ω—ã–π –∫—Ä–∞—Å–Ω—ã–π —Ñ–æ–Ω */
  --shadow-s:  0 1px 3px rgba(0,0,0,.3);   /* —Ç–µ–Ω–∏ —Ç–µ–º–Ω–µ–µ –≤ dark-—Ç–µ–º–µ */
  --shadow-m:  0 4px 16px rgba(0,0,0,.4);
  --shadow-l:  0 12px 40px rgba(0,0,0,.5);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –°–ë–†–û–° –°–¢–ò–õ–ï–ô + –ë–ê–ó–û–í–´–ï –ù–ê–°–¢–†–û–ô–ö–ò
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
*, *::before, *::after {
  box-sizing: border-box; /* —Ä–∞–∑–º–µ—Ä—ã –≤–∫–ª—é—á–∞—é—Ç padding –∏ border */
  margin: 0;              /* —É–±–∏—Ä–∞–µ–º –≤—Å–µ –≤–Ω–µ—à–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã –±—Ä–∞—É–∑–µ—Ä–∞ */
  padding: 0;             /* —É–±–∏—Ä–∞–µ–º –≤—Å–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã –±—Ä–∞—É–∑–µ—Ä–∞ */
}

html {
  font-size: 18px;                        /* –±–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ (rem –æ—Ç –Ω–µ–≥–æ) */
  -webkit-tap-highlight-color: transparent; /* —É–±–∏—Ä–∞–µ–º —Å–∏–Ω—é—é –≤—Å–ø—ã—à–∫—É –ø—Ä–∏ —Ç–∞–ø–µ –Ω–∞ iOS */
}

body {
  font-family: var(--font);                      /* –æ—Å–Ω–æ–≤–Ω–æ–π —à—Ä–∏—Ñ—Ç –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π */
  background: var(--bg);                         /* —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
  color: var(--text);                            /* –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ */
  min-height: 100dvh;                            /* –º–∏–Ω–∏–º—É–º –Ω–∞ –≤—Å—é –≤—ã—Å–æ—Ç—É —ç–∫—Ä–∞–Ω–∞ (dvh = dynamic viewport height) */
  padding-bottom: env(safe-area-inset-bottom);   /* –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É –¥–ª—è iPhone —Å ¬´—á—ë–ª–∫–æ–π¬ª */
  transition: background .25s, color .25s;       /* –ø–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–µ–º—ã */
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–†
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.app {
  max-width: 480px;        /* –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ ‚Äî —É–¥–æ–±–Ω–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
  margin: 0 auto;          /* —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ */
  display: flex;           /* flex-–∫–æ–ª–æ–Ω–∫–∞ –¥–ª—è —à–∞–ø–∫–∏ + –∫–æ–Ω—Ç–µ–Ω—Ç–∞ + –ø–∞–Ω–µ–ª–∏ */
  flex-direction: column;  /* —ç–ª–µ–º–µ–Ω—Ç—ã –∏–¥—É—Ç –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
  min-height: 100dvh;      /* —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –®–ê–ü–ö–ê
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.header {
  position: sticky;              /* —à–∞–ø–∫–∞ –ø—Ä–∏–ª–∏–ø–∞–µ—Ç –∫ –≤–µ—Ä—Ö—É –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ */
  top: 0;                        /* –ø—Ä–∏–ª–∏–ø–∞–µ—Ç –∫ —Å–∞–º–æ–º—É –≤–µ—Ä—Ö—É */
  z-index: 50;                   /* –ø–æ–≤–µ—Ä—Ö –æ—Å—Ç–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
  background: var(--surface);    /* –±–µ–ª—ã–π / —Ç—ë–º–Ω—ã–π —Ñ–æ–Ω */
  border-bottom: 1px solid var(--border); /* —Ç–æ–Ω–∫–∞—è –ª–∏–Ω–∏—è —Å–Ω–∏–∑—É */
  padding: 12px 16px 10px;       /* –æ—Ç—Å—Ç—É–ø—ã –≤–Ω—É—Ç—Ä–∏: —Å–≤–µ—Ä—Ö—É, –ø–æ –±–æ–∫–∞–º, —Å–Ω–∏–∑—É */
  display: flex;                 /* —ç–ª–µ–º–µ–Ω—Ç—ã –≤ —Ä—è–¥ */
  align-items: center;           /* –ø–æ —Ü–µ–Ω—Ç—Ä—É –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
  gap: 10px;                     /* –æ—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –ª–æ–≥–æ—Ç–∏–ø–æ–º, —Ç–µ–∫—Å—Ç–æ–º –∏ –∫–Ω–æ–ø–∫–æ–π */
  box-shadow: var(--shadow-s);   /* –ª—ë–≥–∫–∞—è —Ç–µ–Ω—å —á—Ç–æ–±—ã –æ—Ç–¥–µ–ª–∏—Ç—å –æ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
}

.header-logo {
  width: 34px; height: 34px;                    /* –∫–≤–∞–¥—Ä–∞—Ç 34√ó34 */
  background: var(--accent);                     /* —Å–∏–Ω–∏–π –∞–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ü–≤–µ—Ç */
  border-radius: var(--r-sm);                    /* —Å–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–µ —É–≥–ª—ã */
  display: flex; align-items: center; justify-content: center; /* —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —ç–º–æ–¥–∑–∏ */
  font-size: 18px;                               /* —Ä–∞–∑–º–µ—Ä –∏–∫–æ–Ω–∫–∏ */
  flex-shrink: 0;                                /* –Ω–µ —Å–∂–∏–º–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ –º–µ—Å—Ç–∞ */
}

.header-title {
  flex: 1;              /* –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å—ë –¥–æ—Å—Ç—É–ø–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ */
  font-size: 1.1rem;    /* —á—É—Ç—å –∫—Ä—É–ø–Ω–µ–µ –±–∞–∑–æ–≤–æ–≥–æ */
  font-weight: 700;     /* –∂–∏—Ä–Ω—ã–π */
  letter-spacing: -.3px; /* —á—É—Ç—å —Å–∂–∞—Ç—ã–π –∫–µ—Ä–Ω–∏–Ω–≥ –¥–ª—è –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ */
}

.header-sub {
  font-size: .78rem;      /* –º–µ–ª–∫–∏–π –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ */
  color: var(--text2);    /* –ø—Ä–∏–≥–ª—É—à—ë–Ω–Ω—ã–π —Ü–≤–µ—Ç */
  font-weight: 500;       /* —Å—Ä–µ–¥–Ω—è—è –∂–∏—Ä–Ω–æ—Å—Ç—å */
  letter-spacing: .2px;   /* –ª—ë–≥–∫–æ–µ —Ä–∞–∑—Ä–µ–∂–µ–Ω–∏–µ –±—É–∫–≤ */
}

/* –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã –≤ —à–∞–ø–∫–µ */
.theme-btn {
  width: 36px; height: 36px;          /* –∫–≤–∞–¥—Ä–∞—Ç 36√ó36 */
  border-radius: var(--r-sm);         /* —Å–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–µ —É–≥–ª—ã */
  border: 1px solid var(--border);    /* —Ç–æ–Ω–∫–∞—è —Ä–∞–º–∫–∞ */
  background: var(--surface2);        /* —Å–ª–µ–≥–∫–∞ –≤—ã–¥–µ–ª—è–µ—Ç—Å—è –Ω–∞ —Ñ–æ–Ω–µ —à–∞–ø–∫–∏ */
  cursor: pointer;                    /* –∫—É—Ä—Å–æ—Ä-—Ä—É–∫–∞ */
  display: flex; align-items: center; justify-content: center; /* —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —ç–º–æ–¥–∑–∏ */
  font-size: 16px;                    /* —Ä–∞–∑–º–µ—Ä –∏–∫–æ–Ω–∫–∏ üåô / ‚òÄÔ∏è */
  transition: background .2s, transform .15s; /* –∞–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ hover */
  flex-shrink: 0;                     /* –Ω–µ —Å–∂–∏–º–∞–µ—Ç—Å—è */
}
.theme-btn:hover {
  background: var(--accent-lt);  /* —Å–∏–Ω–µ–≤–∞—Ç—ã–π —Ñ–æ–Ω –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
  transform: scale(1.05);        /* –ª—ë–≥–∫–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ */
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –°–¢–†–û–ö–ê –°–¢–ê–¢–£–°–ê (–∑–∞–≥—Ä—É–∑–∫–∞ / OK / –æ—à–∏–±–∫–∞)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
#loadStatus {
  margin: 12px 16px 0;           /* –æ—Ç—Å—Ç—É–ø—ã: —Å–≤–µ—Ä—Ö—É –∏ –ø–æ –±–æ–∫–∞–º */
  padding: 10px 14px;            /* –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã */
  border-radius: var(--r-sm);    /* —Å–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–µ —É–≥–ª—ã */
  font-size: .88rem;             /* –Ω–µ–º–Ω–æ–≥–æ –º–µ–Ω—å—à–µ –±–∞–∑–æ–≤–æ–≥–æ */
  font-weight: 600;              /* –ø–æ–ª—É–∂–∏—Ä–Ω—ã–π */
  display: flex;                 /* –∏–∫–æ–Ω–∫–∞ + —Ç–µ–∫—Å—Ç –≤ —Ä—è–¥ */
  align-items: center;           /* –ø–æ —Ü–µ–Ω—Ç—Ä—É –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
  gap: 7px;                      /* –æ—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –∏–∫–æ–Ω–∫–æ–π –∏ —Ç–µ–∫—Å—Ç–æ–º */
  transition: all .3s;           /* –ø–ª–∞–≤–Ω–∞—è —Å–º–µ–Ω–∞ —Ü–≤–µ—Ç–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ */
}
#loadStatus.loading { background: var(--accent-lt); color: var(--accent); } /* —Å–∏–Ω–∏–π ‚Äî –∏–¥—ë—Ç –∑–∞–≥—Ä—É–∑–∫–∞ */
#loadStatus.ok      { background: var(--green-lt);  color: var(--green);  } /* –∑–µ–ª—ë–Ω—ã–π ‚Äî —É—Å–ø–µ—à–Ω–æ */
#loadStatus.err     { background: var(--red-lt);    color: var(--red);    } /* –∫—Ä–∞—Å–Ω—ã–π ‚Äî –æ—à–∏–±–∫–∞ */
#loadStatus::before {
  content: attr(data-icon); /* –±–µ—Ä—ë–º –∏–∫–æ–Ω–∫—É –∏–∑ –∞—Ç—Ä–∏–±—É—Ç–∞ data-icon —ç–ª–µ–º–µ–Ω—Ç–∞ */
  font-size: 14px;           /* —Ä–∞–∑–º–µ—Ä –∏–∫–æ–Ω–∫–∏ —ç–º–æ–¥–∑–∏ */
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –¢–ê–ë–´ –ì–†–£–ü–ü (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.tabs-wrap {
  padding: 12px 16px 0;              /* –æ—Ç—Å—Ç—É–ø—ã –≤–æ–∫—Ä—É–≥ –ø–æ–ª–æ—Å—ã —Ç–∞–±–æ–≤ */
  overflow-x: auto;                  /* –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª –∫–æ–≥–¥–∞ —Ç–∞–±—ã –Ω–µ –≤–ª–µ–∑–∞—é—Ç */
  -webkit-overflow-scrolling: touch; /* –ø–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª –Ω–∞ iOS */
  scrollbar-width: none;             /* —Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–æ—Å—É –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –≤ Firefox */
}
.tabs-wrap::-webkit-scrollbar { display: none; } /* —Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–æ—Å—É –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –≤ Chrome/Safari */

.tabs {
  display: flex;       /* —Ç–∞–±—ã –≤ —Ä—è–¥ */
  gap: 6px;            /* —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Ç–∞–±–∞–º–∏ */
  white-space: nowrap; /* –Ω–µ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É */
}

.tab {
  padding: 9px 16px;              /* –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã —Ç–∞–±–∞ */
  border-radius: var(--r-pill);   /* –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–∫—Ä—É–≥–ª—ã–µ ‚Äî —Ñ–æ—Ä–º–∞ ¬´—Ç–∞–±–ª–µ—Ç–∫–∏¬ª */
  border: 1.5px solid var(--border); /* —Ä–∞–º–∫–∞ */
  background: var(--surface);     /* –±–µ–ª—ã–π —Ñ–æ–Ω –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç–∞–±–∞ */
  color: var(--text2);            /* –ø—Ä–∏–≥–ª—É—à—ë–Ω–Ω—ã–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ */
  font-size: .88rem;              /* —Ä–∞–∑–º–µ—Ä –Ω–∞–¥–ø–∏—Å–∏ */
  font-weight: 600;               /* –ø–æ–ª—É–∂–∏—Ä–Ω—ã–π */
  cursor: pointer;                /* –∫—É—Ä—Å–æ—Ä-—Ä—É–∫–∞ */
  transition: all .18s;           /* –ø–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è hover */
  white-space: nowrap;            /* —Ç–µ–∫—Å—Ç –Ω–µ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è */
  flex-shrink: 0;                 /* –Ω–µ —Å–∂–∏–º–∞–µ—Ç—Å—è */
}
.tab:hover {
  border-color: var(--accent);    /* —Å–∏–Ω—è—è —Ä–∞–º–∫–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
  color: var(--accent);           /* —Å–∏–Ω–∏–π —Ç–µ–∫—Å—Ç */
  background: var(--accent-lt);   /* —Å–≤–µ—Ç–ª–æ-—Å–∏–Ω–∏–π —Ñ–æ–Ω */
}
.tab.active {
  background: var(--accent);                   /* —Å–∏–Ω–∏–π —Ñ–æ–Ω –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç–∞–±–∞ */
  border-color: var(--accent);                 /* —Å–∏–Ω—è—è —Ä–∞–º–∫–∞ */
  color: #fff;                                 /* –±–µ–ª—ã–π —Ç–µ–∫—Å—Ç */
  box-shadow: 0 2px 8px rgba(61,90,254,.3);   /* —Å–∏–Ω—è—è —Ç–µ–Ω—å –ø–æ–¥ –∞–∫—Ç–∏–≤–Ω—ã–º —Ç–∞–±–æ–º */
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –û–ë–õ–ê–°–¢–¨ –ö–û–ù–¢–ï–ù–¢–ê
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.content {
  flex: 1;                    /* –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å—ë –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –º–µ–∂–¥—É —à–∞–ø–∫–æ–π –∏ –ø–∞–Ω–µ–ª—å—é */
  padding: 12px 16px 80px;   /* 80px —Å–Ω–∏–∑—É ‚Äî –º–µ—Å—Ç–æ –¥–ª—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–∞–Ω–µ–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ */
  overflow-y: auto;           /* —Å–∫—Ä–æ–ª–ª –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –≤–ª–µ–∑–∞–µ—Ç */
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –ö–ê–†–¢–û–ß–ö–ò (—Å—Ç—Ä–æ–∫–∏ —Å–ø–∏—Å–∫–∞)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.card {
  background: var(--surface);           /* –±–µ–ª—ã–π / —Ç—ë–º–Ω—ã–π —Ñ–æ–Ω –∫–∞—Ä—Ç–æ—á–∫–∏ */
  border: 1px solid var(--border);      /* —Ä–∞–º–∫–∞ */
  border-radius: var(--r-sm);           /* —Å–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–µ —É–≥–ª—ã */
  padding: 4px 0px 4px 10px;           /* –º–µ–Ω—å—à–µ —Å–ø—Ä–∞–≤–∞ ‚Äî –∫—Ä–µ—Å—Ç–∏–∫ —É –∫—Ä–∞—è */
  margin-bottom: 8px;                  /* –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É –º–µ–∂–¥—É –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ */
  display: flex;                        /* —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ —Ä—è–¥ */
  align-items: center;                  /* –ø–æ —Ü–µ–Ω—Ç—Ä—É –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
  gap: 8px;                             /* —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –≤–Ω—É—Ç—Ä–∏ */
  box-shadow: var(--shadow-s);          /* –ª—ë–≥–∫–∞—è —Ç–µ–Ω—å */
  transition: box-shadow .2s, border-color .2s; /* –∞–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ hover */
  position: relative;                   /* –Ω—É–∂–Ω–æ –¥–ª—è –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
  cursor: default;                      /* –æ–±—ã—á–Ω—ã–π –∫—É—Ä—Å–æ—Ä (–Ω–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–π) */
}
.card:hover {
  box-shadow: var(--shadow-m);   /* –±–æ–ª–µ–µ —Å–∏–ª—å–Ω–∞—è —Ç–µ–Ω—å –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
  border-color: var(--accent);   /* —Å–∏–Ω—è—è —Ä–∞–º–∫–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
}

.card.group-card {
  border-left: 3px solid var(--accent); /* —Å–∏–Ω—è—è –ø–æ–ª–æ—Å–∫–∞ —Å–ª–µ–≤–∞ ‚Äî —ç—Ç–æ –≥—Ä—É–ø–ø–∞ */
}

.card.sub-card {
  margin-left: 10px;               /* –æ—Ç—Å—Ç—É–ø —Å–ª–µ–≤–∞ ‚Äî –≤–∏–∑—É–∞–ª—å–Ω–æ –≤–ª–æ–∂–µ–Ω–æ */
  background: var(--surface2);     /* —á—É—Ç—å –¥—Ä—É–≥–æ–π —Ñ–æ–Ω –¥–ª—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö */
  border-left: 2px solid var(--accent); /* –±–æ–ª–µ–µ —Ç–æ–Ω–∫–∞—è —Å–∏–Ω—è—è –ø–æ–ª–æ—Å–∫–∞ */
  border-radius: var(--r-sm);      /* –º–µ–Ω—å—à–∏–π —Ä–∞–¥–∏—É—Å —Å–∫—Ä—É–≥–ª–µ–Ω–∏—è */
  padding: 6px 0 6px 10px;         /* –±–µ–∑ –ø—Ä–∞–≤–æ–≥–æ padding ‚Äî –∫—Ä–µ—Å—Ç–∏–∫ —É –∫—Ä–∞—è */
}

/* –ò–∫–æ–Ω–∫–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è (drag & drop) */
.drag-handle {
  color: var(--text2);   /* –ø—Ä–∏–≥–ª—É—à—ë–Ω–Ω—ã–π —Ü–≤–µ—Ç */
  font-size: 18px;       /* —Ä–∞–∑–º–µ—Ä —Ç–æ—á–µ—á–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞ ‚†ø */
  cursor: grab;          /* –∫—É—Ä—Å–æ—Ä ¬´—Ä—É–∫–∞ —Å—Ö–≤–∞—Ç–∏—Ç—å¬ª */
  flex-shrink: 0;        /* –Ω–µ —Å–∂–∏–º–∞–µ—Ç—Å—è */
  opacity: .4;           /* –ø–æ—á—Ç–∏ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π –≤ –ø–æ–∫–æ–µ */
  transition: opacity .2s; /* –ø–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ */
  user-select: none;     /* –Ω–µ–ª—å–∑—è –≤—ã–¥–µ–ª–∏—Ç—å —Ç–µ–∫—Å—Ç–æ–º */
  padding: 6px 20px 6px 30px; /* —É–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è –∑–æ–Ω–∞ –∑–∞—Ö–≤–∞—Ç–∞ */
}
.card:hover .drag-handle { opacity: .7; } /* —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤–∏–¥–∏–º–µ–µ –ø—Ä–∏ hover –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É */

/* –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ (–∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ –¥–ª—è –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è) */
.card-name {
  flex: 1;               /* –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å—ë —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ */
  font-size: 1rem;       /* –±–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä */
  font-weight: 600;      /* –ø–æ–ª—É–∂–∏—Ä–Ω—ã–π */
  color: var(--text);    /* –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ */
  min-width: 0;          /* –ø–æ–∑–≤–æ–ª—è–µ—Ç flex-—ç–ª–µ–º–µ–Ω—Ç—É —Å–∂–∞—Ç—å—Å—è –º–µ–Ω—å—à–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
  overflow: hidden;      /* –æ–±—Ä–µ–∑–∞–µ–º –¥–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç */
  text-overflow: ellipsis; /* ¬´‚Ä¶¬ª –≤ –∫–æ–Ω—Ü–µ –æ–±—Ä–µ–∑–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ */
  white-space: nowrap;   /* –Ω–µ –ø–µ—Ä–µ–Ω–æ—Å–∏–º –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É */
  cursor: pointer;       /* –∫—É—Ä—Å–æ—Ä-—Ä—É–∫–∞ ‚Äî –Ω–∞–º–µ–∫–∞–µ–º —á—Ç–æ –º–æ–∂–Ω–æ –∫–ª–∏–∫–Ω—É—Ç—å */
  border-radius: 5px;    /* —Å–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –ø—Ä–∏ hover */
  padding: 2px 4px;      /* –Ω–µ–±–æ–ª—å—à–æ–π padding –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ */
  margin: -2px -4px;     /* –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É–µ–º padding —á—Ç–æ–±—ã –Ω–µ —Å–º–µ—â–∞–ª–æ */
  transition: background .15s; /* –∞–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è —Ñ–æ–Ω–∞ */
}
.card-name:hover { background: var(--accent-lt); } /* —Å–∏–Ω–µ–≤–∞—Ç—ã–π —Ñ–æ–Ω –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */

/* –ü–æ–ª–µ –≤–≤–æ–¥–∞ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–º–µ–Ω–∏ (–ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ .card-name) */
.card-name-input {
  flex: 1;                              /* –∑–∞–Ω–∏–º–∞–µ—Ç –º–µ—Å—Ç–æ .card-name */
  font-size: 1rem;                      /* —Ç–æ—Ç –∂–µ —Ä–∞–∑–º–µ—Ä */
  font-weight: 600;                     /* —Ç–∞ –∂–µ –∂–∏—Ä–Ω–æ—Å—Ç—å */
  font-family: var(--font);             /* —Ç–æ—Ç –∂–µ —à—Ä–∏—Ñ—Ç */
  color: var(--text);                   /* –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç */
  background: var(--accent-lt);         /* —Å–≤–µ—Ç–ª–æ-—Å–∏–Ω–∏–π —Ñ–æ–Ω ‚Äî –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
  border: 1.5px solid var(--accent);    /* —Å–∏–Ω—è—è —Ä–∞–º–∫–∞ */
  border-radius: 6px;                   /* —Å–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–µ —É–≥–ª—ã */
  padding: 5px 10px;                    /* –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã */
  min-width: 0;                         /* –º–æ–∂–µ—Ç —Å–∂–∏–º–∞—Ç—å—Å—è */
  outline: none;                        /* —É–±–∏—Ä–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–∏–Ω–∏–π outline –±—Ä–∞—É–∑–µ—Ä–∞ */
}

/* –û–±—ë—Ä—Ç–∫–∞ –ø–æ–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç */
.card-coord {
  flex: 0 0 auto; /* –Ω–µ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è –∏ –Ω–µ —Å–∂–∏–º–∞–µ—Ç—Å—è */
  width: 130px;   /* —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –¥–ª—è –ø–æ–ª—è "lat, lng" */
}

/* –ü–æ–ª–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∏ –ø–æ–ª–µ –≤—Ä–µ–º–µ–Ω–∏ (–æ–±—â–∏–µ —Å—Ç–∏–ª–∏) */
.card-coord input, .card-time-input {
  width: 100%;                          /* –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É –æ–±—ë—Ä—Ç–∫–∏ */
  font-family: var(--font);             /* –æ—Å–Ω–æ–≤–Ω–æ–π —à—Ä–∏—Ñ—Ç */
  font-size: .72rem;                    /* –º–µ–ª–∫–∏–π ‚Äî –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ –≥–ª–∞–≤–Ω–æ–µ */
  color: var(--text2);                  /* –ø—Ä–∏–≥–ª—É—à—ë–Ω–Ω—ã–π —Ü–≤–µ—Ç –≤ –ø–æ–∫–æ–µ */
  background: var(--surface2);          /* —Å–ª–µ–≥–∫–∞ –≤—ã–¥–µ–ª—è–µ—Ç—Å—è –Ω–∞ —Ñ–æ–Ω–µ –∫–∞—Ä—Ç–æ—á–∫–∏ */
  border: 1px solid var(--border);      /* —Ä–∞–º–∫–∞ */
  border-radius: 6px;                   /* —Å–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–µ —É–≥–ª—ã */
  padding: 7px 10px;                    /* –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã */
  outline: none;                        /* —É–±–∏—Ä–∞–µ–º outline –±—Ä–∞—É–∑–µ—Ä–∞ */
  transition: border-color .15s, background .15s; /* –∞–Ω–∏–º–∞—Ü–∏—è —Ñ–æ–∫—É—Å–∞ */
}
.card-coord input:focus, .card-time-input:focus {
  border-color: var(--accent);   /* —Å–∏–Ω—è—è —Ä–∞–º–∫–∞ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ */
  background: var(--accent-lt);  /* —Å–≤–µ—Ç–ª–æ-—Å–∏–Ω–∏–π —Ñ–æ–Ω –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ */
  color: var(--text);            /* –ø–æ–ª–Ω—ã–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ */
}

.card-time-input {
  width: 54px;         /* —É–∑–∫–æ–µ –ø–æ–ª–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —á–∏—Å–ª–∞ */
  text-align: center;  /* —á–∏—Å–ª–æ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
  font-weight: 600;    /* –∂–∏—Ä–Ω–µ–µ ‚Äî —ç—Ç–æ –≤–∞–∂–Ω–∞—è —Ü–∏—Ñ—Ä–∞ */
}

/* –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏ (–∫—Ä–∞—Å–Ω—ã–π –∫—Ä–µ—Å—Ç–∏–∫) */
.del-btn {
  width: 28px; height: 28px;            /* —Ä–∞–∑–º–µ—Ä –∫–Ω–æ–ø–∫–∏ */
  border-radius: 0;                     /* –±–µ–∑ —Å–∫—Ä—É–≥–ª–µ–Ω–∏–π ‚Äî –≤–ø–ª–æ—Ç–Ω—É—é –∫ –∫—Ä–∞—é */
  border: none;                         /* –±–µ–∑ —Ä–∞–º–∫–∏ */
  background: transparent;              /* –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω */
  color: var(--red);                    /* –∫—Ä–∞—Å–Ω—ã–π –∫—Ä–µ—Å—Ç–∏–∫ */
  font-size: 14px;                      /* —Ä–∞–∑–º–µ—Ä —Å–∏–º–≤–æ–ª–∞ ‚úñ */
  font-weight: 700;                     /* –∂–∏—Ä–Ω—ã–π –∫—Ä–µ—Å—Ç–∏–∫ */
  cursor: pointer;                      /* –∫—É—Ä—Å–æ—Ä-—Ä—É–∫–∞ */
  display: flex; align-items: center; justify-content: center; /* —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Å–∏–º–≤–æ–ª */
  flex-shrink: 0;                       /* –Ω–µ —Å–∂–∏–º–∞–µ—Ç—Å—è */
  transition: color .15s, transform .12s; /* –∞–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ hover */
  opacity: .5;                          /* –ø—Ä–∏–≥–ª—É—à—ë–Ω –≤ –ø–æ–∫–æ–µ */
  padding: 0;                           /* –±–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –æ—Ç—Å—Ç—É–ø–æ–≤ */
  margin: -10px 0 0 0;                  /* —Ç–æ–ª—å–∫–æ –≤–≤–µ—Ä—Ö, –±–µ–∑ –±–æ–∫–æ–≤—ã—Ö –æ—Ç—Å—Ç—É–ø–æ–≤ */
  align-self: flex-start;               /* –ø—Ä–∏–∂–∏–º–∞–µ–º –∫ –≤–µ—Ä—Ö—É –∫–∞—Ä—Ç–æ—á–∫–∏ */
}
.del-btn:hover {
  background: var(--red-lt); /* –ª—ë–≥–∫–∏–π –∫—Ä–∞—Å–Ω—ã–π —Ñ–æ–Ω –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
  color: var(--red);          /* –∫—Ä–∞—Å–Ω—ã–π –∫—Ä–µ—Å—Ç–∏–∫ */
  opacity: 1;                 /* –ø–æ–ª–Ω–∞—è –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å */
  transform: scale(1.1);      /* –ª—ë–≥–∫–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ */
}

/* –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞ –≤ –≥—Ä—É–ø–ø—É (—Å–∏–Ω–∏–π –ø–ª—é—Å) */
.add-sub-btn {
  width: 32px; height: 32px;            /* –∫–≤–∞–¥—Ä–∞—Ç 32√ó32 */
  border-radius: 50%;                   /* –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫—Ä—É–≥–ª–∞—è */
  border: 1.5px solid var(--accent);    /* —Å–∏–Ω—è—è —Ä–∞–º–∫–∞ */
  background: var(--accent-lt);         /* —Å–≤–µ—Ç–ª–æ-—Å–∏–Ω–∏–π —Ñ–æ–Ω */
  color: var(--accent);                 /* —Å–∏–Ω–∏–π –ø–ª—é—Å */
  font-size: 18px;                      /* —Ä–∞–∑–º–µ—Ä —Å–∏–º–≤–æ–ª–∞ + */
  font-weight: 700;                     /* –∂–∏—Ä–Ω—ã–π */
  cursor: pointer;                      /* –∫—É—Ä—Å–æ—Ä-—Ä—É–∫–∞ */
  display: flex; align-items: center; justify-content: center; /* —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º + */
  flex-shrink: 0;                       /* –Ω–µ —Å–∂–∏–º–∞–µ—Ç—Å—è */
  transition: all .15s;                 /* –∞–Ω–∏–º–∞—Ü–∏—è –≤—Å–µ—Ö —Å–≤–æ–π—Å—Ç–≤ */
  line-height: 1;                       /* —á—Ç–æ–±—ã + –Ω–µ —Å—ä–µ–∑–∂–∞–ª */
}
.add-sub-btn:hover {
  background: var(--accent); /* —Å–∏–Ω–∏–π —Ñ–æ–Ω –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
  color: #fff;               /* –±–µ–ª—ã–π + */
  transform: scale(1.1);     /* –ª—ë–≥–∫–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ */
}

/* –û—Ç—Å—Ç—É–ø –¥–ª—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≥—Ä—É–ø–ø—ã */
.group-indent { margin-left: 20px; } /* —Å–¥–≤–∏–≥–∞–µ–º –±–ª–æ–∫ —Å—É–±—É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤–ø—Ä–∞–≤–æ */

/* –ö–Ω–æ–ø–∫–∞ Google Maps –∏–∫–æ–Ω–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ –≤—Ä–µ–º–µ–Ω–∏ */
.google-map-btn {
  width: 22px; height: 22px;      /* —Ä–∞–∑–º–µ—Ä –ø–æ–¥ SVG 16√ó16 */
  border: none;                    /* –±–µ–∑ —Ä–∞–º–∫–∏ */
  background: transparent;         /* –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω */
  cursor: pointer;                 /* –∫—É—Ä—Å–æ—Ä-—Ä—É–∫–∞ */
  padding: 0;                      /* –±–µ–∑ –æ—Ç—Å—Ç—É–ø–æ–≤ */
  flex-shrink: 0;                  /* –Ω–µ —Å–∂–∏–º–∞–µ—Ç—Å—è */
  display: flex; align-items: center; justify-content: center;
  opacity: .7;                     /* –Ω–µ–º–Ω–æ–≥–æ –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è –≤ –ø–æ–∫–æ–µ */
  transition: opacity .15s, transform .15s;
  margin-left: 2px;
}
.google-map-btn:hover { opacity: 1; transform: scale(1.15); }
.google-map-btn:active { transform: scale(.95); }

/* –ü–æ–¥–ø–∏—Å—å ¬´–º–∏–Ω¬ª / ¬´—á¬ª —Ä—è–¥–æ–º —Å –ø–æ–ª–µ–º –≤—Ä–µ–º–µ–Ω–∏ */
.time-min {
  font-size: .82rem;    /* –º–µ–ª–∫–∏–π —Ç–µ–∫—Å—Ç */
  color: var(--text2);  /* –ø—Ä–∏–≥–ª—É—à—ë–Ω–Ω—ã–π —Ü–≤–µ—Ç */
  font-weight: 500;     /* —Å—Ä–µ–¥–Ω—è—è –∂–∏—Ä–Ω–æ—Å—Ç—å */
  margin-left: 2px;     /* –Ω–µ–±–æ–ª—å—à–æ–π –æ—Ç—Å—Ç—É–ø –æ—Ç –ø–æ–ª—è —á–∏—Å–ª–∞ */
  min-width: 2rem;      /* –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ ‚Äî ¬´–º–∏–Ω¬ª –∏ ¬´—á¬ª –Ω–µ —Å–¥–≤–∏–≥–∞—é—Ç –ø–æ–ª–µ */
  display: inline-block; /* —á—Ç–æ–±—ã min-width —Ä–∞–±–æ—Ç–∞–ª */
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –°–¢–†–û–ö–ê –í–´–ë–û–†–ê –í–û–î–ò–¢–ï–õ–Ø (–≤–∫–ª–∞–¥–∫–∞ ¬´–ü–æ—Ä—è–¥–æ–∫¬ª)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.driver-row {
  display: flex;                    /* —ç–ª–µ–º–µ–Ω—Ç—ã –≤ —Ä—è–¥ */
  align-items: center;              /* –ø–æ —Ü–µ–Ω—Ç—Ä—É –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
  gap: 8px;                         /* —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É label, select –∏ –∫–Ω–æ–ø–∫–æ–π + */
  margin-bottom: 12px;              /* –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É –ø–µ—Ä–µ–¥ —Å–ø–∏—Å–∫–æ–º */
  background: var(--surface);       /* –±–µ–ª—ã–π / —Ç—ë–º–Ω—ã–π —Ñ–æ–Ω */
  border: 1px solid var(--border);  /* —Ä–∞–º–∫–∞ */
  border-radius: var(--r);          /* —Å–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–µ —É–≥–ª—ã */
  padding: 10px 12px;               /* –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã */
  box-shadow: var(--shadow-s);      /* –ª—ë–≥–∫–∞—è —Ç–µ–Ω—å */
}

.driver-row label {
  font-size: .82rem;        /* –º–µ–ª–∫–∏–π */
  font-weight: 700;         /* –∂–∏—Ä–Ω—ã–π */
  text-transform: uppercase; /* –ó–ê–ì–õ–ê–í–ù–´–ï */
  letter-spacing: .6px;     /* —Ä–∞–∑—Ä–µ–∂–µ–Ω–∏–µ –±—É–∫–≤ */
  color: var(--text2);      /* –ø—Ä–∏–≥–ª—É—à—ë–Ω–Ω—ã–π —Ü–≤–µ—Ç */
  flex-shrink: 0;           /* –Ω–µ —Å–∂–∏–º–∞–µ—Ç—Å—è */
}

.driver-row select {
  flex: 1;                          /* –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å—ë —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ */
  font-family: var(--font);         /* –æ—Å–Ω–æ–≤–Ω–æ–π —à—Ä–∏—Ñ—Ç */
  font-size: 1rem;                  /* –±–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä */
  font-weight: 600;                 /* –ø–æ–ª—É–∂–∏—Ä–Ω—ã–π */
  color: var(--text);               /* –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ */
  background: var(--surface2);      /* —Ñ–æ–Ω –ø–æ–ª—è */
  border: 1px solid var(--border);  /* —Ä–∞–º–∫–∞ */
  border-radius: var(--r-sm);       /* —Å–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–µ —É–≥–ª—ã */
  padding: 8px 10px;                /* –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã */
  outline: none;                    /* —É–±–∏—Ä–∞–µ–º outline –±—Ä–∞—É–∑–µ—Ä–∞ */
  cursor: pointer;                  /* –∫—É—Ä—Å–æ—Ä-—Ä—É–∫–∞ */
}
.driver-row select:focus { border-color: var(--accent); } /* —Å–∏–Ω—è—è —Ä–∞–º–∫–∞ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ */

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –ë–õ–û–ö JSON (—Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã–π)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.raw-block {
  margin-top: 16px; /* –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É –æ—Ç —Å–ø–∏—Å–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ */
}

/* –ö–Ω–æ–ø–∫–∞-–∑–∞–≥–æ–ª–æ–≤–æ–∫ ¬´{ } JSON¬ª –¥–ª—è —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è */
.raw-toggle {
  width: 100%;                          /* –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É */
  display: flex;                        /* –∏–∫–æ–Ω–∫–∞ + —Ç–µ–∫—Å—Ç + —Å—Ç—Ä–µ–ª–∫–∞ –≤ —Ä—è–¥ */
  align-items: center;                  /* –ø–æ —Ü–µ–Ω—Ç—Ä—É –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
  gap: 8px;                             /* —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ */
  padding: 10px 14px;                   /* –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã */
  background: var(--surface);           /* —Ñ–æ–Ω –∫–Ω–æ–ø–∫–∏ */
  border: 1px solid var(--border);      /* —Ä–∞–º–∫–∞ */
  border-radius: var(--r);              /* —Å–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–µ —É–≥–ª—ã */
  font-family: var(--font);             /* –æ—Å–Ω–æ–≤–Ω–æ–π —à—Ä–∏—Ñ—Ç */
  font-size: .82rem;                    /* –º–µ–ª–∫–∏–π */
  font-weight: 700;                     /* –∂–∏—Ä–Ω—ã–π */
  text-transform: uppercase;            /* –ó–ê–ì–õ–ê–í–ù–´–ï */
  letter-spacing: .5px;                 /* —Ä–∞–∑—Ä–µ–∂–µ–Ω–∏–µ –±—É–∫–≤ */
  color: var(--text2);                  /* –ø—Ä–∏–≥–ª—É—à—ë–Ω–Ω—ã–π —Ü–≤–µ—Ç */
  cursor: pointer;                      /* –∫—É—Ä—Å–æ—Ä-—Ä—É–∫–∞ */
  transition: all .18s;                 /* –∞–Ω–∏–º–∞—Ü–∏—è hover */
  box-shadow: var(--shadow-s);          /* –ª—ë–≥–∫–∞—è —Ç–µ–Ω—å */
}
.raw-toggle:hover {
  border-color: var(--accent);   /* —Å–∏–Ω—è—è —Ä–∞–º–∫–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
  color: var(--accent);          /* —Å–∏–Ω–∏–π —Ç–µ–∫—Å—Ç */
  background: var(--accent-lt);  /* —Å–≤–µ—Ç–ª–æ-—Å–∏–Ω–∏–π —Ñ–æ–Ω */
}

.raw-toggle-arrow {
  margin-left: auto;        /* –ø—Ä–∏–∂–∏–º–∞–µ–º —Å—Ç—Ä–µ–ª–∫—É –∫ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é */
  font-size: 12px;          /* –º–∞–ª–µ–Ω—å–∫–∞—è —Å—Ç—Ä–µ–ª–∫–∞ ‚ñº */
  transition: transform .25s; /* –ø–ª–∞–≤–Ω—ã–π –ø–æ–≤–æ—Ä–æ—Ç –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ */
}
.raw-toggle.open .raw-toggle-arrow {
  transform: rotate(180deg); /* —Å—Ç—Ä–µ–ª–∫–∞ —Å–º–æ—Ç—Ä–∏—Ç –≤–≤–µ—Ä—Ö –∫–æ–≥–¥–∞ –±–ª–æ–∫ –æ—Ç–∫—Ä—ã—Ç */
}

.raw-body {
  display: none;   /* —Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
  margin-top: 4px; /* –Ω–µ–±–æ–ª—å—à–æ–π –æ—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–æ–π –∏ textarea */
}
.raw-body.open { display: block; } /* –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–ª–∞—Å—Å–∞ .open */

.raw-block textarea {
  width: 100%;                             /* –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É */
  min-height: 500px;                       /* –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
  font-family: 'SF Mono', 'Fira Code', monospace; /* –º–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è –∫–æ–¥–∞ */
  font-size: .78rem;                       /* –º–µ–ª–∫–∏–π ‚Äî –º–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ */
  line-height: 1.5;                        /* –º–µ–∂—Å—Ç—Ä–æ—á–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ */
  color: var(--text);                      /* –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç */
  background: var(--surface);              /* –±–µ–ª—ã–π / —Ç—ë–º–Ω—ã–π —Ñ–æ–Ω */
  border: 1px solid var(--border);         /* —Ä–∞–º–∫–∞ */
  border-radius: 0 0 var(--r) var(--r);   /* —Å–∫—Ä—É–≥–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–∏–∂–Ω–∏–µ —É–≥–ª—ã (–≤–µ—Ä—Ö–Ω–∏–µ ‚Äî —É –∫–Ω–æ–ø–∫–∏) */
  padding: 12px;                           /* –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã */
  resize: vertical;                        /* –º–æ–∂–Ω–æ —Ä–∞—Å—Ç—è–≥–∏–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
  outline: none;                           /* —É–±–∏—Ä–∞–µ–º outline –±—Ä–∞—É–∑–µ—Ä–∞ */
  transition: border-color .15s;           /* –∞–Ω–∏–º–∞—Ü–∏—è —Ä–∞–º–∫–∏ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ */
}
.raw-block textarea:focus { border-color: var(--accent); } /* —Å–∏–Ω—è—è —Ä–∞–º–∫–∞ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ */

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –ù–ò–ñ–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ –ò–ù–°–¢–†–£–ú–ï–ù–¢–û–í (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.toolbar {
  position: fixed;                                       /* —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞ */
  bottom: 0; left: 0; right: 0;                         /* –æ—Ç –∫—Ä–∞—è –¥–æ –∫—Ä–∞—è */
  background: var(--surface);                            /* –±–µ–ª—ã–π / —Ç—ë–º–Ω—ã–π —Ñ–æ–Ω */
  border-top: 1px solid var(--border);                   /* —Ç–æ–Ω–∫–∞—è –ª–∏–Ω–∏—è —Å–≤–µ—Ä—Ö—É */
  padding: 8px 12px max(8px, env(safe-area-inset-bottom)); /* –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É –¥–ª—è iPhone */
  display: flex;                                         /* –∫–Ω–æ–ø–∫–∏ –≤ —Ä—è–¥ */
  gap: 6px;                                              /* —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–∞–º–∏ */
  z-index: 50;                                           /* –ø–æ–≤–µ—Ä—Ö –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
  box-shadow: 0 -4px 20px rgba(22,27,46,.08);            /* —Ç–µ–Ω—å –≤–≤–µ—Ä—Ö */
}

.toolbar-center {
  max-width: 480px;  /* –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ø–æ —à–∏—Ä–∏–Ω–µ –∫–∞–∫ .app */
  margin: 0 auto;    /* —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º */
  width: 100%;       /* –Ω–∞ –≤—Å—é –¥–æ—Å—Ç—É–ø–Ω—É—é —à–∏—Ä–∏–Ω—É */
  display: flex;     /* –∫–Ω–æ–ø–∫–∏ –≤ —Ä—è–¥ */
  gap: 6px;          /* —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–∞–º–∏ */
}

/* –û–±—ã—á–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –ø–∞–Ω–µ–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ */
.tbtn {
  flex: 1;                    /* –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π —à–∏—Ä–∏–Ω—ã */
  height: 52px;               /* –≤—ã—Å–æ—Ç–∞ –∫–Ω–æ–ø–∫–∏ */
  border-radius: var(--r);    /* —Å–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–µ —É–≥–ª—ã */
  border: 1.5px solid var(--border); /* —Ä–∞–º–∫–∞ */
  background: var(--surface2); /* —Ñ–æ–Ω */
  color: var(--text);          /* —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –∏ –∏–∫–æ–Ω–∫–∏ */
  font-family: var(--font);    /* –æ—Å–Ω–æ–≤–Ω–æ–π —à—Ä–∏—Ñ—Ç */
  font-size: .72rem;           /* –º–µ–ª–∫–∞—è –ø–æ–¥–ø–∏—Å—å –ø–æ–¥ –∏–∫–æ–Ω–∫–æ–π */
  font-weight: 700;            /* –∂–∏—Ä–Ω–∞—è */
  cursor: pointer;             /* –∫—É—Ä—Å–æ—Ä-—Ä—É–∫–∞ */
  display: flex;               /* –∏–∫–æ–Ω–∫–∞ –Ω–∞–¥ —Ç–µ–∫—Å—Ç–æ–º */
  flex-direction: column;      /* –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
  align-items: center;         /* –ø–æ —Ü–µ–Ω—Ç—Ä—É –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ */
  justify-content: center;     /* –ø–æ —Ü–µ–Ω—Ç—Ä—É –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
  gap: 2px;                    /* –æ—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –∏–∫–æ–Ω–∫–æ–π –∏ –ø–æ–¥–ø–∏—Å—å—é */
  transition: all .18s;        /* –∞–Ω–∏–º–∞—Ü–∏—è hover */
  line-height: 1.1;            /* –º–µ–∂—Å—Ç—Ä–æ—á–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª */
}
.tbtn:hover {
  background: var(--accent-lt);   /* —Å–≤–µ—Ç–ª–æ-—Å–∏–Ω–∏–π —Ñ–æ–Ω */
  border-color: var(--accent);    /* —Å–∏–Ω—è—è —Ä–∞–º–∫–∞ */
  color: var(--accent);           /* —Å–∏–Ω–∏–π —Ç–µ–∫—Å—Ç */
}
.tbtn:active { transform: scale(.96); }   /* –Ω–∞–∂–∞—Ç–∏–µ ‚Äî —Å–ª–µ–≥–∫–∞ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è */
.tbtn:disabled { opacity: .3; cursor: not-allowed; } /* –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞—è –∫–Ω–æ–ø–∫–∞ */
.tbtn:disabled:hover {
  background: var(--surface2);   /* –æ—Ç–º–µ–Ω—è–µ–º hover –¥–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ–π */
  border-color: var(--border);
  color: var(--text);
  transform: none;
}

.tbtn-icon {
  font-size: 20px; /* —Ä–∞–∑–º–µ—Ä —ç–º–æ–¥–∑–∏-–∏–∫–æ–Ω–∫–∏ */
  line-height: 1;  /* —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –ª–∏—à–Ω–∏—Ö –æ—Ç—Å—Ç—É–ø–æ–≤ */
}

/* –ê–∫—Ü–µ–Ω—Ç–Ω–∞—è –∫–Ω–æ–ø–∫–∞ ¬´–î–æ–±–∞–≤–∏—Ç—å¬ª (—Å–∏–Ω—è—è) */
.tbtn.primary {
  background: var(--accent);                     /* —Å–∏–Ω–∏–π —Ñ–æ–Ω */
  border-color: var(--accent);                   /* —Å–∏–Ω—è—è —Ä–∞–º–∫–∞ */
  color: #fff;                                   /* –±–µ–ª—ã–π —Ç–µ–∫—Å—Ç */
  box-shadow: 0 2px 8px rgba(61,90,254,.3);      /* —Å–∏–Ω—è—è —Ç–µ–Ω—å */
}
.tbtn.primary:hover { opacity: .9; } /* —á—É—Ç—å –ø—Ä–æ–∑—Ä–∞—á–Ω–µ–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */

/* –ö–Ω–æ–ø–∫–∞ ¬´–°–∫–∞—á–∞—Ç—å¬ª (–∑–µ–ª—ë–Ω–∞—è) */
.tbtn.success {
  background: var(--green);                      /* –∑–µ–ª—ë–Ω—ã–π —Ñ–æ–Ω */
  border-color: var(--green);                    /* –∑–µ–ª—ë–Ω–∞—è —Ä–∞–º–∫–∞ */
  color: #fff;                                   /* –±–µ–ª—ã–π —Ç–µ–∫—Å—Ç */
  box-shadow: 0 2px 8px rgba(0,200,150,.3);      /* –∑–µ–ª—ë–Ω–∞—è —Ç–µ–Ω—å */
}
.tbtn.success:hover { opacity: .9; } /* —á—É—Ç—å –ø—Ä–æ–∑—Ä–∞—á–Ω–µ–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê (—Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö ‚Äî bottom sheet)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.modal-overlay {
  display: none;                       /* —Å–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
  position: fixed;                     /* –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
  inset: 0;                            /* –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
  background: rgba(10,12,25,.55);      /* —Ç—ë–º–Ω—ã–π –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω */
  backdrop-filter: blur(4px);          /* —Ä–∞–∑–º—ã—Ç–∏–µ —Ñ–æ–Ω–∞ –ø–æ–¥ –æ–≤–µ—Ä–ª–µ–µ–º */
  z-index: 200;                        /* –ø–æ–≤–µ—Ä—Ö –ø–∞–Ω–µ–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ */
  align-items: flex-end;               /* –ø—Ä–∏–∂–∏–º–∞–µ–º sheet –∫ –Ω–∏–∑—É */
  justify-content: center;             /* —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ */
  padding: 0;                          /* –±–µ–∑ –æ—Ç—Å—Ç—É–ø–æ–≤ —É –æ–≤–µ—Ä–ª–µ—è */
}
.modal-overlay.show { display: flex; } /* –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ .show */

/* –°–∞–º–æ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
.modal-sheet {
  background: var(--surface);                      /* –±–µ–ª—ã–π / —Ç—ë–º–Ω—ã–π —Ñ–æ–Ω */
  width: 100%;                                     /* –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É */
  max-width: 480px;                                /* –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ø–æ —à–∏—Ä–∏–Ω–µ */
  border-radius: var(--r) var(--r) 0 0;            /* —Å–∫—Ä—É–≥–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≤–µ—Ä—Ö–Ω–∏–µ —É–≥–ª—ã */
  padding: 20px 20px max(20px, env(safe-area-inset-bottom)); /* –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É –¥–ª—è iPhone */
  box-shadow: var(--shadow-l);                     /* —Å–∏–ª—å–Ω–∞—è —Ç–µ–Ω—å –≤–≤–µ—Ä—Ö */
  animation: slideUp .25s cubic-bezier(.32,.72,0,1); /* –∞–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è */
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è ‚Äî sheet –µ–¥–µ—Ç —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö */
@keyframes slideUp {
  from { transform: translateY(100%); opacity: 0; } /* –Ω–∞—á–∏–Ω–∞–µ—Ç —Å–Ω–∏–∑—É, –Ω–µ–≤–∏–¥–∏–º—ã–π */
  to   { transform: translateY(0);    opacity: 1; } /* –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–∞ –º–µ—Å—Ç–æ */
}

/* –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω–∞—è —Ä—É—á–∫–∞ –≤–≤–µ—Ä—Ö—É –º–æ–¥–∞–ª–∫–∏ (–∫–∞–∫ –≤ iOS) */
.modal-handle {
  width: 36px; height: 4px;   /* –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ 36√ó4 */
  background: var(--border);   /* —Ü–≤–µ—Ç —Ä–∞–º–æ–∫ */
  border-radius: 2px;          /* —Å–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–π */
  margin: 0 auto 18px;         /* —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º, –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É */
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
.modal-title {
  font-size: 1.05rem;     /* —á—É—Ç—å –∫—Ä—É–ø–Ω–µ–µ –±–∞–∑–æ–≤–æ–≥–æ */
  font-weight: 800;       /* –æ—á–µ–Ω—å –∂–∏—Ä–Ω—ã–π */
  margin-bottom: 16px;    /* –æ—Ç—Å—Ç—É–ø –¥–æ –ø–æ–ª–µ–π */
  color: var(--text);     /* –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç */
}

/* –ü–æ–¥–ø–∏—Å—å –Ω–∞–¥ –ø–æ–ª–µ–º –≤–≤–æ–¥–∞ */
.field-label {
  font-size: .78rem;        /* –º–µ–ª–∫–∏–π */
  font-weight: 700;         /* –∂–∏—Ä–Ω—ã–π */
  text-transform: uppercase; /* –ó–ê–ì–õ–ê–í–ù–´–ï */
  letter-spacing: .5px;     /* —Ä–∞–∑—Ä–µ–∂–µ–Ω–∏–µ –±—É–∫–≤ */
  color: var(--text2);      /* –ø—Ä–∏–≥–ª—É—à—ë–Ω–Ω—ã–π —Ü–≤–µ—Ç */
  margin-bottom: 5px;       /* –æ—Ç—Å—Ç—É–ø –¥–æ –ø–æ–ª—è */
  margin-top: 12px;         /* –æ—Ç—Å—Ç—É–ø –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–æ–ª—è */
}
.field-label:first-of-type { margin-top: 0; } /* –ø–µ—Ä–≤–∞—è –ø–æ–¥–ø–∏—Å—å –±–µ–∑ –≤–µ—Ä—Ö–Ω–µ–≥–æ –æ—Ç—Å—Ç—É–ø–∞ */

/* –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ –∏ select –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª–∫–∏ */
.modal-input, .modal-select {
  width: 100%;                          /* –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É */
  font-family: var(--font);             /* –æ—Å–Ω–æ–≤–Ω–æ–π —à—Ä–∏—Ñ—Ç */
  font-size: 1rem;                      /* –±–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä */
  font-weight: 500;                     /* —Å—Ä–µ–¥–Ω—è—è –∂–∏—Ä–Ω–æ—Å—Ç—å */
  color: var(--text);                   /* –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç */
  background: var(--surface2);          /* —Ñ–æ–Ω –ø–æ–ª—è */
  border: 1.5px solid var(--border);    /* —Ä–∞–º–∫–∞ */
  border-radius: var(--r-sm);           /* —Å–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–µ —É–≥–ª—ã */
  padding: 13px 14px;                   /* —É–¥–æ–±–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –¥–ª—è —Ç–∞–ø–∞ */
  outline: none;                        /* —É–±–∏—Ä–∞–µ–º outline –±—Ä–∞—É–∑–µ—Ä–∞ */
  transition: border-color .15s;        /* –∞–Ω–∏–º–∞—Ü–∏—è —Ä–∞–º–∫–∏ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ */
}
.modal-input:focus, .modal-select:focus {
  border-color: var(--accent); /* —Å–∏–Ω—è—è —Ä–∞–º–∫–∞ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ */
}

/* –ë–ª–æ–∫ —Å –∫–Ω–æ–ø–∫–∞–º–∏ ¬´–û—Ç–º–µ–Ω–∞¬ª –∏ ¬´–î–æ–±–∞–≤–∏—Ç—å¬ª */
.modal-btns {
  display: flex;     /* –∫–Ω–æ–ø–∫–∏ –≤ —Ä—è–¥ */
  gap: 8px;          /* —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–∞–º–∏ */
  margin-top: 18px;  /* –æ—Ç—Å—Ç—É–ø –æ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ–ª—è */
}

/* –ë–∞–∑–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª–∫–∏ */
.mbtn {
  flex: 1;                   /* –æ–±–µ –∫–Ω–æ–ø–∫–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π —à–∏—Ä–∏–Ω—ã */
  height: 48px;              /* —É–¥–æ–±–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è —Ç–∞–ø–∞ */
  border-radius: var(--r);   /* —Å–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–µ —É–≥–ª—ã */
  border: none;              /* –±–µ–∑ —Ä–∞–º–∫–∏ (–¥–ª—è confirm) */
  font-family: var(--font);  /* –æ—Å–Ω–æ–≤–Ω–æ–π —à—Ä–∏—Ñ—Ç */
  font-size: .9rem;          /* —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞ */
  font-weight: 700;          /* –∂–∏—Ä–Ω—ã–π */
  cursor: pointer;           /* –∫—É—Ä—Å–æ—Ä-—Ä—É–∫–∞ */
  transition: all .18s;      /* –∞–Ω–∏–º–∞—Ü–∏—è hover */
}
.mbtn:active { transform: scale(.98); } /* –Ω–∞–∂–∞—Ç–∏–µ ‚Äî —Å–ª–µ–≥–∫–∞ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è */

/* –ö–Ω–æ–ø–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (—Å–∏–Ω—è—è) */
.mbtn-confirm {
  background: var(--accent);                    /* —Å–∏–Ω–∏–π —Ñ–æ–Ω */
  color: #fff;                                  /* –±–µ–ª—ã–π —Ç–µ–∫—Å—Ç */
  box-shadow: 0 2px 10px rgba(61,90,254,.35);   /* —Å–∏–Ω—è—è —Ç–µ–Ω—å */
}
.mbtn-confirm:hover { opacity: .9; } /* —á—É—Ç—å –ø—Ä–æ–∑—Ä–∞—á–Ω–µ–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */

/* –ö–Ω–æ–ø–∫–∞ –æ—Ç–º–µ–Ω—ã (—Å–µ—Ä–∞—è) */
.mbtn-cancel {
  background: var(--surface2);          /* —Å–µ—Ä—ã–π —Ñ–æ–Ω */
  color: var(--text2);                  /* –ø—Ä–∏–≥–ª—É—à—ë–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç */
  border: 1.5px solid var(--border);    /* —Ä–∞–º–∫–∞ */
}
.mbtn-cancel:hover {
  border-color: var(--accent);   /* —Å–∏–Ω—è—è —Ä–∞–º–∫–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
  color: var(--accent);          /* —Å–∏–Ω–∏–π —Ç–µ–∫—Å—Ç */
  background: var(--accent-lt);  /* —Å–≤–µ—Ç–ª–æ-—Å–∏–Ω–∏–π —Ñ–æ–Ω */
}

/* –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ (–∫—Ä—É–ø–Ω—ã–µ, —Å –∏–∫–æ–Ω–∫–æ–π) */
.type-btn {
  width: 100%;                          /* –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É */
  padding: 14px;                        /* –ø—Ä–æ—Å—Ç–æ—Ä–Ω—ã–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã */
  border-radius: var(--r);              /* —Å–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–µ —É–≥–ª—ã */
  border: 1.5px solid var(--border);    /* —Ä–∞–º–∫–∞ */
  background: var(--surface2);          /* —Ñ–æ–Ω */
  font-family: var(--font);             /* –æ—Å–Ω–æ–≤–Ω–æ–π —à—Ä–∏—Ñ—Ç */
  font-size: .92rem;                    /* —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞ */
  font-weight: 700;                     /* –∂–∏—Ä–Ω—ã–π */
  color: var(--text);                   /* –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç */
  cursor: pointer;                      /* –∫—É—Ä—Å–æ—Ä-—Ä—É–∫–∞ */
  text-align: left;                     /* —Ç–µ–∫—Å—Ç –ø—Ä–∏–∂–∞—Ç –≤–ª–µ–≤–æ */
  display: flex;                        /* –∏–∫–æ–Ω–∫–∞ + —Ç–µ–∫—Å—Ç –≤ —Ä—è–¥ */
  align-items: center;                  /* –ø–æ —Ü–µ–Ω—Ç—Ä—É –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
  gap: 10px;                            /* —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∏–∫–æ–Ω–∫–æ–π –∏ —Ç–µ–∫—Å—Ç–æ–º */
  margin-bottom: 8px;                   /* –æ—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–∞–º–∏ */
  transition: all .18s;                 /* –∞–Ω–∏–º–∞—Ü–∏—è hover */
}
.type-btn:hover {
  border-color: var(--accent);   /* —Å–∏–Ω—è—è —Ä–∞–º–∫–∞ */
  background: var(--accent-lt);  /* —Å–≤–µ—Ç–ª–æ-—Å–∏–Ω–∏–π —Ñ–æ–Ω */
  color: var(--accent);          /* —Å–∏–Ω–∏–π —Ç–µ–∫—Å—Ç */
}

/* –ò–∫–æ–Ω–∫–∞-–∫–≤–∞–¥—Ä–∞—Ç –≤–Ω—É—Ç—Ä–∏ type-btn */
.type-btn-icon {
  width: 36px; height: 36px;   /* –∫–≤–∞–¥—Ä–∞—Ç 36√ó36 */
  border-radius: var(--r-sm);  /* —Å–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–µ —É–≥–ª—ã */
  display: flex; align-items: center; justify-content: center; /* —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —ç–º–æ–¥–∑–∏ */
  font-size: 18px;             /* —Ä–∞–∑–º–µ—Ä —ç–º–æ–¥–∑–∏ */
  flex-shrink: 0;              /* –Ω–µ —Å–∂–∏–º–∞–µ—Ç—Å—è */
}
.tb-blue  .type-btn-icon { background: var(--accent-lt); } /* —Å–∏–Ω–∏–π —Ñ–æ–Ω –¥–ª—è type-btn —Å–∏–Ω–µ–≥–æ —Ç–∏–ø–∞ */
.tb-green .type-btn-icon { background: var(--green-lt); }  /* –∑–µ–ª—ë–Ω—ã–π —Ñ–æ–Ω –¥–ª—è type-btn –∑–µ–ª—ë–Ω–æ–≥–æ —Ç–∏–ø–∞ */

/* –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –≤–Ω—É—Ç—Ä–∏ GitHub-–º–æ–¥–∞–ª–∫–∏ */
.gh-divider {
  border: none;                         /* —É–±–∏—Ä–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Ä–∞–º–∫—É hr */
  border-top: 1px solid var(--border);  /* —Ç–æ–ª—å–∫–æ –≤–µ—Ä—Ö–Ω—è—è –ª–∏–Ω–∏—è */
  margin: 16px 0;                       /* –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã */
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ GitHub-–º–æ–¥–∞–ª–∫–∏ */
.gh-section-title {
  font-size: .78rem;        /* –º–µ–ª–∫–∏–π */
  font-weight: 700;         /* –∂–∏—Ä–Ω—ã–π */
  color: var(--text2);      /* –ø—Ä–∏–≥–ª—É—à—ë–Ω–Ω—ã–π —Ü–≤–µ—Ç */
  margin-bottom: 8px;       /* –æ—Ç—Å—Ç—É–ø –¥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–µ–∫—Ü–∏–∏ */
  text-transform: uppercase; /* –ó–ê–ì–õ–ê–í–ù–´–ï */
  letter-spacing: .5px;     /* —Ä–∞–∑—Ä–µ–∂–µ–Ω–∏–µ –±—É–∫–≤ */
}

/* –ü–æ–¥—Å–∫–∞–∑–∫–∞ –æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–º —Ç–æ–∫–µ–Ω–µ */
.token-hint {
  font-size: .72rem;    /* –º–µ–ª–∫–∏–π */
  color: var(--green);  /* –∑–µ–ª—ë–Ω—ã–π ‚Äî –∑–Ω–∞–∫ —á—Ç–æ –≤—Å—ë –æ–∫ */
  margin-top: 4px;      /* –Ω–µ–±–æ–ª—å—à–æ–π –æ—Ç—Å—Ç—É–ø –æ—Ç –ø–æ–ª—è —Ç–æ–∫–µ–Ω–∞ */
  font-weight: 600;     /* –ø–æ–ª—É–∂–∏—Ä–Ω—ã–π */
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –í–°–ü–õ–´–í–ê–Æ–©–ï–ï –£–í–ï–î–û–ú–õ–ï–ù–ò–ï (toast)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
#toast {
  position: fixed;                          /* –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ */
  bottom: 72px;                             /* –Ω–∞–¥ –ø–∞–Ω–µ–ª—å—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ */
  left: 50%;                                /* –Ω–∞—á–∏–Ω–∞–µ–º —Å —Ü–µ–Ω—Ç—Ä–∞ */
  transform: translateX(-50%) translateY(10px); /* —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∏ —á—É—Ç—å –æ–ø—É—Å–∫–∞–µ–º (—Å–∫—Ä—ã—Ç) */
  background: var(--text);                  /* —Ç—ë–º–Ω—ã–π —Ñ–æ–Ω (–∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ) */
  color: var(--bg);                         /* —Å–≤–µ—Ç–ª—ã–π —Ç–µ–∫—Å—Ç */
  padding: 10px 20px;                       /* –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã */
  border-radius: var(--r-pill);             /* —Ñ–æ—Ä–º–∞ ¬´—Ç–∞–±–ª–µ—Ç–∫–∏¬ª */
  font-size: .82rem;                        /* –º–µ–ª–∫–∏–π —Ç–µ–∫—Å—Ç */
  font-weight: 600;                         /* –ø–æ–ª—É–∂–∏—Ä–Ω—ã–π */
  opacity: 0;                               /* –Ω–µ–≤–∏–¥–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
  pointer-events: none;                     /* –Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∫–ª–∏–∫–∏ */
  z-index: 500;                             /* –ø–æ–≤–µ—Ä—Ö –º–æ–¥–∞–ª–æ–∫ */
  transition: opacity .2s, transform .2s;   /* –ø–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ */
  white-space: nowrap;                      /* —Ç–µ–∫—Å—Ç –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É */
  max-width: calc(100vw - 32px);            /* –Ω–µ —à–∏—Ä–µ —ç–∫—Ä–∞–Ω–∞ –º–∏–Ω—É—Å –æ—Ç—Å—Ç—É–ø—ã */
  text-align: center;                       /* —Ç–µ–∫—Å—Ç –ø–æ —Ü–µ–Ω—Ç—Ä—É */
}
#toast.visible {
  opacity: 1;                              /* –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–∏–¥–∏–º */
  transform: translateX(-50%) translateY(0); /* –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞ –º–µ—Å—Ç–æ */
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –ü–£–°–¢–û–ï –°–û–°–¢–û–Ø–ù–ò–ï (–∫–æ–≥–¥–∞ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.empty-state {
  text-align: center;   /* –≤—Å—ë –ø–æ —Ü–µ–Ω—Ç—Ä—É */
  padding: 40px 20px;   /* –ø—Ä–æ—Å—Ç–æ—Ä–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã */
  color: var(--text2);  /* –ø—Ä–∏–≥–ª—É—à—ë–Ω–Ω—ã–π —Ü–≤–µ—Ç */
}
.empty-state-icon {
  font-size: 36px;     /* –∫—Ä—É–ø–Ω–∞—è –∏–∫–æ–Ω–∫–∞ */
  margin-bottom: 10px; /* –æ—Ç—Å—Ç—É–ø –¥–æ —Ç–µ–∫—Å—Ç–∞ */
}
.empty-state p {
  font-size: .88rem;  /* –º–µ–ª–∫–∏–π —Ç–µ–∫—Å—Ç */
  font-weight: 500;   /* —Å—Ä–µ–¥–Ω—è—è –∂–∏—Ä–Ω–æ—Å—Ç—å */
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DRAG & DROP (–≤–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.sortable-ghost {
  opacity: .3;                           /* –ø—Ä–∏–∑—Ä–∞–∫ –Ω–∞ —Å—Ç–∞—Ä–æ–º –º–µ—Å—Ç–µ ‚Äî –ø–æ—á—Ç–∏ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π */
  background: var(--accent-lt) !important; /* —Å–∏–Ω–µ–≤–∞—Ç—ã–π —Ñ–æ–Ω –ø—Ä–∏–∑—Ä–∞–∫–∞ */
}
.sortable-chosen {
  box-shadow: var(--shadow-l) !important; /* —Å–∏–ª—å–Ω–∞—è —Ç–µ–Ω—å —É –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ */
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   –°–ß–Å–¢–ß–ò–ö –ó–ê–ü–ò–°–ï–ô –í –†–ê–ó–î–ï–õ–ï
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.section-count {
  font-size: .7rem;              /* –º–µ–ª–∫–∏–π */
  font-weight: 700;              /* –∂–∏—Ä–Ω—ã–π */
  background: var(--surface2);   /* —Ñ–æ–Ω –ø–ª–∞—à–∫–∏ */
  border: 1px solid var(--border); /* —Ä–∞–º–∫–∞ */
  border-radius: var(--r-pill);  /* —Ñ–æ—Ä–º–∞ ¬´—Ç–∞–±–ª–µ—Ç–∫–∏¬ª */
  padding: 2px 8px;              /* –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã */
  color: var(--text2);           /* –ø—Ä–∏–≥–ª—É—à—ë–Ω–Ω—ã–π —Ü–≤–µ—Ç */
  margin-left: auto;             /* –ø—Ä–∏–∂–∏–º–∞–µ–º –∫ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é */
}
</style>
</head>
<body>

<div class="app">

  <!-- HEADER -->
  <header class="header">
    <div class="header-logo">‚öôÔ∏è</div>
    <div style="flex:1; min-width:0;">
      <div class="header-title">Stations Editor</div>
      <div class="header-sub" id="headerSub">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>
    </div>
    <button class="theme-btn" id="themeBtn" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">üåô</button>
  </header>

  <!-- STATUS -->
  <div id="loadStatus" class="loading" data-icon="‚è≥">–ó–∞–≥—Ä—É–∑–∫–∞ stations.js —Å GitHub‚Ä¶</div>

  <!-- GROUP TABS -->
  <div class="tabs-wrap">
    <div class="tabs" id="tabs">
      <button class="tab active" data-group="defaultCoords">üë§ –£—á–∞—Å—Ç–Ω–∏–∫–∏</button>
      <button class="tab" data-group="stations">üöâ –°—Ç–∞–Ω—Ü–∏–∏</button>
      <button class="tab" data-group="travelTimes">‚è± –í—Ä–µ–º—è</button>
      <button class="tab" data-group="treffpunkt">üìç Treffpunkt</button>
      <button class="tab" data-group="trefftravelTimes">‚è±üìç Treff-–í—Ä–µ–º—è</button>
      <button class="tab" data-group="participantOrders">üî¢ –ü–æ—Ä—è–¥–æ–∫</button>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <main class="content" id="cards"></main>

</div><!-- .app -->

<!-- TOOLBAR -->
<div class="toolbar">
  <div class="toolbar-center">
    <button class="tbtn" id="loadBtn" title="–û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª">
      <span class="tbtn-icon">üìÇ</span>
    </button>
    <button class="tbtn" id="copyBtn" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å JSON">
      <span class="tbtn-icon">üìã</span>
    </button>
    <button class="tbtn primary" id="addBtn" title="–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å">
      <span class="tbtn-icon">Ôºã</span>
    </button>
    <button class="tbtn" id="recalcBtn" title="–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Ä–µ–º—è —á–µ—Ä–µ–∑ API">
      <span class="tbtn-icon">üîÑ</span>
    </button>
    <button class="tbtn" id="applyRaw" title="–ü—Ä–∏–º–µ–Ω–∏—Ç—å JSON">
      <span class="tbtn-icon">‚úî</span>
    </button>
    <button class="tbtn success" id="saveBtn" title="–°–∫–∞—á–∞—Ç—å stations.js">
      <span class="tbtn-icon">üíæ</span>
    </button>
    <button class="tbtn" id="ghUploadBtn" title="–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞ GitHub" disabled>
      <span class="tbtn-icon">‚¨ÜÔ∏è</span>
    </button>
  </div>
</div>

<!-- FILE INPUT -->
<input type="file" id="fileInput" accept=".js,.json">

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODAL: –î–æ–±–∞–≤–∏—Ç—å ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="addModal" class="modal-overlay">
  <div class="modal-sheet">
    <div class="modal-handle"></div>
    <div class="modal-title">–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å</div>
    <div class="field-label">–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö</div>
    <select id="modalGroupSel" class="modal-select">
      <option value="defaultCoords">üë§ –£—á–∞—Å—Ç–Ω–∏–∫ (defaultCoords)</option>
      <option value="stations">üöâ –°—Ç–∞–Ω—Ü–∏—è (stations)</option>
      <option value="treffpunkt">üìç Treffpunkt</option>
      <option value="travelTimes">‚è± –í—Ä–µ–º—è A‚ÜíB (travelTimes)</option>
      <option value="trefftravelTimes">‚è±üìç –í—Ä–µ–º—è Treff‚Üí–£—á–∞—Å—Ç–Ω–∏–∫</option>
    </select>
    <div class="field-label">–ù–∞–∑–≤–∞–Ω–∏–µ / –∫–ª—é—á</div>
    <input id="newName" class="modal-input" type="text" placeholder="–ò–º—è –∏–ª–∏ –∫–ª—é—á –ò–º—è1-–ò–º—è2">
    <div class="field-label" id="coordLabel">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (lat, lng)</div>
    <input id="newCoord" class="modal-input" type="text" placeholder="51.530, 6.850 –∏–ª–∏ —Å—Å—ã–ª–∫–∞ Google Maps">
    <div class="modal-btns">
      <button class="mbtn mbtn-cancel" id="addCancel">–û—Ç–º–µ–Ω–∞</button>
      <button class="mbtn mbtn-confirm" id="addConfirm">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODAL: –í—ã–±–æ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–∞ ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="selectModal" class="modal-overlay">
  <div class="modal-sheet">
    <div class="modal-handle"></div>
    <div class="modal-title" id="selectModalTitle">–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞</div>
    <div class="field-label">–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞</div>
    <select id="selectParticipant" class="modal-select" size="5" style="height:auto;min-height:120px;"></select>
    <div class="modal-btns">
      <button class="mbtn mbtn-cancel" id="selectCancel">–û—Ç–º–µ–Ω–∞</button>
      <button class="mbtn mbtn-confirm" id="selectConfirm">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODAL: GitHub ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="ghModal" class="modal-overlay">
  <div class="modal-sheet">
    <div class="modal-handle"></div>
    <div class="modal-title">üêô –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞ GitHub</div>

    <div class="field-label">GitHub Token (classic)</div>
    <input id="ghTokenInp" class="modal-input" type="password" placeholder="ghp_xxxxxxxx‚Ä¶" autocomplete="off">
    <div class="token-hint" id="tokenHint"></div>

    <div class="gh-section-title" style="margin-top:16px">–ó–∞–≥—Ä—É–∑–∏—Ç—å stations.js</div>
    <button class="mbtn mbtn-confirm" id="ghSendStationsBtn" style="width:100%;height:46px;">‚¨ÜÔ∏è –û—Ç–ø—Ä–∞–≤–∏—Ç—å stations.js</button>

    <hr class="gh-divider">

    <div class="gh-section-title">–î—Ä—É–≥–æ–π —Ñ–∞–π–ª</div>
    <input id="ghAnyFile" type="file" style="width:100%;margin-bottom:8px;color:var(--text2);font-size:.8rem;">
    <input id="ghAnyName" class="modal-input" type="text" placeholder="–ò–º—è —Ñ–∞–π–ª–∞ –Ω–∞ GitHub (data.json)">
    <div class="modal-btns">
      <button class="mbtn mbtn-cancel" id="ghCancelBtn">–û—Ç–º–µ–Ω–∞</button>
      <button class="mbtn mbtn-confirm" id="ghSendAnyBtn">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODAL: –ü–µ—Ä–µ—Å—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏ ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="recalcModal" class="modal-overlay">
  <div class="modal-sheet">
    <div class="modal-handle"></div>
    <div class="modal-title">üîÑ –ü–µ—Ä–µ—Å—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ Google API</div>

    <div class="field-label">–ß—Ç–æ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å</div>
    <select id="recalcTarget" class="modal-select">
      <option value="travelTimes">‚è± –£—á–∞—Å—Ç–Ω–∏–∫ ‚Üí —É—á–∞—Å—Ç–Ω–∏–∫</option>
      <option value="trefftravelTimes">üìç Treffpunkt ‚Üí —É—á–∞—Å—Ç–Ω–∏–∫–∏</option>
      <option value="both">üîÑ –í—Å—ë —Å—Ä–∞–∑—É</option>
    </select>

    <div class="field-label">–†–µ–∂–∏–º</div>
    <select id="recalcMode" class="modal-select">
      <option value="missing">–¢–æ–ª—å–∫–æ —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (5 –º–∏–Ω)</option>
      <option value="all">–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å–µ –ø–∞—Ä—ã</option>
    </select>

    <div id="recalcProgress" style="display:none;margin-top:14px;padding:10px 12px;background:var(--surface2);border-radius:var(--r-sm);font-size:.82rem;color:var(--text2);font-weight:600;line-height:1.5;"></div>

    <div class="modal-btns">
      <button class="mbtn mbtn-cancel" id="recalcCancel">–û—Ç–º–µ–Ω–∞</button>
      <button class="mbtn mbtn-confirm" id="recalcStart">‚ñ∂ –ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CONSTANTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const GH_OWNER   = 'Kesik80';
const GH_REPO    = 'fahrzeit';
const GH_FILE    = 'stations.js';
const GH_RAW_URL = `https://raw.githubusercontent.com/${GH_OWNER}/${GH_REPO}/main/${GH_FILE}`;
const DEFAULT_TT = 5;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  GOOGLE API (—á–µ—Ä–µ–∑ Vercel, —Ç–æ—Ç –∂–µ –¥–æ–º–µ–Ω)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// SVG –∏–∫–æ–Ω–∫–∞ Google Maps ‚Äî —Ü–≤–µ—Ç–Ω–∞—è (—Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ —á–µ—Ä–µ–∑ API)
const coloredMapSvg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 92.3 132.3" width="16" height="16"><path fill="#1a73e8" d="M60.2 2.2C55.8.8 51 0 46.1 0 32 0 19.3 6.4 10.8 16.5l21.8 18.3L60.2 2.2z"/><path fill="#ea4335" d="M10.8 16.5C4.1 24.5 0 34.9 0 46.1c0 8.7 1.7 15.7 4.6 22l28-33.3-21.8-18.3z"/><path fill="#4285f4" d="M46.2 28.5c9.8 0 17.7 7.9 17.7 17.7 0 4.3-1.6 8.3-4.2 11.4 0 0 13.9-16.6 27.5-32.7-5.6-10.8-15.3-19-27-22.7L32.6 34.8c3.3-3.8 8.1-6.3 13.6-6.3"/><path fill="#fbbc04" d="M46.2 63.8c-9.8 0-17.7-7.9-17.7-17.7 0-4.3 1.5-8.3 4.1-11.3l-28 33.3c4.8 10.6 12.8 19.2 21 29.9l34.1-40.5c-3.3 3.9-8.1 6.3-13.5 6.3"/><path fill="#34a853" d="M59.1 109.2c15.4-24.1 33.3-35 33.3-63 0-7.7-1.9-14.9-5.2-21.3L25.6 98c2.6 3.4 5.3 7.3 7.9 11.3 9.4 14.5 6.8 23.1 12.8 23.1s3.4-8.7 12.8-23.2"/></svg>`;
// SVG –∏–∫–æ–Ω–∫–∞ Google Maps ‚Äî —Å–µ—Ä–∞—è (–Ω–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ / –∏–∑–º–µ–Ω–µ–Ω–æ –≤—Ä—É—á–Ω—É—é)
const grayMapSvg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 92.3 132.3" width="16" height="16"><path fill="#bbb" d="M60.2 2.2C55.8.8 51 0 46.1 0 32 0 19.3 6.4 10.8 16.5l21.8 18.3L60.2 2.2z"/><path fill="#bbb" d="M10.8 16.5C4.1 24.5 0 34.9 0 46.1c0 8.7 1.7 15.7 4.6 22l28-33.3-21.8-18.3z"/><path fill="#bbb" d="M46.2 28.5c9.8 0 17.7 7.9 17.7 17.7 0 4.3-1.6 8.3-4.2 11.4 0 0 13.9-16.6 27.5-32.7-5.6-10.8-15.3-19-27-22.7L32.6 34.8c3.3-3.8 8.1-6.3 13.6-6.3"/><path fill="#bbb" d="M46.2 63.8c-9.8 0-17.7-7.9-17.7-17.7 0-4.3 1.5-8.3 4.1-11.3l-28 33.3c4.8 10.6 12.8 19.2 21 29.9l34.1-40.5c-3.3 3.9-8.1 6.3-13.5 6.3"/><path fill="#bbb" d="M59.1 109.2c15.4-24.1 33.3-35 33.3-63 0-7.7-1.9-14.9-5.2-21.3L25.6 98c2.6 3.4 5.3 7.3 7.9 11.3 9.4 14.5 6.8 23.1 12.8 23.1s3.4-8.7 12.8-23.2"/></svg>`;

function flagKey(key, isTreff) { return (isTreff ? 'treff:' : 'tt:') + key; }
function setAutoFlag(key, isTreff, val) { autoCalcFlags[flagKey(key, isTreff)] = val; }
function getAutoFlag(key, isTreff) { return !!autoCalcFlags[flagKey(key, isTreff)]; }

// –ó–∞–ø—Ä–æ—Å –≤—Ä–µ–º–µ–Ω–∏ –≤ –ø—É—Ç–∏ –º–µ–∂–¥—É –¥–≤—É–º—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ ‚Üí –º–∏–Ω—É—Ç—ã
async function fetchTravelTime(originLat, originLng, destLat, destLng) {
  const resp = await fetch('/api/calculate-time', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ originLat, originLng, destLat, destLng })
  });
  if (!resp.ok) {
    const err = await resp.json().catch(() => ({}));
    throw new Error(err.message || `HTTP ${resp.status}`);
  }
  const d = await resp.json();
  if (!d.success) throw new Error('API –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É');
  return d.duration.minutes;
}

// –ü–æ–ª—É—á–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —É—á–∞—Å—Ç–Ω–∏–∫–∞/—Å—Ç–∞–Ω—Ü–∏–∏ –ø–æ –∏–º–µ–Ω–∏
function getCoordsFor(name) {
  return data.defaultCoords[name] || data.stations[name] || null;
}

// –†–∞–∑–±–∏—Ç—å –∫–ª—é—á "–ò–º—è1-–ò–º—è2" –Ω–∞ –¥–≤–∞ –∏–º–µ–Ω–∏, —É—á–∏—Ç—ã–≤–∞—è —á—Ç–æ –∏–º–µ–Ω–∞ –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥–µ—Ñ–∏—Å
function splitPairKey(key, isTreff) {
  const sourceNames = isTreff
    ? Object.keys(treffpunkt)
    : [...Object.keys(data.defaultCoords), ...Object.keys(data.stations)];
  const destNames = [...Object.keys(data.defaultCoords), ...Object.keys(data.stations)];

  for (const a of sourceNames) {
    if (key.startsWith(a + '-')) {
      const b = key.slice(a.length + 1);
      if (destNames.includes(b)) return [a, b];
    }
  }
  // –ó–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî –ø–µ—Ä–≤—ã–π –¥–µ—Ñ–∏—Å
  const i = key.indexOf('-');
  return [key.slice(0, i), key.slice(i + 1)];
}

// –ü–µ—Ä–µ—Å—á—ë—Ç –æ–¥–Ω–æ–π –ø–∞—Ä—ã travelTimes
async function recalcOne(key, src, btnEl) {
  const [a, b] = splitPairKey(key, false);
  const cA = getCoordsFor(a), cB = getCoordsFor(b);
  if (!cA || !cB) { showMsg(`‚ùå –ù–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç: ${!cA ? a : b}`); return; }
  const orig = btnEl.innerHTML; btnEl.innerHTML = '‚è≥'; btnEl.disabled = true;
  try {
    src[key] = await fetchTravelTime(cA.lat, cA.lng, cB.lat, cB.lng);
    setAutoFlag(key, false, true);
    render(); showMsg(`‚úÖ ${key}: ${src[key]} –º–∏–Ω`);
  } catch(e) {
    showMsg(`‚ùå ${e.message}`, 3000);
    btnEl.innerHTML = orig; btnEl.disabled = false;
  }
}

// –ü–µ—Ä–µ—Å—á—ë—Ç –æ–¥–Ω–æ–π –ø–∞—Ä—ã trefftravelTimes
async function recalcOneTreff(key, btnEl) {
  const [treffName, partName] = splitPairKey(key, true);
  const cT = treffpunkt[treffName], cP = getCoordsFor(partName);
  if (!cT || !cP) { showMsg(`‚ùå –ù–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç: ${!cT ? treffName : partName}`); return; }
  const orig = btnEl.innerHTML; btnEl.innerHTML = '‚è≥'; btnEl.disabled = true;
  try {
    trefftravelTimes[key] = await fetchTravelTime(cT.lat, cT.lng, cP.lat, cP.lng);
    setAutoFlag(key, true, true);
    render(); showMsg(`‚úÖ ${key}: ${trefftravelTimes[key]} –º–∏–Ω`);
  } catch(e) {
    showMsg(`‚ùå ${e.message}`, 3000);
    btnEl.innerHTML = orig; btnEl.disabled = false;
  }
}

// –¢–∏—Ö–∏–π –∞–≤—Ç–æ—Ä–∞—Å—á—ë—Ç –æ–¥–Ω–æ–π –ø–∞—Ä—ã (–ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏)
async function autoCalcPair(key, isTreff) {
  try {
    const [a, b] = splitPairKey(key, isTreff);
    if (isTreff) {
      const cT = treffpunkt[a], cP = getCoordsFor(b);
      if (cT && cP) { trefftravelTimes[key] = await fetchTravelTime(cT.lat, cT.lng, cP.lat, cP.lng); setAutoFlag(key, true, true); }
    } else {
      const cA = getCoordsFor(a), cB = getCoordsFor(b);
      if (cA && cB) { travelTimes[key] = await fetchTravelTime(cA.lat, cA.lng, cB.lat, cB.lng); setAutoFlag(key, false, true); }
    }
    render(); showMsg(`‚úÖ –í—Ä–µ–º—è —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ: ${key}`);
  } catch(e) {
    console.warn('autoCalc:', key, e.message);
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let data = { defaultCoords: {}, stations: {} };
let travelTimes = {}, participantOrders = {}, treffpunkt = {}, trefftravelTimes = {};
// –§–ª–∞–≥–∏: true = —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ —á–µ—Ä–µ–∑ Google API, false/undefined = –≤—Ä—É—á–Ω—É—é
let autoCalcFlags = {}; // –∫–ª—é—á: "tt:–ò–º—è1-–ò–º—è2" –∏–ª–∏ "treff:–ö–ª—é—á"

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  THEME
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const themeBtn = document.getElementById('themeBtn');
function applyTheme(dark) {
  document.body.classList.toggle('dark', dark);
  themeBtn.textContent = dark ? '‚òÄÔ∏è' : 'üåô';
  localStorage.theme = dark ? 'dark' : 'light';
}
applyTheme(localStorage.theme === 'dark');
themeBtn.onclick = () => applyTheme(!document.body.classList.contains('dark'));

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STATUS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setStatus(cls, text, icon) {
  const el = document.getElementById('loadStatus');
  el.className = cls;
  el.setAttribute('data-icon', icon || (cls === 'ok' ? '‚úÖ' : cls === 'err' ? '‚ùå' : '‚è≥'));
  el.textContent = text;
}
function updateHeaderSub() {
  const dc = Object.keys(data.defaultCoords).length;
  const st = Object.keys(data.stations).length;
  document.getElementById('headerSub').textContent = `${dc} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ ¬∑ ${st} —Å—Ç–∞–Ω—Ü–∏–π`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TOAST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let _toastT;
function showMsg(text, ms = 1800) {
  const t = document.getElementById('toast');
  t.textContent = text;
  t.classList.add('visible');
  clearTimeout(_toastT);
  _toastT = setTimeout(() => t.classList.remove('visible'), ms);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  MODAL HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openModal(id)  { document.getElementById(id).classList.add('show'); }
function closeModal(id) { document.getElementById(id).classList.remove('show'); }

// Close on overlay click
document.querySelectorAll('.modal-overlay').forEach(overlay => {
  overlay.addEventListener('click', e => { if (e.target === overlay) overlay.classList.remove('show'); });
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TABS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentGroup = 'defaultCoords';
document.getElementById('tabs').addEventListener('click', e => {
  const tab = e.target.closest('.tab');
  if (!tab) return;
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  tab.classList.add('active');
  currentGroup = tab.dataset.group;
  render();
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  GITHUB LOAD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadFromGitHub() {
  setStatus('loading', '–ó–∞–≥—Ä—É–∑–∫–∞ stations.js —Å GitHub‚Ä¶', '‚è≥');
  try {
    const resp = await fetch(GH_RAW_URL + '?t=' + Date.now(), { cache: 'no-store' });
    if (!resp.ok) throw new Error('HTTP ' + resp.status);
    parseStationsText(await resp.text());
    setStatus('ok', 'stations.js –∑–∞–≥—Ä—É–∂–µ–Ω —Å GitHub', '‚úÖ');
    document.getElementById('ghUploadBtn').disabled = false;
    updateHeaderSub();
    render();
  } catch(e) {
    setStatus('err', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å: ' + e.message, '‚ùå');
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PARSER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function parseStationsText(text) {
  const defM = text.match(/const\s+defaultCoords\s*=\s*({[\s\S]*?});/);
  const stM  = text.match(/this\.stations\s*=\s*({[\s\S]*?});/);
  const tmM  = text.match(/this\.travelTimes\s*=\s*({[\s\S]*?});/);
  const ordM = text.match(/this\.participantOrders\s*=\s*({[\s\S]*?});/);
  const trfM = text.match(/this\.treffpunkt\s*=\s*({[\s\S]*?});/);
  const trtM = text.match(/this\.trefftravelTimes\s*=\s*({[\s\S]*?});/);
  if (!defM && !stM) throw new Error('–ù–µ –Ω–∞–π–¥–µ–Ω—ã –±–ª–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
  if (defM) data.defaultCoords = Function('"use strict";return (' + defM[1] + ')')();
  if (stM)  data.stations      = Function('"use strict";return (' + stM[1]  + ')')();
  if (tmM)  travelTimes        = Function('"use strict";return (' + tmM[1]  + ')')();
  if (ordM) participantOrders  = Function('"use strict";return (' + ordM[1] + ')')();
  if (trfM) treffpunkt         = Function('"use strict";return (' + trfM[1] + ')')();
  if (trtM) trefftravelTimes   = Function('"use strict";return (' + trtM[1] + ')')();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TRAVEL LINK UTILS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function addTravelLinks(newName) {
  Object.keys(data.defaultCoords).forEach(old => {
    if (old === newName) return;
    if (travelTimes[`${newName}-${old}`] === undefined) travelTimes[`${newName}-${old}`] = DEFAULT_TT;
  });
}
function removeTravelLinks(name) {
  Object.keys(travelTimes).forEach(k => {
    if (k.startsWith(name + '-') || k.endsWith('-' + name)) delete travelTimes[k];
  });
}
function getAllUsedNames(driver) {
  const used = new Set();
  (participantOrders[driver] || []).forEach(item => {
    if (typeof item === 'string') used.add(item);
    else if (item?.main) { used.add(item.main); item.subParticipants?.forEach(s => used.add(s)); }
  });
  return used;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  RENDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function render() {
  const box = document.getElementById('cards');
  box.innerHTML = '';
  const grp = currentGroup;

  // ‚îÄ‚îÄ participantOrders ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  if (grp === 'participantOrders') {
    const drivers = Object.keys(data.defaultCoords).sort();

    const row = document.createElement('div');
    row.className = 'driver-row';
    row.innerHTML = `<label>–í–æ–¥–∏—Ç–µ–ª—å</label>`;
    const driverSel = document.createElement('select');
    driverSel.id = 'driverSel';
    drivers.forEach(d => {
      const opt = document.createElement('option');
      opt.value = opt.textContent = d;
      if (d === (participantOrders._lastDriver || drivers[0])) opt.selected = true;
      driverSel.appendChild(opt);
    });
    row.appendChild(driverSel);

    const addBtn2 = document.createElement('button');
    addBtn2.className = 'add-sub-btn';
    addBtn2.textContent = '+';
    addBtn2.title = '–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞';
    addBtn2.style.cssText = 'width:34px;height:34px;border-radius:var(--r-sm);flex-shrink:0;';
    addBtn2.onclick = () => triggerAddOrder(driverSel.value, drivers);
    row.appendChild(addBtn2);
    box.appendChild(row);

    const listBox = document.createElement('div');
    listBox.id = 'orderList';
    box.appendChild(listBox);

    function rebuildList() {
      const driver = driverSel.value;
      participantOrders._lastDriver = driver;
      listBox.innerHTML = '';
      const order = participantOrders[driver] || [];

      if (!order.length) {
        listBox.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üìã</div><p>–ü–æ—Ä—è–¥–æ–∫ –Ω–µ –∑–∞–¥–∞–Ω.<br>–ù–∞–∂–º–∏—Ç–µ + —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å.</p></div>`;
        return;
      }

      order.forEach((item, idx) => {
        if (typeof item === 'string') {
          const div = mkCard(false, idx);
          const nm = document.createElement('span'); nm.className = 'card-name'; nm.style.cursor = 'default';
          nm.textContent = `${idx + 1}. ${item}`; div.appendChild(nm);
          const subBtn = mkAddSubBtn();
          subBtn.onclick = e => { e.stopPropagation(); triggerConvertToGroup(driver, idx, item, drivers); };
          div.appendChild(subBtn);
          div.appendChild(mkHandle());
          div.appendChild(mkDelBtn(() => { order.splice(idx, 1); rebuildList(); showMsg('–£–¥–∞–ª–µ–Ω–æ'); }));
          listBox.appendChild(div);
        } else if (item?.main) {
          const div = mkCard(true, idx);
          const nm = document.createElement('span'); nm.className = 'card-name'; nm.style.cursor = 'default';
          nm.textContent = `${idx + 1}. ${item.main} üë•`; div.appendChild(nm);
          const subBtn = mkAddSubBtn();
          subBtn.onclick = e => { e.stopPropagation(); triggerAddToGroup(driver, idx, item.main, drivers); };
          div.appendChild(subBtn);
          div.appendChild(mkHandle());
          div.appendChild(mkDelBtn(() => { order.splice(idx, 1); rebuildList(); showMsg('–£–¥–∞–ª–µ–Ω–æ'); }));
          listBox.appendChild(div);

          if (item.subParticipants?.length) {
            const indent = document.createElement('div'); indent.className = 'group-indent';
            item.subParticipants.forEach((sub, si) => {
              const sd = mkCard(false, idx);
              sd.classList.add('sub-card');
              const arrow = document.createElement('span'); arrow.textContent = '‚Ü≥'; arrow.style.cssText = 'color:var(--text2);font-size:.8rem;flex-shrink:0;';
              const nm2 = document.createElement('span'); nm2.className = 'card-name'; nm2.style.cursor = 'default'; nm2.textContent = sub;
              sd.appendChild(arrow); sd.appendChild(nm2);
              sd.appendChild(mkDelBtn(() => {
                item.subParticipants.splice(si, 1);
                if (!item.subParticipants.length) order[idx] = item.main;
                rebuildList(); showMsg('–£–¥–∞–ª–µ–Ω–æ');
              }));
              indent.appendChild(sd);
            });
            listBox.appendChild(indent);
          }
        }
      });

      // Sortable
      if (listBox._sortable) listBox._sortable.destroy();
      listBox._sortable = new Sortable(listBox, {
        animation: 150,
        handle: '.drag-handle',
        filter: '.group-indent',
        onEnd: () => {
          const cards = [...listBox.children].filter(el => el.classList.contains('card'));
          participantOrders[driver] = cards.map(c => order[parseInt(c.dataset.index)]);
          rebuildList(); showMsg('–ü–æ—Ä—è–¥–æ–∫ –∏–∑–º–µ–Ω—ë–Ω');
        }
      });

      // Raw JSON
      updateRaw();
    }

    driverSel.onchange = () => rebuildList();
    rebuildList();

    appendRawBlock(box);
    updateRaw();
    return;
  }

  // ‚îÄ‚îÄ treffpunkt ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  if (grp === 'treffpunkt') {
    const entries = Object.entries(treffpunkt);
    if (!entries.length) box.appendChild(emptyState('üìç', '–ù–µ—Ç –ø—É–Ω–∫—Ç–æ–≤ –≤—Å—Ç—Ä–µ—á–∏'));
    entries.forEach(([name, coord]) => {
      const card = document.createElement('div'); card.className = 'card';
      const nm = mkNameEl(name, newName => {
        if (treffpunkt[newName]) { showMsg('–£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'); return false; }
        treffpunkt[newName] = treffpunkt[name]; delete treffpunkt[name];
        Object.keys(trefftravelTimes).filter(k => k.startsWith(name + '-')).forEach(k => {
          trefftravelTimes[newName + '-' + k.slice(name.length + 1)] = trefftravelTimes[k];
          delete trefftravelTimes[k];
        });
        render(); showMsg('–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ'); return true;
      });
      card.appendChild(nm);
      card.appendChild(mkCoordInput(coord, c => { treffpunkt[name] = c; }));
      card.appendChild(mkDelBtn(() => {
        Object.keys(trefftravelTimes).forEach(k => { if (k.startsWith(name + '-')) delete trefftravelTimes[k]; });
        delete treffpunkt[name]; render(); showMsg('–£–¥–∞–ª–µ–Ω–æ');
      }));
      box.appendChild(card);
    });
    appendRawBlock(box);
    document.getElementById('rawJson').value = JSON.stringify(treffpunkt, null, 2);
    return;
  }

  // ‚îÄ‚îÄ trefftravelTimes / travelTimes ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  if (grp === 'trefftravelTimes' || grp === 'travelTimes') {
    const src = grp === 'travelTimes' ? travelTimes : trefftravelTimes;
    const entries = Object.entries(src);
    if (!entries.length) box.appendChild(emptyState('‚è±', '–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ –≤—Ä–µ–º–µ–Ω–∏'));
    entries.forEach(([key, val]) => {
      const card = document.createElement('div'); card.className = 'card';
      const nm = document.createElement('span'); nm.className = 'card-name'; nm.style.cursor = 'default';
      nm.style.fontSize = '.82rem'; nm.textContent = key;
      card.appendChild(nm);

      const wrap = document.createElement('div');
      wrap.style.cssText = 'display:flex;align-items:center;gap:4px;flex-shrink:0;margin-left:auto;';

      const ti = document.createElement('input');
      ti.type = 'text';
      ti.className = 'card-time-input';

      const unitLabel = document.createElement('span');
      unitLabel.className = 'time-min';

      // –ú–∏–Ω—É—Ç—ã ‚Üí –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ: –ª—é–±–æ–µ >= 60 ‚Üí —á–∞—Å—ã, < 60 ‚Üí –º–∏–Ω—É—Ç—ã
      function toDisplay(minutes) {
        if (minutes >= 60) {
          return { text: (minutes / 60).toFixed(2), unit: '—á' };
        }
        return { text: String(minutes), unit: '–º–∏–Ω' };
      }

      // –í–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí –º–∏–Ω—É—Ç—ã:
      // "20"   ‚Üí 20 –º–∏–Ω  (—Ü–µ–ª–æ–µ < 60 ‚Üí –º–∏–Ω—É—Ç—ã)
      // "120"  ‚Üí 120 –º–∏–Ω = 2 —á  (—Ü–µ–ª–æ–µ >= 60 ‚Üí –º–∏–Ω—É—Ç—ã, –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—Å—è –∫–∞–∫ "2.0 —á")
      // "2.0" –∏–ª–∏ "2,0" ‚Üí 2 * 60 = 120 –º–∏–Ω  (–µ—Å—Ç—å —Ç–æ—á–∫–∞/–∑–∞–ø—è—Ç–∞—è ‚Üí —á–∞—Å—ã)
      function fromInput(raw) {
        const s = raw.trim().replace(',', '.');
        const n = parseFloat(s);
        if (isNaN(n) || n <= 0) return null;
        return s.includes('.') ? Math.round(n * 60) : Math.round(n);
      }

      const { text, unit } = toDisplay(val);
      ti.value = text;
      unitLabel.textContent = unit;

      ti.addEventListener('change', () => {
        const minutes = fromInput(ti.value);
        if (minutes && minutes > 0) {
          src[key] = minutes;
          const { text: t, unit: u } = toDisplay(minutes);
          ti.value = t;
          unitLabel.textContent = u;
          showMsg('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
        } else {
          const { text: t, unit: u } = toDisplay(src[key]);
          ti.value = t; unitLabel.textContent = u;
          showMsg('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç');
        }
      });

      wrap.appendChild(ti);
      wrap.appendChild(unitLabel);

      // –ö–Ω–æ–ø–∫–∞ Google Maps ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å —Ä–∞—Å—á—ë—Ç–∞
      const isTreff = grp === 'trefftravelTimes';
      const recBtn = document.createElement('button');
      recBtn.className = 'google-map-btn';
      recBtn.title = '–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –≤—Ä–µ–º—è —á–µ—Ä–µ–∑ Google Maps';
      recBtn.innerHTML = getAutoFlag(key, isTreff) ? coloredMapSvg : grayMapSvg;
      recBtn.onclick = e => {
        e.stopPropagation();
        isTreff ? recalcOneTreff(key, recBtn) : recalcOne(key, src, recBtn);
      };
      wrap.appendChild(recBtn);

      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –ø—Ä–∏ —Ä—É—á–Ω–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏
      ti.addEventListener('change', () => {
        setAutoFlag(key, isTreff, false);
        recBtn.innerHTML = grayMapSvg;
      });

      card.appendChild(wrap);
      card.appendChild(mkDelBtn(() => { delete src[key]; render(); showMsg('–£–¥–∞–ª–µ–Ω–æ'); }));
      box.appendChild(card);
    });
    appendRawBlock(box);
    document.getElementById('rawJson').value = JSON.stringify(src, null, 2);
    return;
  }

  // ‚îÄ‚îÄ defaultCoords / stations ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const src = data[grp] || {};
  const entries = Object.entries(src);
  if (!entries.length) box.appendChild(emptyState(grp === 'stations' ? 'üöâ' : 'üë§', '–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç'));
  entries.forEach(([name, coord]) => {
    const card = document.createElement('div'); card.className = 'card';
    const nm = mkNameEl(name, newName => {
      if (data[grp][newName]) { showMsg('–£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'); return false; }
      data[grp][newName] = data[grp][name]; delete data[grp][name];
      if (grp === 'defaultCoords') { removeTravelLinks(name); addTravelLinks(newName); }
      render(); showMsg('–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ'); return true;
    });
    card.appendChild(nm);
    card.appendChild(mkCoordInput(coord, c => { data[grp][name] = c; }));
    card.appendChild(mkDelBtn(() => {
      if (grp === 'defaultCoords') removeTravelLinks(name);
      delete data[grp][name];
      Object.keys(participantOrders).forEach(s => {
        if (!s.startsWith('_')) participantOrders[s] = participantOrders[s].filter(n => n !== name);
      });
      render(); showMsg('–£–¥–∞–ª–µ–Ω–æ'); updateHeaderSub();
    }));
    box.appendChild(card);
  });

  // Count badge
  const cnt = document.createElement('div');
  cnt.style.cssText = 'display:flex;justify-content:flex-end;margin-bottom:4px;';
  cnt.innerHTML = `<span class="section-count">${entries.length} –∑–∞–ø–∏—Å–µ–π</span>`;
  if (entries.length) box.insertBefore(cnt, box.firstChild);

  appendRawBlock(box);
  document.getElementById('rawJson').value = JSON.stringify(src, null, 2);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  RAW JSON HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function appendRawBlock(box) {
  const rb = document.createElement('div'); rb.className = 'raw-block';
  rb.innerHTML = `
    <button class="raw-toggle" id="rawToggle">
      <span>{ } JSON</span>
      <span class="raw-toggle-arrow">‚ñº</span>
    </button>
    <div class="raw-body" id="rawBody">
      <textarea id="rawJson" spellcheck="false"></textarea>
    </div>`;
  box.appendChild(rb);

  const btn = rb.querySelector('#rawToggle');
  const body = rb.querySelector('#rawBody');
  btn.addEventListener('click', () => {
    const open = body.classList.toggle('open');
    btn.classList.toggle('open', open);
  });
}
function updateRaw() {
  const grp = currentGroup;
  const el = document.getElementById('rawJson');
  if (!el) return;
  if (grp === 'participantOrders') {
    const clean = {};
    Object.keys(participantOrders).filter(k => !k.startsWith('_')).forEach(k => clean[k] = participantOrders[k]);
    el.value = JSON.stringify(clean, null, 2);
  } else if (grp === 'travelTimes') el.value = JSON.stringify(travelTimes, null, 2);
  else if (grp === 'trefftravelTimes') el.value = JSON.stringify(trefftravelTimes, null, 2);
  else if (grp === 'treffpunkt') el.value = JSON.stringify(treffpunkt, null, 2);
  else el.value = JSON.stringify(data[grp] || {}, null, 2);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DOM HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function mkCard(isGroup, idx) {
  const d = document.createElement('div');
  d.className = 'card' + (isGroup ? ' group-card' : '');
  if (idx !== undefined) d.dataset.index = idx;
  return d;
}
function mkHandle() {
  const h = document.createElement('span'); h.className = 'drag-handle'; h.textContent = '‚†ø'; return h;
}
function mkDelBtn(cb) {
  const b = document.createElement('button'); b.className = 'del-btn'; b.textContent = '‚úñ';
  b.onclick = e => { e.stopPropagation(); cb(); }; return b;
}
function mkAddSubBtn() {
  const b = document.createElement('button'); b.className = 'add-sub-btn'; b.textContent = '+';
  b.style.cssText = 'flex-shrink:0;'; return b;
}
function mkNameEl(name, onRename) {
  const span = document.createElement('span'); span.className = 'card-name'; span.textContent = name;
  span.title = '–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è';
  span.onclick = () => {
    const input = document.createElement('input'); input.className = 'card-name-input'; input.value = name;
    span.replaceWith(input); input.focus(); input.select();
    const finish = () => {
      const newName = input.value.trim();
      if (!newName || newName === name) { input.replaceWith(span); return; }
      const ok = onRename(newName);
      if (!ok) input.replaceWith(span);
    };
    input.addEventListener('blur', finish);
    input.addEventListener('keydown', e => { if (e.key === 'Enter') input.blur(); if (e.key === 'Escape') { input.replaceWith(span); } });
  };
  return span;
}
function mkCoordInput(coord, onChange) {
  const wrap = document.createElement('div'); wrap.className = 'card-coord';
  wrap.style.marginLeft = 'auto'; /* –ø—Ä–∏–∂–∏–º–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–ø—Ä–∞–≤–æ */
  const inp = document.createElement('input'); inp.type = 'text';
  inp.value = `${coord.lat}, ${coord.lng}`;
  inp.title = '–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–ª–∏ —Å—Å—ã–ª–∫–∞ Google Maps';
  inp.addEventListener('change', async () => {
    const c = await parseAnyCoords(inp.value.trim());
    if (c) { inp.value = `${c.lat}, ${c.lng}`; onChange(c); showMsg('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ‚úì'); }
    else { inp.value = `${coord.lat}, ${coord.lng}`; }
  });
  wrap.appendChild(inp); return wrap;
}
function emptyState(icon, text) {
  const d = document.createElement('div'); d.className = 'empty-state';
  d.innerHTML = `<div class="empty-state-icon">${icon}</div><p>${text}</p>`; return d;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  participantOrders modals
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function triggerAddOrder(driver, drivers) {
  const used = getAllUsedNames(driver);
  const avail = drivers.filter(n => n !== driver && !used.has(n));
  if (!avail.length) { showMsg('–í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã'); return; }
  window._modalCtx = { mode: 'add', driver };
  fillSelectModal(avail, `–î–æ–±–∞–≤–∏—Ç—å –∫ ${driver}`);
  openModal('selectModal');
}
function triggerConvertToGroup(driver, idx, mainName, drivers) {
  const used = getAllUsedNames(driver);
  const avail = drivers.filter(n => n !== driver && !used.has(n));
  if (!avail.length) { showMsg('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤'); return; }
  window._modalCtx = { mode: 'convertToGroup', driver, idx, mainName };
  fillSelectModal(avail, `–î–æ–±–∞–≤–∏—Ç—å –∫ ${mainName}`);
  openModal('selectModal');
}
function triggerAddToGroup(driver, groupIdx, groupMain, drivers) {
  const used = getAllUsedNames(driver);
  const avail = drivers.filter(n => n !== driver && !used.has(n));
  if (!avail.length) { showMsg('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤'); return; }
  window._modalCtx = { mode: 'addToGroup', driver, groupIdx, groupMain };
  fillSelectModal(avail, `–î–æ–±–∞–≤–∏—Ç—å –≤ –≥—Ä—É–ø–ø—É ${groupMain}`);
  openModal('selectModal');
}

function fillSelectModal(avail, title) {
  const sel = document.getElementById('selectParticipant');
  sel.innerHTML = '';
  avail.forEach(n => { const o = document.createElement('option'); o.value = o.textContent = n; sel.appendChild(o); });
  document.getElementById('selectModalTitle').textContent = title;
}

document.getElementById('selectConfirm').onclick = () => {
  const ctx = window._modalCtx;
  const name = document.getElementById('selectParticipant').value;
  if (!name) return;
  if (ctx.mode === 'add') {
    if (!participantOrders[ctx.driver]) participantOrders[ctx.driver] = [];
    participantOrders[ctx.driver].push(name);
    participantOrders._lastDriver = ctx.driver;
  } else if (ctx.mode === 'convertToGroup') {
    participantOrders[ctx.driver][ctx.idx] = { main: ctx.mainName, subParticipants: [name] };
  } else if (ctx.mode === 'addToGroup') {
    const g = participantOrders[ctx.driver][ctx.groupIdx];
    if (g?.subParticipants) g.subParticipants.push(name);
  }
  closeModal('selectModal');
  render(); showMsg('–î–æ–±–∞–≤–ª–µ–Ω–æ ‚úì');
};
document.getElementById('selectCancel').onclick = () => closeModal('selectModal');

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  ADD BUTTON
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.getElementById('addBtn').onclick = () => {
  if (currentGroup === 'participantOrders') {
    const driverSel = document.getElementById('driverSel');
    if (!driverSel) return;
    const drivers = Object.keys(data.defaultCoords).sort();
    triggerAddOrder(driverSel.value, drivers);
    return;
  }
  const modalSel = document.getElementById('modalGroupSel');
  if ([...modalSel.options].some(o => o.value === currentGroup)) modalSel.value = currentGroup;
  updateAddPlaceholders();
  openModal('addModal');
  setTimeout(() => document.getElementById('newName').focus(), 100);
};

document.getElementById('modalGroupSel').addEventListener('change', updateAddPlaceholders);
function updateAddPlaceholders() {
  const grp = document.getElementById('modalGroupSel').value;
  const ni = document.getElementById('newName');
  const ci = document.getElementById('newCoord');
  const cl = document.getElementById('coordLabel');
  if (grp === 'travelTimes')       { ni.placeholder = '–ò–º—è1-–ò–º—è2';   ci.placeholder = '–í—Ä–µ–º—è (–º–∏–Ω)'; cl.textContent = '–í—Ä–µ–º—è (–º–∏–Ω—É—Ç—ã)'; }
  else if (grp === 'trefftravelTimes') { ni.placeholder = '–ü—É–Ω–∫—Ç-–ò–º—è'; ci.placeholder = '–í—Ä–µ–º—è (–º–∏–Ω)'; cl.textContent = '–í—Ä–µ–º—è (–º–∏–Ω—É—Ç—ã)'; }
  else { ni.placeholder = '–ò–º—è –∏–ª–∏ –∫–ª—é—á'; ci.placeholder = '51.530, 6.850 –∏–ª–∏ —Å—Å—ã–ª–∫–∞ Google Maps'; cl.textContent = '–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (lat, lng)'; }
}

document.getElementById('addCancel').onclick = () => closeModal('addModal');
document.getElementById('addConfirm').onclick = async () => {
  const grp  = document.getElementById('modalGroupSel').value;
  const name = document.getElementById('newName').value.trim();
  const val  = document.getElementById('newCoord').value.trim();
  if (!name) { showMsg('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ'); return; }

  if (grp === 'travelTimes') {
    if (travelTimes[name] !== undefined) { showMsg('–ö–ª—é—á —É–∂–µ –µ—Å—Ç—å'); return; }
    travelTimes[name] = parseInt(val) || DEFAULT_TT;
    // –ê–≤—Ç–æ—Ä–∞—Å—á—ë—Ç —á–µ—Ä–µ–∑ API
    autoCalcPair(name, false);
  } else if (grp === 'trefftravelTimes') {
    if (trefftravelTimes[name] !== undefined) { showMsg('–ö–ª—é—á —É–∂–µ –µ—Å—Ç—å'); return; }
    trefftravelTimes[name] = parseInt(val) || DEFAULT_TT;
    // –ê–≤—Ç–æ—Ä–∞—Å—á—ë—Ç —á–µ—Ä–µ–∑ API
    autoCalcPair(name, true);
  } else if (grp === 'treffpunkt') {
    if (treffpunkt[name]) { showMsg('–ü—É–Ω–∫—Ç —É–∂–µ –µ—Å—Ç—å'); return; }
    const c = await parseAnyCoords(val) || { lat: 0, lng: 0 };
    treffpunkt[name] = c;
  } else {
    if (data[grp]?.[name]) { showMsg('–£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'); return; }
    const c = await parseAnyCoords(val) || { lat: 0, lng: 0 };
    data[grp][name] = c;
    if (grp === 'defaultCoords') { addTravelLinks(name); updateHeaderSub(); }
  }
  // Switch to correct tab
  document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.group === grp));
  currentGroup = grp;
  closeModal('addModal');
  document.getElementById('newName').value = '';
  document.getElementById('newCoord').value = '';
  render(); showMsg('–î–æ–±–∞–≤–ª–µ–Ω–æ ‚úì');
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TOOLBAR BUTTONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.getElementById('copyBtn').onclick = () => {
  // –û—Ç–∫—Ä—ã–≤–∞–µ–º JSON –±–ª–æ–∫ –µ—Å–ª–∏ –∑–∞–∫—Ä—ã—Ç
  const body = document.getElementById('rawBody');
  const btn  = document.getElementById('rawToggle');
  if (body && !body.classList.contains('open')) {
    body.classList.add('open');
    btn && btn.classList.add('open');
  }
  const ta = document.getElementById('rawJson');
  if (!ta) { showMsg('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'); return; }
  ta.select(); document.execCommand('copy'); window.getSelection()?.removeAllRanges();
  showMsg('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ üìã');
};

document.getElementById('applyRaw').onclick = () => {
  // –û—Ç–∫—Ä—ã–≤–∞–µ–º JSON –±–ª–æ–∫ –µ—Å–ª–∏ –∑–∞–∫—Ä—ã—Ç (—á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–µ–ª —á—Ç–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç)
  const body = document.getElementById('rawBody');
  const toggleBtn = document.getElementById('rawToggle');
  if (body && !body.classList.contains('open')) {
    body.classList.add('open');
    toggleBtn && toggleBtn.classList.add('open');
    showMsg('–û—Ç–∫—Ä–æ–π—Ç–µ JSON, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∏ –Ω–∞–∂–º–∏—Ç–µ –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å–Ω–æ–≤–∞');
    return;
  }
  try {
    const el = document.getElementById('rawJson');
    if (!el) { showMsg('JSON –Ω–µ –Ω–∞–π–¥–µ–Ω'); return; }
    const val = el.value.trim();
    if (!val) { showMsg('JSON –ø—É—Å—Ç–æ–π'); return; }
    const grp = currentGroup;
    const parsed = JSON.parse(val);
    if (grp === 'travelTimes')           travelTimes      = parsed;
    else if (grp === 'trefftravelTimes') trefftravelTimes = parsed;
    else if (grp === 'treffpunkt')       treffpunkt       = parsed;
    else if (grp === 'participantOrders') participantOrders = parsed;
    else if (grp === 'defaultCoords')    data.defaultCoords = parsed;
    else if (grp === 'stations')         data.stations      = parsed;
    updateHeaderSub();
    render(); showMsg('–ü—Ä–∏–º–µ–Ω–µ–Ω–æ ‚úÖ');
  } catch(e) { showMsg('–û—à–∏–±–∫–∞ JSON: ' + e.message.slice(0, 40) + ' ‚ùå', 3000); }
};

document.getElementById('loadBtn').onclick = () => document.getElementById('fileInput').click();
document.getElementById('fileInput').addEventListener('change', e => {
  const file = e.target.files[0]; if (!file) return;
  const reader = new FileReader();
  reader.onload = evt => {
    try {
      parseStationsText(evt.target.result);
      setStatus('ok', '‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ: ' + file.name, '‚úÖ');
      document.getElementById('ghUploadBtn').disabled = false;
      updateHeaderSub(); render(); showMsg('–ó–∞–≥—Ä—É–∂–µ–Ω–æ ‚úì');
    } catch { showMsg('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞ ‚ùå'); }
  };
  reader.readAsText(file, 'utf-8');
  e.target.value = '';
});

document.getElementById('saveBtn').onclick = () => {
  const text = buildExportText();
  const blob = new Blob([text], { type: 'application/javascript;charset=utf-8' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob); a.download = 'stations.js'; a.click();
  URL.revokeObjectURL(a.href);
  showMsg('stations.js —Å–∫–∞—á–∞–Ω üíæ');
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  RECALC MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openRecalcModal() {
  document.getElementById('recalcProgress').style.display = 'none';
  document.getElementById('recalcProgress').textContent = '';
  document.getElementById('recalcStart').disabled = false;
  openModal('recalcModal');
}

document.getElementById('recalcBtn').onclick = openRecalcModal;
document.getElementById('recalcCancel').onclick = () => closeModal('recalcModal');

document.getElementById('recalcStart').onclick = async () => {
  const target = document.getElementById('recalcTarget').value;
  const mode   = document.getElementById('recalcMode').value;
  const prog   = document.getElementById('recalcProgress');
  prog.style.display = 'block';

  // –°–æ–±–∏—Ä–∞–µ–º –ø–∞—Ä—ã
  const pairs = [];
  if (target === 'travelTimes' || target === 'both') {
    Object.keys(travelTimes).forEach(key => {
      if (mode === 'missing' && travelTimes[key] !== DEFAULT_TT) return;
      pairs.push({ key, src: travelTimes, isTreff: false });
    });
  }
  if (target === 'trefftravelTimes' || target === 'both') {
    Object.keys(trefftravelTimes).forEach(key => {
      if (mode === 'missing' && trefftravelTimes[key] !== DEFAULT_TT) return;
      pairs.push({ key, src: trefftravelTimes, isTreff: true });
    });
  }

  if (!pairs.length) { prog.textContent = '‚ÑπÔ∏è –ù–µ—Ç –ø–∞—Ä –¥–ª—è –ø–µ—Ä–µ—Å—á—ë—Ç–∞'; return; }

  const startBtn = document.getElementById('recalcStart');
  startBtn.disabled = true;
  let done = 0, errors = 0;

  for (const { key, src, isTreff } of pairs) {
    prog.textContent = `‚è≥ ${done + errors + 1} / ${pairs.length}  ‚Äî  ${key}`;
    try {
      const [a, b] = splitPairKey(key, isTreff);
      const cA = isTreff ? treffpunkt[a] : getCoordsFor(a);
      const cB = getCoordsFor(b);
      if (!cA || !cB) throw new Error(`–Ω–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç: ${!cA ? a : b}`);
      src[key] = await fetchTravelTime(cA.lat, cA.lng, cB.lat, cB.lng);
      setAutoFlag(key, isTreff, true);
      done++;
    } catch(e) {
      errors++;
      console.warn(`${key}: ${e.message}`);
    }
    await new Promise(r => setTimeout(r, 300));
  }

  prog.textContent = `‚úÖ –ì–æ—Ç–æ–≤–æ: –æ–±–Ω–æ–≤–ª–µ–Ω–æ ${done}, –æ—à–∏–±–æ–∫ ${errors}`;
  startBtn.disabled = false;
  render();
  showMsg(`–ü–µ—Ä–µ—Å—á–∏—Ç–∞–Ω–æ ${done} –ø–∞—Ä`, 3000);
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  EXPORT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildExportText() {
  const L = (o, fn) => Object.entries(o).map(fn).join(',\n');
  return `// —Ä–µ–µ—Å—Ç—Ä –∏–º–µ–Ω
const defaultCoords = {
${L(data.defaultCoords, ([n,c]) => `  '${n}': {lat: ${c.lat}, lng: ${c.lng}}`)}
};

// —Ä–µ–µ—Å—Ç—Ä —Å—Ç–∞–Ω—Ü–∏–π
this.stations = {
${L(data.stations, ([n,c]) => `  '${n}': {lat: ${c.lat}, lng: ${c.lng}}`)}
};

// –í—Ä–µ–º—è –≤ –ø—É—Ç–∏ –º–µ–∂–¥—É —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
this.travelTimes = {
${L(travelTimes, ([p,t]) => `  '${p}': ${t}`)}
};

// –ü—É–Ω–∫—Ç—ã –≤—Å—Ç—Ä–µ—á–∏ (Treffpunkt)
this.treffpunkt = {
${L(treffpunkt, ([n,c]) => `  '${n}': {lat: ${c.lat}, lng: ${c.lng}}`)}
};

// –í—Ä–µ–º—è –≤ –ø—É—Ç–∏ –æ—Ç –ø—É–Ω–∫—Ç–∞ –≤—Å—Ç—Ä–µ—á–∏ –¥–æ –∫–∞–∂–¥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
this.trefftravelTimes = {
${L(trefftravelTimes, ([p,t]) => `  '${p}': ${t}`)}
};

// –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ —Å–ø–∏—Å–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫
this.participantOrders = {
${Object.keys(participantOrders).filter(k => !k.startsWith('_')).map(s => {
  // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≥—Ä—É–ø–ø—ã {main, subParticipants} –≤ –ø–ª–æ—Å–∫–∏–π –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫
  const flat = (participantOrders[s] || []).flatMap(item =>
    typeof item === 'string' ? [item] : [item.main, ...(item.subParticipants || [])]
  );
  return `  '${s}': ${JSON.stringify(flat)}`;
}).join(',\n')}
};`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  GITHUB
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.getElementById('ghUploadBtn').onclick = () => {
  const saved = localStorage.ghToken;
  document.getElementById('ghTokenInp').value = saved || '';
  document.getElementById('tokenHint').textContent = saved ? 'üîë –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—ë–Ω' : '';
  openModal('ghModal');
  if (!saved) document.getElementById('ghTokenInp').focus();
};
document.getElementById('ghCancelBtn').onclick = () => closeModal('ghModal');

document.getElementById('ghSendStationsBtn').onclick = async () => {
  const token = document.getElementById('ghTokenInp').value.trim();
  if (!token) { showMsg('–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω'); return; }
  await uploadToGitHub(token, GH_FILE, buildExportText());
};
document.getElementById('ghSendAnyBtn').onclick = async () => {
  const token = document.getElementById('ghTokenInp').value.trim();
  if (!token) { showMsg('–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω'); return; }
  const fi = document.getElementById('ghAnyFile');
  const ni = document.getElementById('ghAnyName');
  if (!fi.files.length) { showMsg('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª'); return; }
  const file = fi.files[0];
  const path = ni.value.trim() || file.name;
  await uploadToGitHub(token, path, await file.text());
};

async function uploadToGitHub(token, path, text) {
  localStorage.ghToken = token;
  showMsg('–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ GitHub‚Ä¶', 5000);
  const base64 = btoa(unescape(encodeURIComponent(text)));
  let sha;
  try {
    const h = await fetch(`https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/contents/${path}`, {
      headers: { Authorization: `token ${token}` }
    });
    if (h.ok) sha = (await h.json()).sha;
  } catch {}
  const resp = await fetch(`https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/contents/${path}`, {
    method: 'PUT',
    headers: { Authorization: `token ${token}`, 'Content-Type': 'application/json' },
    body: JSON.stringify({ message: `web-update ${path}`, content: base64, sha })
  });
  closeModal('ghModal');
  if (resp.ok) {
    setStatus('ok', `‚úÖ ${path} –∑–∞–≥—Ä—É–∂–µ–Ω –Ω–∞ GitHub`, '‚úÖ');
    showMsg(`${path} –∑–∞–≥—Ä—É–∂–µ–Ω ‚úÖ`, 2500);
  } else {
    const err = await resp.json();
    showMsg('–û—à–∏–±–∫–∞: ' + err.message, 4000);
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  COORDS PARSER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function parseAnyCoords(s) {
  if (!s) return null; s = s.trim();
  // –ï–≤—Ä–æ–ø–µ–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç "51,530 6,850" ‚Üí "51.530, 6.850"
  if (/^-?\d{1,2},\d+\s*,\s*-?\d{1,3},\d+$/.test(s)) {
    const p = s.split(',').map(t => t.trim());
    const lat = parseFloat(p[0] + '.' + p[1]), lng = parseFloat(p[2] + '.' + p[3]);
    if (Math.abs(lat) <= 90 && Math.abs(lng) <= 180) return { lat, lng };
  }
  // Decimal
  if (/^-?\d{1,2}(?:\.\d+)?\s*,\s*-?\d{1,3}(?:\.\d+)?$/.test(s)) {
    const [l, ln] = s.split(',').map(Number);
    if (Math.abs(l) <= 90 && Math.abs(ln) <= 180) return { lat: l, lng: ln };
  }
  // Google Maps URL
  const m = s.match(/@(-?\d+\.\d+),(-?\d+\.\d+)/) ||
            s.match(/ll=(-?\d+\.\d+),(-?\d+\.\d+)/) ||
            s.match(/place\/[^\/]+\/(-?\d+\.\d+),(-?\d+\.\d+)/);
  if (m) { const lat = +m[1], lng = +m[2]; if (Math.abs(lat) <= 90 && Math.abs(lng) <= 180) return { lat, lng }; }
  // DMS
  const dms = [...s.matchAll(/(\d{1,3})¬∞(\d{1,2})'(\d{1,2}(?:\.\d+)?)"?\s*([NSEW])/gi)];
  if (dms.length === 2) {
    const toDec = ([,d,m,sec,dir]) => { let v = +d + m/60 + sec/3600; if (/S|W/i.test(dir)) v=-v; return v; };
    const lat = toDec(dms[0]), lng = toDec(dms[1]);
    if (Math.abs(lat) <= 90 && Math.abs(lng) <= 180) return { lat, lng };
  }
  showMsg('–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω—ã');
  return null;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  START
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
loadFromGitHub();
</script>
</body>
</html>
